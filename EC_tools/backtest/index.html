<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>backtest - EC_tools Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "backtest";
        var mkdocs_page_input_path = "EC_tools/backtest.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> EC_tools Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../about/">About</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../main/">Main</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">EC_tools</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../EC_tools/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../read/">read</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../plot/">plot</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../portfolio/">portfolio</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../position/">position</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../strategy/">strategy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../simple_trade/">simple_trade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../trade/">trade</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">backtest</a>
    <ul class="current">
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../utility/">utility</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Applications</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/app/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_apc_price_study/">Run APC Study</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_backtest/">Run Backtest</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_comparison_plot/">Run Comparison Plot</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_daily_instruction/">Run Daily Instruction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_data_management/">Run Data Management</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_gen_monthly_MR_dir/">Run Generate Monthly MR signals</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_gen_MR_dir/">Run Generate Daily MR signals</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../app/run_plot_heatamp.md">Run Plot Backtest Heatmap</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_PNL_plot/">Run PNL Plots</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_preprocess/">Run Preprocess</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_update_db/">Run Update DB</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">EC_tools Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">EC_tools</li>
      <li class="breadcrumb-item active">backtest</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="backtest">Backtest</h2>


<div class="doc doc-object doc-module">



<a id="EC_tools.backtest"></a>
    <div class="doc doc-contents first">

        <p>Created on Thu Apr 18 18:22:17 2024</p>
<p>@author: dexter</p>
<p>The backtest module contains all the necessary functions and class to run 
backtesting on any strategy. At the moment, the module only contains methods 
that include static instructions.</p>
<p>Backtest Loop Type:
    This module contains a vareity of Loop type for users. 
    Pricing data can be too much to compute. Going through each ticks will be 
    wildly inefficient and redundant. To solve this problem, there are a 
    few Loop Types available in this module to make backtest faster</p>
<div class="highlight"><pre><span></span><code>    (1) CrossoverLoop
        Looping over only the points of interest. Given a set of EES values.
        The loop only look at the time and price in which the price action
        breaches these threshold. This loop type contains the least details
        but is also the fastest.
    (2) RangeLoop
        Looping over a subset of data point given a boundary of intervals
    (3) FullLoop
        Looping through every single data point. It contains the most 
        grandnuality and details but is also the slowest (by a large margin).
</code></pre></div>
<p>Static Instruction Backtest:
    Functions in this module takes a precalculated Buy/Sell/Neutral
    signal with a predetermined target Entry, Exit, and Stop Loss (EES) level.
    The backtest loop utilise different trading method to search in the 
    pricing chart the appropriate time and price of EES and record 
    what trade was taken.</p>
<p>Backtest Methods on Singular Asset:
    loop_date</p>
<div class="highlight"><pre><span></span><code>loop_date_portfolio
</code></pre></div>
<p>Backtest Methods on Multiple Assets:
    There are several method that can be used to iterate through multiple assets.
    At the moment, there are three types:</p>
<p>List-based (WIP)</p>
<p>Preload_list (WIP)</p>
<p>Concurrent (WIP)</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="EC_tools.backtest.Loop" class="doc doc-heading">
            <code>Loop</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>


        <p>Loop methods for backtest</p>

              <details class="quote">
                <summary>Source code in <code>EC_tools/backtest.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-532"> 532</a></span>
<span class="normal"><a href="#__codelineno-0-533"> 533</a></span>
<span class="normal"><a href="#__codelineno-0-534"> 534</a></span>
<span class="normal"><a href="#__codelineno-0-535"> 535</a></span>
<span class="normal"><a href="#__codelineno-0-536"> 536</a></span>
<span class="normal"><a href="#__codelineno-0-537"> 537</a></span>
<span class="normal"><a href="#__codelineno-0-538"> 538</a></span>
<span class="normal"><a href="#__codelineno-0-539"> 539</a></span>
<span class="normal"><a href="#__codelineno-0-540"> 540</a></span>
<span class="normal"><a href="#__codelineno-0-541"> 541</a></span>
<span class="normal"><a href="#__codelineno-0-542"> 542</a></span>
<span class="normal"><a href="#__codelineno-0-543"> 543</a></span>
<span class="normal"><a href="#__codelineno-0-544"> 544</a></span>
<span class="normal"><a href="#__codelineno-0-545"> 545</a></span>
<span class="normal"><a href="#__codelineno-0-546"> 546</a></span>
<span class="normal"><a href="#__codelineno-0-547"> 547</a></span>
<span class="normal"><a href="#__codelineno-0-548"> 548</a></span>
<span class="normal"><a href="#__codelineno-0-549"> 549</a></span>
<span class="normal"><a href="#__codelineno-0-550"> 550</a></span>
<span class="normal"><a href="#__codelineno-0-551"> 551</a></span>
<span class="normal"><a href="#__codelineno-0-552"> 552</a></span>
<span class="normal"><a href="#__codelineno-0-553"> 553</a></span>
<span class="normal"><a href="#__codelineno-0-554"> 554</a></span>
<span class="normal"><a href="#__codelineno-0-555"> 555</a></span>
<span class="normal"><a href="#__codelineno-0-556"> 556</a></span>
<span class="normal"><a href="#__codelineno-0-557"> 557</a></span>
<span class="normal"><a href="#__codelineno-0-558"> 558</a></span>
<span class="normal"><a href="#__codelineno-0-559"> 559</a></span>
<span class="normal"><a href="#__codelineno-0-560"> 560</a></span>
<span class="normal"><a href="#__codelineno-0-561"> 561</a></span>
<span class="normal"><a href="#__codelineno-0-562"> 562</a></span>
<span class="normal"><a href="#__codelineno-0-563"> 563</a></span>
<span class="normal"><a href="#__codelineno-0-564"> 564</a></span>
<span class="normal"><a href="#__codelineno-0-565"> 565</a></span>
<span class="normal"><a href="#__codelineno-0-566"> 566</a></span>
<span class="normal"><a href="#__codelineno-0-567"> 567</a></span>
<span class="normal"><a href="#__codelineno-0-568"> 568</a></span>
<span class="normal"><a href="#__codelineno-0-569"> 569</a></span>
<span class="normal"><a href="#__codelineno-0-570"> 570</a></span>
<span class="normal"><a href="#__codelineno-0-571"> 571</a></span>
<span class="normal"><a href="#__codelineno-0-572"> 572</a></span>
<span class="normal"><a href="#__codelineno-0-573"> 573</a></span>
<span class="normal"><a href="#__codelineno-0-574"> 574</a></span>
<span class="normal"><a href="#__codelineno-0-575"> 575</a></span>
<span class="normal"><a href="#__codelineno-0-576"> 576</a></span>
<span class="normal"><a href="#__codelineno-0-577"> 577</a></span>
<span class="normal"><a href="#__codelineno-0-578"> 578</a></span>
<span class="normal"><a href="#__codelineno-0-579"> 579</a></span>
<span class="normal"><a href="#__codelineno-0-580"> 580</a></span>
<span class="normal"><a href="#__codelineno-0-581"> 581</a></span>
<span class="normal"><a href="#__codelineno-0-582"> 582</a></span>
<span class="normal"><a href="#__codelineno-0-583"> 583</a></span>
<span class="normal"><a href="#__codelineno-0-584"> 584</a></span>
<span class="normal"><a href="#__codelineno-0-585"> 585</a></span>
<span class="normal"><a href="#__codelineno-0-586"> 586</a></span>
<span class="normal"><a href="#__codelineno-0-587"> 587</a></span>
<span class="normal"><a href="#__codelineno-0-588"> 588</a></span>
<span class="normal"><a href="#__codelineno-0-589"> 589</a></span>
<span class="normal"><a href="#__codelineno-0-590"> 590</a></span>
<span class="normal"><a href="#__codelineno-0-591"> 591</a></span>
<span class="normal"><a href="#__codelineno-0-592"> 592</a></span>
<span class="normal"><a href="#__codelineno-0-593"> 593</a></span>
<span class="normal"><a href="#__codelineno-0-594"> 594</a></span>
<span class="normal"><a href="#__codelineno-0-595"> 595</a></span>
<span class="normal"><a href="#__codelineno-0-596"> 596</a></span>
<span class="normal"><a href="#__codelineno-0-597"> 597</a></span>
<span class="normal"><a href="#__codelineno-0-598"> 598</a></span>
<span class="normal"><a href="#__codelineno-0-599"> 599</a></span>
<span class="normal"><a href="#__codelineno-0-600"> 600</a></span>
<span class="normal"><a href="#__codelineno-0-601"> 601</a></span>
<span class="normal"><a href="#__codelineno-0-602"> 602</a></span>
<span class="normal"><a href="#__codelineno-0-603"> 603</a></span>
<span class="normal"><a href="#__codelineno-0-604"> 604</a></span>
<span class="normal"><a href="#__codelineno-0-605"> 605</a></span>
<span class="normal"><a href="#__codelineno-0-606"> 606</a></span>
<span class="normal"><a href="#__codelineno-0-607"> 607</a></span>
<span class="normal"><a href="#__codelineno-0-608"> 608</a></span>
<span class="normal"><a href="#__codelineno-0-609"> 609</a></span>
<span class="normal"><a href="#__codelineno-0-610"> 610</a></span>
<span class="normal"><a href="#__codelineno-0-611"> 611</a></span>
<span class="normal"><a href="#__codelineno-0-612"> 612</a></span>
<span class="normal"><a href="#__codelineno-0-613"> 613</a></span>
<span class="normal"><a href="#__codelineno-0-614"> 614</a></span>
<span class="normal"><a href="#__codelineno-0-615"> 615</a></span>
<span class="normal"><a href="#__codelineno-0-616"> 616</a></span>
<span class="normal"><a href="#__codelineno-0-617"> 617</a></span>
<span class="normal"><a href="#__codelineno-0-618"> 618</a></span>
<span class="normal"><a href="#__codelineno-0-619"> 619</a></span>
<span class="normal"><a href="#__codelineno-0-620"> 620</a></span>
<span class="normal"><a href="#__codelineno-0-621"> 621</a></span>
<span class="normal"><a href="#__codelineno-0-622"> 622</a></span>
<span class="normal"><a href="#__codelineno-0-623"> 623</a></span>
<span class="normal"><a href="#__codelineno-0-624"> 624</a></span>
<span class="normal"><a href="#__codelineno-0-625"> 625</a></span>
<span class="normal"><a href="#__codelineno-0-626"> 626</a></span>
<span class="normal"><a href="#__codelineno-0-627"> 627</a></span>
<span class="normal"><a href="#__codelineno-0-628"> 628</a></span>
<span class="normal"><a href="#__codelineno-0-629"> 629</a></span>
<span class="normal"><a href="#__codelineno-0-630"> 630</a></span>
<span class="normal"><a href="#__codelineno-0-631"> 631</a></span>
<span class="normal"><a href="#__codelineno-0-632"> 632</a></span>
<span class="normal"><a href="#__codelineno-0-633"> 633</a></span>
<span class="normal"><a href="#__codelineno-0-634"> 634</a></span>
<span class="normal"><a href="#__codelineno-0-635"> 635</a></span>
<span class="normal"><a href="#__codelineno-0-636"> 636</a></span>
<span class="normal"><a href="#__codelineno-0-637"> 637</a></span>
<span class="normal"><a href="#__codelineno-0-638"> 638</a></span>
<span class="normal"><a href="#__codelineno-0-639"> 639</a></span>
<span class="normal"><a href="#__codelineno-0-640"> 640</a></span>
<span class="normal"><a href="#__codelineno-0-641"> 641</a></span>
<span class="normal"><a href="#__codelineno-0-642"> 642</a></span>
<span class="normal"><a href="#__codelineno-0-643"> 643</a></span>
<span class="normal"><a href="#__codelineno-0-644"> 644</a></span>
<span class="normal"><a href="#__codelineno-0-645"> 645</a></span>
<span class="normal"><a href="#__codelineno-0-646"> 646</a></span>
<span class="normal"><a href="#__codelineno-0-647"> 647</a></span>
<span class="normal"><a href="#__codelineno-0-648"> 648</a></span>
<span class="normal"><a href="#__codelineno-0-649"> 649</a></span>
<span class="normal"><a href="#__codelineno-0-650"> 650</a></span>
<span class="normal"><a href="#__codelineno-0-651"> 651</a></span>
<span class="normal"><a href="#__codelineno-0-652"> 652</a></span>
<span class="normal"><a href="#__codelineno-0-653"> 653</a></span>
<span class="normal"><a href="#__codelineno-0-654"> 654</a></span>
<span class="normal"><a href="#__codelineno-0-655"> 655</a></span>
<span class="normal"><a href="#__codelineno-0-656"> 656</a></span>
<span class="normal"><a href="#__codelineno-0-657"> 657</a></span>
<span class="normal"><a href="#__codelineno-0-658"> 658</a></span>
<span class="normal"><a href="#__codelineno-0-659"> 659</a></span>
<span class="normal"><a href="#__codelineno-0-660"> 660</a></span>
<span class="normal"><a href="#__codelineno-0-661"> 661</a></span>
<span class="normal"><a href="#__codelineno-0-662"> 662</a></span>
<span class="normal"><a href="#__codelineno-0-663"> 663</a></span>
<span class="normal"><a href="#__codelineno-0-664"> 664</a></span>
<span class="normal"><a href="#__codelineno-0-665"> 665</a></span>
<span class="normal"><a href="#__codelineno-0-666"> 666</a></span>
<span class="normal"><a href="#__codelineno-0-667"> 667</a></span>
<span class="normal"><a href="#__codelineno-0-668"> 668</a></span>
<span class="normal"><a href="#__codelineno-0-669"> 669</a></span>
<span class="normal"><a href="#__codelineno-0-670"> 670</a></span>
<span class="normal"><a href="#__codelineno-0-671"> 671</a></span>
<span class="normal"><a href="#__codelineno-0-672"> 672</a></span>
<span class="normal"><a href="#__codelineno-0-673"> 673</a></span>
<span class="normal"><a href="#__codelineno-0-674"> 674</a></span>
<span class="normal"><a href="#__codelineno-0-675"> 675</a></span>
<span class="normal"><a href="#__codelineno-0-676"> 676</a></span>
<span class="normal"><a href="#__codelineno-0-677"> 677</a></span>
<span class="normal"><a href="#__codelineno-0-678"> 678</a></span>
<span class="normal"><a href="#__codelineno-0-679"> 679</a></span>
<span class="normal"><a href="#__codelineno-0-680"> 680</a></span>
<span class="normal"><a href="#__codelineno-0-681"> 681</a></span>
<span class="normal"><a href="#__codelineno-0-682"> 682</a></span>
<span class="normal"><a href="#__codelineno-0-683"> 683</a></span>
<span class="normal"><a href="#__codelineno-0-684"> 684</a></span>
<span class="normal"><a href="#__codelineno-0-685"> 685</a></span>
<span class="normal"><a href="#__codelineno-0-686"> 686</a></span>
<span class="normal"><a href="#__codelineno-0-687"> 687</a></span>
<span class="normal"><a href="#__codelineno-0-688"> 688</a></span>
<span class="normal"><a href="#__codelineno-0-689"> 689</a></span>
<span class="normal"><a href="#__codelineno-0-690"> 690</a></span>
<span class="normal"><a href="#__codelineno-0-691"> 691</a></span>
<span class="normal"><a href="#__codelineno-0-692"> 692</a></span>
<span class="normal"><a href="#__codelineno-0-693"> 693</a></span>
<span class="normal"><a href="#__codelineno-0-694"> 694</a></span>
<span class="normal"><a href="#__codelineno-0-695"> 695</a></span>
<span class="normal"><a href="#__codelineno-0-696"> 696</a></span>
<span class="normal"><a href="#__codelineno-0-697"> 697</a></span>
<span class="normal"><a href="#__codelineno-0-698"> 698</a></span>
<span class="normal"><a href="#__codelineno-0-699"> 699</a></span>
<span class="normal"><a href="#__codelineno-0-700"> 700</a></span>
<span class="normal"><a href="#__codelineno-0-701"> 701</a></span>
<span class="normal"><a href="#__codelineno-0-702"> 702</a></span>
<span class="normal"><a href="#__codelineno-0-703"> 703</a></span>
<span class="normal"><a href="#__codelineno-0-704"> 704</a></span>
<span class="normal"><a href="#__codelineno-0-705"> 705</a></span>
<span class="normal"><a href="#__codelineno-0-706"> 706</a></span>
<span class="normal"><a href="#__codelineno-0-707"> 707</a></span>
<span class="normal"><a href="#__codelineno-0-708"> 708</a></span>
<span class="normal"><a href="#__codelineno-0-709"> 709</a></span>
<span class="normal"><a href="#__codelineno-0-710"> 710</a></span>
<span class="normal"><a href="#__codelineno-0-711"> 711</a></span>
<span class="normal"><a href="#__codelineno-0-712"> 712</a></span>
<span class="normal"><a href="#__codelineno-0-713"> 713</a></span>
<span class="normal"><a href="#__codelineno-0-714"> 714</a></span>
<span class="normal"><a href="#__codelineno-0-715"> 715</a></span>
<span class="normal"><a href="#__codelineno-0-716"> 716</a></span>
<span class="normal"><a href="#__codelineno-0-717"> 717</a></span>
<span class="normal"><a href="#__codelineno-0-718"> 718</a></span>
<span class="normal"><a href="#__codelineno-0-719"> 719</a></span>
<span class="normal"><a href="#__codelineno-0-720"> 720</a></span>
<span class="normal"><a href="#__codelineno-0-721"> 721</a></span>
<span class="normal"><a href="#__codelineno-0-722"> 722</a></span>
<span class="normal"><a href="#__codelineno-0-723"> 723</a></span>
<span class="normal"><a href="#__codelineno-0-724"> 724</a></span>
<span class="normal"><a href="#__codelineno-0-725"> 725</a></span>
<span class="normal"><a href="#__codelineno-0-726"> 726</a></span>
<span class="normal"><a href="#__codelineno-0-727"> 727</a></span>
<span class="normal"><a href="#__codelineno-0-728"> 728</a></span>
<span class="normal"><a href="#__codelineno-0-729"> 729</a></span>
<span class="normal"><a href="#__codelineno-0-730"> 730</a></span>
<span class="normal"><a href="#__codelineno-0-731"> 731</a></span>
<span class="normal"><a href="#__codelineno-0-732"> 732</a></span>
<span class="normal"><a href="#__codelineno-0-733"> 733</a></span>
<span class="normal"><a href="#__codelineno-0-734"> 734</a></span>
<span class="normal"><a href="#__codelineno-0-735"> 735</a></span>
<span class="normal"><a href="#__codelineno-0-736"> 736</a></span>
<span class="normal"><a href="#__codelineno-0-737"> 737</a></span>
<span class="normal"><a href="#__codelineno-0-738"> 738</a></span>
<span class="normal"><a href="#__codelineno-0-739"> 739</a></span>
<span class="normal"><a href="#__codelineno-0-740"> 740</a></span>
<span class="normal"><a href="#__codelineno-0-741"> 741</a></span>
<span class="normal"><a href="#__codelineno-0-742"> 742</a></span>
<span class="normal"><a href="#__codelineno-0-743"> 743</a></span>
<span class="normal"><a href="#__codelineno-0-744"> 744</a></span>
<span class="normal"><a href="#__codelineno-0-745"> 745</a></span>
<span class="normal"><a href="#__codelineno-0-746"> 746</a></span>
<span class="normal"><a href="#__codelineno-0-747"> 747</a></span>
<span class="normal"><a href="#__codelineno-0-748"> 748</a></span>
<span class="normal"><a href="#__codelineno-0-749"> 749</a></span>
<span class="normal"><a href="#__codelineno-0-750"> 750</a></span>
<span class="normal"><a href="#__codelineno-0-751"> 751</a></span>
<span class="normal"><a href="#__codelineno-0-752"> 752</a></span>
<span class="normal"><a href="#__codelineno-0-753"> 753</a></span>
<span class="normal"><a href="#__codelineno-0-754"> 754</a></span>
<span class="normal"><a href="#__codelineno-0-755"> 755</a></span>
<span class="normal"><a href="#__codelineno-0-756"> 756</a></span>
<span class="normal"><a href="#__codelineno-0-757"> 757</a></span>
<span class="normal"><a href="#__codelineno-0-758"> 758</a></span>
<span class="normal"><a href="#__codelineno-0-759"> 759</a></span>
<span class="normal"><a href="#__codelineno-0-760"> 760</a></span>
<span class="normal"><a href="#__codelineno-0-761"> 761</a></span>
<span class="normal"><a href="#__codelineno-0-762"> 762</a></span>
<span class="normal"><a href="#__codelineno-0-763"> 763</a></span>
<span class="normal"><a href="#__codelineno-0-764"> 764</a></span>
<span class="normal"><a href="#__codelineno-0-765"> 765</a></span>
<span class="normal"><a href="#__codelineno-0-766"> 766</a></span>
<span class="normal"><a href="#__codelineno-0-767"> 767</a></span>
<span class="normal"><a href="#__codelineno-0-768"> 768</a></span>
<span class="normal"><a href="#__codelineno-0-769"> 769</a></span>
<span class="normal"><a href="#__codelineno-0-770"> 770</a></span>
<span class="normal"><a href="#__codelineno-0-771"> 771</a></span>
<span class="normal"><a href="#__codelineno-0-772"> 772</a></span>
<span class="normal"><a href="#__codelineno-0-773"> 773</a></span>
<span class="normal"><a href="#__codelineno-0-774"> 774</a></span>
<span class="normal"><a href="#__codelineno-0-775"> 775</a></span>
<span class="normal"><a href="#__codelineno-0-776"> 776</a></span>
<span class="normal"><a href="#__codelineno-0-777"> 777</a></span>
<span class="normal"><a href="#__codelineno-0-778"> 778</a></span>
<span class="normal"><a href="#__codelineno-0-779"> 779</a></span>
<span class="normal"><a href="#__codelineno-0-780"> 780</a></span>
<span class="normal"><a href="#__codelineno-0-781"> 781</a></span>
<span class="normal"><a href="#__codelineno-0-782"> 782</a></span>
<span class="normal"><a href="#__codelineno-0-783"> 783</a></span>
<span class="normal"><a href="#__codelineno-0-784"> 784</a></span>
<span class="normal"><a href="#__codelineno-0-785"> 785</a></span>
<span class="normal"><a href="#__codelineno-0-786"> 786</a></span>
<span class="normal"><a href="#__codelineno-0-787"> 787</a></span>
<span class="normal"><a href="#__codelineno-0-788"> 788</a></span>
<span class="normal"><a href="#__codelineno-0-789"> 789</a></span>
<span class="normal"><a href="#__codelineno-0-790"> 790</a></span>
<span class="normal"><a href="#__codelineno-0-791"> 791</a></span>
<span class="normal"><a href="#__codelineno-0-792"> 792</a></span>
<span class="normal"><a href="#__codelineno-0-793"> 793</a></span>
<span class="normal"><a href="#__codelineno-0-794"> 794</a></span>
<span class="normal"><a href="#__codelineno-0-795"> 795</a></span>
<span class="normal"><a href="#__codelineno-0-796"> 796</a></span>
<span class="normal"><a href="#__codelineno-0-797"> 797</a></span>
<span class="normal"><a href="#__codelineno-0-798"> 798</a></span>
<span class="normal"><a href="#__codelineno-0-799"> 799</a></span>
<span class="normal"><a href="#__codelineno-0-800"> 800</a></span>
<span class="normal"><a href="#__codelineno-0-801"> 801</a></span>
<span class="normal"><a href="#__codelineno-0-802"> 802</a></span>
<span class="normal"><a href="#__codelineno-0-803"> 803</a></span>
<span class="normal"><a href="#__codelineno-0-804"> 804</a></span>
<span class="normal"><a href="#__codelineno-0-805"> 805</a></span>
<span class="normal"><a href="#__codelineno-0-806"> 806</a></span>
<span class="normal"><a href="#__codelineno-0-807"> 807</a></span>
<span class="normal"><a href="#__codelineno-0-808"> 808</a></span>
<span class="normal"><a href="#__codelineno-0-809"> 809</a></span>
<span class="normal"><a href="#__codelineno-0-810"> 810</a></span>
<span class="normal"><a href="#__codelineno-0-811"> 811</a></span>
<span class="normal"><a href="#__codelineno-0-812"> 812</a></span>
<span class="normal"><a href="#__codelineno-0-813"> 813</a></span>
<span class="normal"><a href="#__codelineno-0-814"> 814</a></span>
<span class="normal"><a href="#__codelineno-0-815"> 815</a></span>
<span class="normal"><a href="#__codelineno-0-816"> 816</a></span>
<span class="normal"><a href="#__codelineno-0-817"> 817</a></span>
<span class="normal"><a href="#__codelineno-0-818"> 818</a></span>
<span class="normal"><a href="#__codelineno-0-819"> 819</a></span>
<span class="normal"><a href="#__codelineno-0-820"> 820</a></span>
<span class="normal"><a href="#__codelineno-0-821"> 821</a></span>
<span class="normal"><a href="#__codelineno-0-822"> 822</a></span>
<span class="normal"><a href="#__codelineno-0-823"> 823</a></span>
<span class="normal"><a href="#__codelineno-0-824"> 824</a></span>
<span class="normal"><a href="#__codelineno-0-825"> 825</a></span>
<span class="normal"><a href="#__codelineno-0-826"> 826</a></span>
<span class="normal"><a href="#__codelineno-0-827"> 827</a></span>
<span class="normal"><a href="#__codelineno-0-828"> 828</a></span>
<span class="normal"><a href="#__codelineno-0-829"> 829</a></span>
<span class="normal"><a href="#__codelineno-0-830"> 830</a></span>
<span class="normal"><a href="#__codelineno-0-831"> 831</a></span>
<span class="normal"><a href="#__codelineno-0-832"> 832</a></span>
<span class="normal"><a href="#__codelineno-0-833"> 833</a></span>
<span class="normal"><a href="#__codelineno-0-834"> 834</a></span>
<span class="normal"><a href="#__codelineno-0-835"> 835</a></span>
<span class="normal"><a href="#__codelineno-0-836"> 836</a></span>
<span class="normal"><a href="#__codelineno-0-837"> 837</a></span>
<span class="normal"><a href="#__codelineno-0-838"> 838</a></span>
<span class="normal"><a href="#__codelineno-0-839"> 839</a></span>
<span class="normal"><a href="#__codelineno-0-840"> 840</a></span>
<span class="normal"><a href="#__codelineno-0-841"> 841</a></span>
<span class="normal"><a href="#__codelineno-0-842"> 842</a></span>
<span class="normal"><a href="#__codelineno-0-843"> 843</a></span>
<span class="normal"><a href="#__codelineno-0-844"> 844</a></span>
<span class="normal"><a href="#__codelineno-0-845"> 845</a></span>
<span class="normal"><a href="#__codelineno-0-846"> 846</a></span>
<span class="normal"><a href="#__codelineno-0-847"> 847</a></span>
<span class="normal"><a href="#__codelineno-0-848"> 848</a></span>
<span class="normal"><a href="#__codelineno-0-849"> 849</a></span>
<span class="normal"><a href="#__codelineno-0-850"> 850</a></span>
<span class="normal"><a href="#__codelineno-0-851"> 851</a></span>
<span class="normal"><a href="#__codelineno-0-852"> 852</a></span>
<span class="normal"><a href="#__codelineno-0-853"> 853</a></span>
<span class="normal"><a href="#__codelineno-0-854"> 854</a></span>
<span class="normal"><a href="#__codelineno-0-855"> 855</a></span>
<span class="normal"><a href="#__codelineno-0-856"> 856</a></span>
<span class="normal"><a href="#__codelineno-0-857"> 857</a></span>
<span class="normal"><a href="#__codelineno-0-858"> 858</a></span>
<span class="normal"><a href="#__codelineno-0-859"> 859</a></span>
<span class="normal"><a href="#__codelineno-0-860"> 860</a></span>
<span class="normal"><a href="#__codelineno-0-861"> 861</a></span>
<span class="normal"><a href="#__codelineno-0-862"> 862</a></span>
<span class="normal"><a href="#__codelineno-0-863"> 863</a></span>
<span class="normal"><a href="#__codelineno-0-864"> 864</a></span>
<span class="normal"><a href="#__codelineno-0-865"> 865</a></span>
<span class="normal"><a href="#__codelineno-0-866"> 866</a></span>
<span class="normal"><a href="#__codelineno-0-867"> 867</a></span>
<span class="normal"><a href="#__codelineno-0-868"> 868</a></span>
<span class="normal"><a href="#__codelineno-0-869"> 869</a></span>
<span class="normal"><a href="#__codelineno-0-870"> 870</a></span>
<span class="normal"><a href="#__codelineno-0-871"> 871</a></span>
<span class="normal"><a href="#__codelineno-0-872"> 872</a></span>
<span class="normal"><a href="#__codelineno-0-873"> 873</a></span>
<span class="normal"><a href="#__codelineno-0-874"> 874</a></span>
<span class="normal"><a href="#__codelineno-0-875"> 875</a></span>
<span class="normal"><a href="#__codelineno-0-876"> 876</a></span>
<span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="k">class</span> <span class="nc">Loop</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">    Loop methods for backtest</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop_type</span><span class="p">:</span> <span class="n">LoopType</span> <span class="o">=</span> <span class="n">LoopType</span><span class="o">.</span><span class="n">CROSSOVER</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_loop_type</span> <span class="o">=</span> <span class="n">loop_type</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>    <span class="k">def</span> <span class="nf">loop_date</span><span class="p">(</span><span class="n">trade_method</span><span class="p">,</span> 
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>                  <span class="n">signal_table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>                  <span class="n">histroy_intraday_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>                  <span class="n">strategy_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;argus_exact&#39;</span><span class="p">,</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>                  <span class="n">open_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;0330&#39;</span><span class="p">,</span> <span class="n">close_hr</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;1930&#39;</span><span class="p">,</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>                  <span class="n">plot_or_not</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>                  <span class="n">sort_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Entry_Date&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">        Fast looping method that generate simple CSV output file.</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">        This loop is meant to be fast and only produce a </span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">        simple table, not a portfolio file.</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">        This loop assume trading one asset with a unique symbol.</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">        trade_method : TYPE</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">            Note that the method here only takes in trade functions from </span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">            simple_trade moudle.</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">        signal_table : pd.DataFrame</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">        histroy_intraday_data : pd.DataFrame</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="sd">        strategy_name : str, optional</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="sd">            DESCRIPTION. The default is &#39;argus_exact&#39;.</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a><span class="sd">        open_hr : str, optional</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">            DESCRIPTION. The default is &#39;0330&#39;.</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">        close_hr : str, optional</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">            DESCRIPTION. The default is &#39;1930&#39;.</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">        plot_or_not : bool, optional</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">            DESCRIPTION. The default is False.</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">        sort_by : str, optional</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">            DESCRIPTION. The default is &#39;Entry_Date&#39;.</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="sd">        ------</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">        Exception</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">        -------</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">        dict_trade_PNL : TYPE</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>        <span class="c1"># make bucket </span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>        <span class="n">book</span> <span class="o">=</span> <span class="n">Bookkeep</span><span class="p">(</span><span class="n">bucket_type</span><span class="o">=</span><span class="s1">&#39;backtest&#39;</span><span class="p">)</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>        <span class="n">dict_trade_PNL</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">make_bucket</span><span class="p">(</span><span class="n">keyword</span><span class="o">=</span><span class="n">strategy_name</span><span class="p">)</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>        <span class="n">trade_id</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">signal_table</span><span class="p">)):</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>            <span class="c1"># Inputs</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>            <span class="n">date_interest</span> <span class="o">=</span> <span class="n">signal_table</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>            <span class="n">direction</span> <span class="o">=</span> <span class="n">signal_table</span><span class="p">[</span><span class="s1">&#39;Direction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>            <span class="n">commodity_name</span> <span class="o">=</span> <span class="n">signal_table</span><span class="p">[</span><span class="s1">&#39;Commodity_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>            <span class="n">entry_price</span> <span class="o">=</span> <span class="n">signal_table</span><span class="p">[</span><span class="s1">&#39;Entry_Price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>            <span class="n">exit_price</span> <span class="o">=</span> <span class="n">signal_table</span><span class="p">[</span><span class="s1">&#39;Exit_Price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>            <span class="n">stoploss_price</span> <span class="o">=</span> <span class="n">signal_table</span><span class="p">[</span><span class="s1">&#39;StopLoss_Price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>            <span class="n">price_code</span> <span class="o">=</span> <span class="n">signal_table</span><span class="p">[</span><span class="s1">&#39;Price_Code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="n">full_contract_symbol</span> <span class="o">=</span> <span class="n">signal_table</span><span class="p">[</span><span class="s1">&#39;Contract_Month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>            <span class="n">strategy_name</span> <span class="o">=</span> <span class="n">signal_table</span><span class="p">[</span><span class="s1">&#39;strategy_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Buy&#39;</span><span class="p">:</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>                <span class="n">target_entry</span> <span class="o">=</span> <span class="n">entry_price</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>                <span class="n">target_exit</span> <span class="o">=</span> <span class="n">exit_price</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Sell&#39;</span><span class="p">:</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>                <span class="n">target_entry</span> <span class="o">=</span> <span class="n">entry_price</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>                <span class="n">target_exit</span> <span class="o">=</span> <span class="n">exit_price</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>                <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span><span class="p">,</span> <span class="s1">&#39;NA&#39;</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>            <span class="c1"># Define the date of interest by reading TimeStamp. </span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>            <span class="c1"># We may want to remake all this and make Timestamp the universal </span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>            <span class="c1"># parameter when dealing with time</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>            <span class="n">day</span> <span class="o">=</span> <span class="n">extract_intraday_minute_data</span><span class="p">(</span><span class="n">histroy_intraday_data</span><span class="p">,</span> <span class="n">date_interest</span><span class="p">,</span> 
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>                                               <span class="n">open_hr</span><span class="o">=</span><span class="n">open_hr</span><span class="p">,</span> <span class="n">close_hr</span><span class="o">=</span><span class="n">close_hr</span><span class="p">)</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>            <span class="c1">#print(day[&#39;Date&#39;].iloc[0], direction, target_entry, target_exit, stop_exit)</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>            <span class="n">open_hr_dt</span><span class="p">,</span> <span class="n">open_price</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_closest_price</span><span class="p">(</span><span class="n">day</span><span class="p">,</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>                                                               <span class="n">target_hr</span><span class="o">=</span> <span class="n">open_hr</span><span class="p">,</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>                                                               <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;forward&#39;</span><span class="p">)</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>            <span class="c1">#print(&#39;open&#39;,open_hr_dt, open_price)</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>            <span class="n">close_hr_dt</span><span class="p">,</span> <span class="n">close_price</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_closest_price</span><span class="p">(</span><span class="n">day</span><span class="p">,</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>                                                               <span class="n">target_hr</span><span class="o">=</span> <span class="n">close_hr</span><span class="p">,</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>                                                               <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">)</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>            <span class="c1">#print(&#39;close&#39;, close_hr_dt, close_price)</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>            <span class="c1"># make a dictionary for all the possible EES time and values</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>            <span class="n">EES_dict</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_minute_EES</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> 
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>                                            <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> <span class="n">stoploss_price</span><span class="p">,</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>                                            <span class="n">open_hr</span><span class="o">=</span><span class="n">open_hr_dt</span><span class="p">,</span> <span class="n">close_hr</span><span class="o">=</span><span class="n">close_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>                                            <span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="p">)</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>            <span class="c1"># make the trade.</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>            <span class="n">trade_open</span><span class="p">,</span> <span class="n">trade_close</span> <span class="o">=</span> <span class="n">trade_method</span><span class="p">(</span><span class="n">EES_dict</span><span class="p">)</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>            <span class="k">if</span> <span class="n">trade_open</span> <span class="o">!=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> <span class="ow">and</span> <span class="n">trade_close</span> <span class="o">==</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;trade WTF </span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trade_open</span><span class="p">,</span> <span class="n">trade_close</span><span class="p">))</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>           <span class="c1"># print(&#39;trade&#39;, trade_open, trade_close)</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>            <span class="n">entry_price</span><span class="p">,</span> <span class="n">entry_datetime</span> <span class="o">=</span> <span class="n">trade_open</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">trade_open</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>            <span class="n">exit_price</span><span class="p">,</span> <span class="n">exit_datetime</span> <span class="o">=</span> <span class="n">trade_close</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">trade_close</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>            <span class="c1"># calculate statistics EES_dict</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;Buy&quot;</span><span class="p">:</span> <span class="c1"># for buy, we are longing</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>                <span class="n">return_trades</span> <span class="o">=</span> <span class="n">exit_price</span> <span class="o">-</span> <span class="n">entry_price</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;Sell&quot;</span><span class="p">:</span> <span class="c1"># for sell, we are shorting</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>                <span class="n">return_trades</span> <span class="o">=</span> <span class="n">entry_price</span> <span class="o">-</span> <span class="n">exit_price</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>            <span class="c1"># The risk and reward ratio is based on Abbe&#39;s old script but it should be the sharpe ratio</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>            <span class="n">risk_reward_ratio</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">target_entry</span><span class="o">-</span><span class="n">stoploss_price</span><span class="p">)</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_entry</span><span class="o">-</span><span class="n">target_exit</span><span class="p">)</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>            <span class="c1"># put all the data in a singular list       </span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">trade_id</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">commodity_name</span><span class="p">,</span>  <span class="n">price_code</span><span class="p">,</span> 
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>                    <span class="n">full_contract_symbol</span><span class="p">,</span> 
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>                    <span class="n">date_interest</span><span class="p">,</span> <span class="n">entry_datetime</span><span class="p">,</span> <span class="n">entry_price</span><span class="p">,</span> 
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>                    <span class="n">date_interest</span><span class="p">,</span> <span class="n">exit_datetime</span><span class="p">,</span> <span class="n">exit_price</span><span class="p">,</span> 
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>                    <span class="n">return_trades</span><span class="p">,</span> <span class="n">risk_reward_ratio</span><span class="p">,</span> <span class="n">strategy_name</span><span class="p">]</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>            <span class="c1"># Storing the data    </span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>            <span class="n">dict_trade_PNL</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">store_to_bucket_single</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>            <span class="c1"># plotting mid-backtest</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>            <span class="n">plot_in_backtest</span><span class="p">(</span><span class="n">date_interest</span><span class="p">,</span> <span class="n">price_code</span><span class="p">,</span> <span class="n">EES_dict</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> 
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>                             <span class="n">plot_or_not</span><span class="o">=</span><span class="n">plot_or_not</span><span class="p">)</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>            <span class="n">trade_id</span> <span class="o">=</span> <span class="n">trade_id</span> <span class="o">+</span><span class="mi">1</span>       
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>            <span class="c1">#print(&#39;info&#39;, data)</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>        <span class="n">dict_trade_PNL</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dict_trade_PNL</span><span class="p">)</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>        <span class="c1">#sort by date</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>        <span class="n">dict_trade_PNL</span> <span class="o">=</span> <span class="n">dict_trade_PNL</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">sort_by</span><span class="p">)</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>        <span class="k">return</span> <span class="n">dict_trade_PNL</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>    <span class="k">def</span> <span class="nf">loop_date_portfolio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>                            <span class="n">portfo</span><span class="p">:</span> <span class="n">Portfolio</span><span class="p">,</span> 
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>                            <span class="n">trade_method</span><span class="p">:</span> <span class="n">Trade</span><span class="p">,</span> 
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>                            <span class="n">signal_table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>                            <span class="n">histroy_intraday_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>                            <span class="n">strategy_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;argus_exact&#39;</span><span class="p">,</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>                            <span class="n">give_obj_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;USD&quot;</span><span class="p">,</span> 
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>                            <span class="n">get_obj_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;CLc1&quot;</span><span class="p">,</span> 
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>                            <span class="n">get_obj_quantity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>                            <span class="n">open_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;0330&#39;</span><span class="p">,</span> <span class="n">close_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;1930&#39;</span><span class="p">,</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>                            <span class="n">plot_or_not</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a><span class="sd">        Portfolio module method. This method assume looping through using only</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a><span class="sd">        one unique asset.</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">signal_table</span><span class="p">)):</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>            <span class="n">item</span> <span class="o">=</span> <span class="n">signal_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>            <span class="n">price_code</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Price_Code&#39;</span><span class="p">]</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>            <span class="n">date_interest</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>            <span class="n">get_obj_name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Price_Code&#39;</span><span class="p">]</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>            <span class="c1"># Define the date of interest by reading TimeStamp. </span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>            <span class="c1"># We may want to remake all this and make Timestamp the universal </span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>            <span class="c1"># parameter when dealing with time</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>            <span class="n">day</span> <span class="o">=</span> <span class="n">extract_intraday_minute_data</span><span class="p">(</span><span class="n">histroy_intraday_data</span><span class="p">,</span> <span class="n">date_interest</span><span class="p">,</span> 
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>                                               <span class="n">open_hr</span><span class="o">=</span><span class="n">open_hr</span><span class="p">,</span> <span class="n">close_hr</span><span class="o">=</span><span class="n">close_hr</span><span class="p">)</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>            <span class="n">open_hr_dt</span><span class="p">,</span> <span class="n">open_price</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_closest_price</span><span class="p">(</span><span class="n">day</span><span class="p">,</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>                                                             <span class="n">target_hr</span><span class="o">=</span> <span class="n">open_hr</span><span class="p">,</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>                                                             <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;forward&#39;</span><span class="p">)</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">,</span><span class="n">open_hr_dt</span><span class="p">,</span> <span class="n">open_price</span><span class="p">)</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>            <span class="n">close_hr_dt</span><span class="p">,</span> <span class="n">close_price</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_closest_price</span><span class="p">(</span><span class="n">day</span><span class="p">,</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>                                                               <span class="n">target_hr</span><span class="o">=</span> <span class="n">close_hr</span><span class="p">,</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>                                                               <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">)</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="n">close_hr_dt</span><span class="p">,</span> <span class="n">close_price</span><span class="p">)</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;==================================&#39;</span><span class="p">)</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>            <span class="c1"># The main Trade function here</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>            <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> \
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>            <span class="n">stop_exit</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="n">load_EES_from_signal</span><span class="p">(</span><span class="n">trade_method</span><span class="p">,</span> 
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_loop_type</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>            <span class="c1"># Find the truncation dict and the modified target entry and exit</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>            <span class="n">trunc_dict</span><span class="p">,</span> \
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>            <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> <span class="n">stop_exit</span> <span class="o">=</span> <span class="n">gen_trunc_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop_type</span><span class="p">,</span> 
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>                                                                  <span class="n">day</span><span class="p">,</span> 
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>                                                                  <span class="n">target_entry</span><span class="p">,</span> 
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>                                                                  <span class="n">target_exit</span><span class="p">,</span> 
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>                                                                  <span class="n">stop_exit</span><span class="p">,</span> 
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>                                                                  <span class="n">open_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>                                                                  <span class="n">close_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>                                                                  <span class="n">direction</span><span class="p">)</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">day</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">direction</span><span class="p">,</span> <span class="n">target_entry</span><span class="p">,</span> \
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>                  <span class="n">target_exit</span><span class="p">,</span> <span class="n">stop_exit</span><span class="p">)</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>            <span class="c1"># Run the trade</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>            <span class="n">trade_open</span><span class="p">,</span> <span class="n">trade_close</span><span class="p">,</span> \
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>            <span class="n">pos</span><span class="p">,</span> <span class="n">exec_pos</span> <span class="o">=</span> <span class="n">trade_method</span><span class="p">(</span><span class="n">portfo</span><span class="p">,</span> <span class="n">trade_id</span> <span class="o">=</span><span class="n">i</span><span class="p">)</span><span class="o">.</span>\
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>                                                 <span class="n">run_trade</span><span class="p">(</span><span class="n">trunc_dict</span><span class="p">,</span> 
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>                                                           <span class="n">give_obj_name</span><span class="p">,</span> 
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>                                                           <span class="n">get_obj_name</span><span class="p">,</span> 
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>                                                           <span class="n">get_obj_quantity</span><span class="p">,</span> 
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>                                                           <span class="n">target_entry</span><span class="p">,</span> 
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>                                                           <span class="n">target_exit</span><span class="p">,</span> 
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>                                                           <span class="n">stop_exit</span><span class="p">,</span> 
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>                                                           <span class="n">open_hr</span> <span class="o">=</span> <span class="n">open_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>                                                           <span class="n">close_hr</span> <span class="o">=</span> <span class="n">close_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>                                                           <span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="p">,</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>                                                           <span class="n">fee</span><span class="o">=</span><span class="n">OIL_FUTURES_FEES</span><span class="p">[</span><span class="n">price_code</span><span class="p">],</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>                                                           <span class="n">open_time</span> <span class="o">=</span> <span class="n">open_hr_dt</span><span class="p">)</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>            <span class="c1"># plotting mid-backtest</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>            <span class="n">plot_in_backtest</span><span class="p">(</span><span class="n">date_interest</span><span class="p">,</span> <span class="n">price_code</span><span class="p">,</span> <span class="n">trunc_dict</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> 
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>                             <span class="n">plot_or_not</span><span class="o">=</span><span class="n">plot_or_not</span><span class="p">)</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>        <span class="k">return</span> <span class="n">portfo</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>    <span class="k">def</span> <span class="nf">loop_portfolio_preloaded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>                                  <span class="n">portfo</span><span class="p">:</span> <span class="n">Portfolio</span><span class="p">,</span> 
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>                                  <span class="n">trade_method</span><span class="p">,</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>                                  <span class="n">signal_table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>                                  <span class="n">histroy_intraday_data_pkl</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> 
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>                                  <span class="n">give_obj_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;USD&quot;</span><span class="p">,</span> 
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>                                  <span class="n">get_obj_quantity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>                                  <span class="n">open_hr_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">OPEN_HR_DICT</span><span class="p">,</span> 
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>                                  <span class="n">close_hr_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">CLOSE_HR_DICT</span><span class="p">,</span> 
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>                                  <span class="n">plot_or_not</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a><span class="sd">        A method that utilise one portfolio to run multi-asset backtest using </span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a><span class="sd">        preloaded data with multiple assets.</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">        portfo : Portfolio</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a><span class="sd">        trade_method : TYPE</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a><span class="sd">        signal_table : pd.DataFrame</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a><span class="sd">        histroy_intraday_data_pkl : TYPE</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a><span class="sd">        give_obj_name : str, optional</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a><span class="sd">            DESCRIPTION. The default is &quot;USD&quot;.</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a><span class="sd">        get_obj_quantity : int, optional</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a><span class="sd">            DESCRIPTION. The default is 1.</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a><span class="sd">        plot_or_not : bool, optional</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a><span class="sd">            DESCRIPTION. The default is False.</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a><span class="sd">        -------</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">        portfo : TYPE</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">signal_table</span><span class="p">)):</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>            <span class="c1"># setup trade inputs ###########</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>            <span class="n">item</span> <span class="o">=</span> <span class="n">signal_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>            <span class="n">symbol</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Price_Code&#39;</span><span class="p">]</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>            <span class="n">date_interest</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>            <span class="n">get_obj_name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Price_Code&#39;</span><span class="p">]</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>            <span class="n">open_hr</span> <span class="o">=</span> <span class="n">open_hr_dict</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>            <span class="n">close_hr</span> <span class="o">=</span> <span class="n">close_hr_dict</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>            <span class="n">histroy_intraday_data</span> <span class="o">=</span> <span class="n">histroy_intraday_data_pkl</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>            <span class="n">day</span> <span class="o">=</span> <span class="n">extract_intraday_minute_data</span><span class="p">(</span><span class="n">histroy_intraday_data</span><span class="p">,</span> 
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>                                               <span class="n">date_interest</span><span class="p">,</span> 
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>                                               <span class="n">open_hr</span><span class="o">=</span><span class="n">open_hr</span><span class="p">,</span> 
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>                                               <span class="n">close_hr</span><span class="o">=</span><span class="n">close_hr</span><span class="p">)</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>            <span class="n">open_hr_dt</span><span class="p">,</span> <span class="n">open_price</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_closest_price</span><span class="p">(</span><span class="n">day</span><span class="p">,</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>                                                             <span class="n">target_hr</span><span class="o">=</span> <span class="n">open_hr</span><span class="p">,</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>                                                             <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;forward&#39;</span><span class="p">)</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>            <span class="n">close_hr_dt</span><span class="p">,</span> <span class="n">close_price</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_closest_price</span><span class="p">(</span><span class="n">day</span><span class="p">,</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>                                                               <span class="n">target_hr</span><span class="o">=</span> <span class="n">close_hr</span><span class="p">,</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>                                                               <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">)</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>            <span class="c1"># The time to open all positions</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>            <span class="n">pos_open_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">date_interest</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">open_hr_dt</span><span class="p">)</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>            <span class="c1"># Setup trade ##########</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>            <span class="n">trade_id</span> <span class="o">=</span> <span class="n">i</span> <span class="c1">#direction + str(i)</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>            <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> \
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>            <span class="n">stop_exit</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="n">load_EES_from_signal</span><span class="p">(</span><span class="n">trade_method</span><span class="p">,</span> 
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_loop_type</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">pos_open_dt</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>            <span class="c1">#print(self._loop_type, day, target_entry,</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>            <span class="c1">#      target_exit, stop_exit, open_hr_dt, close_hr_dt, direction)</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>            <span class="c1"># Find the truncation dict and the modified target entry and exit</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>            <span class="n">trunc_dict</span><span class="p">,</span> \
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>            <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> <span class="n">stop_exit</span> <span class="o">=</span> <span class="n">gen_trunc_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop_type</span><span class="p">,</span> 
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>                                                                  <span class="n">day</span><span class="p">,</span> 
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>                                                                  <span class="n">target_entry</span><span class="p">,</span> 
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>                                                                  <span class="n">target_exit</span><span class="p">,</span> 
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>                                                                  <span class="n">stop_exit</span><span class="p">,</span> 
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>                                                                  <span class="n">open_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>                                                                  <span class="n">close_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>                                                                  <span class="n">direction</span><span class="p">)</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>            <span class="c1"># Run the trade itself</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>            <span class="n">trade_open</span><span class="p">,</span> <span class="n">trade_close</span><span class="p">,</span> \
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>            <span class="n">pos</span><span class="p">,</span> <span class="n">exec_pos</span> <span class="o">=</span> <span class="n">trade_method</span><span class="p">(</span><span class="n">portfo</span><span class="p">,</span> <span class="n">trade_id</span> <span class="o">=</span> <span class="n">trade_id</span><span class="p">)</span><span class="o">.</span>\
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>                                                 <span class="n">run_trade</span><span class="p">(</span><span class="n">trunc_dict</span><span class="p">,</span> 
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>                                                           <span class="n">give_obj_name</span><span class="p">,</span> 
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>                                                           <span class="n">get_obj_name</span><span class="p">,</span> 
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>                                                           <span class="n">get_obj_quantity</span><span class="p">,</span> 
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>                                                           <span class="n">target_entry</span><span class="p">,</span> 
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>                                                           <span class="n">target_exit</span><span class="p">,</span> 
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>                                                           <span class="n">stop_exit</span><span class="p">,</span> 
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>                                                           <span class="n">open_hr</span> <span class="o">=</span> <span class="n">open_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>                                                           <span class="n">close_hr</span><span class="o">=</span><span class="n">close_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>                                                           <span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="p">,</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>                                                           <span class="n">fee</span><span class="o">=</span><span class="n">OIL_FUTURES_FEES</span><span class="p">[</span><span class="n">symbol</span><span class="p">],</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>                                                           <span class="n">open_time</span><span class="o">=</span> <span class="n">pos_open_dt</span><span class="p">)</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>            <span class="c1"># plotting mid-backtest</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>            <span class="n">plot_in_backtest</span><span class="p">(</span><span class="n">date_interest</span><span class="p">,</span><span class="n">get_obj_name</span><span class="p">,</span> <span class="n">trunc_dict</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> 
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>                             <span class="n">plot_or_not</span><span class="o">=</span><span class="n">plot_or_not</span><span class="p">)</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>        <span class="k">return</span> <span class="n">portfo</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>    <span class="k">def</span> <span class="nf">loop_portfolio_preloaded_long</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>                                  <span class="n">portfo</span><span class="p">:</span> <span class="n">Portfolio</span><span class="p">,</span> 
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>                                  <span class="n">trade_method</span><span class="p">,</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>                                  <span class="n">signal_table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>                                  <span class="n">histroy_intraday_data_pkl</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> 
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>                                  <span class="n">histroy_minute_cumavg_data_pkl</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> 
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>                                  <span class="n">give_obj_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;USD&quot;</span><span class="p">,</span> 
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>                                  <span class="n">get_obj_quantity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>                                  <span class="n">open_hr_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">OPEN_HR_DICT</span><span class="p">,</span> 
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>                                  <span class="n">close_hr_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">CLOSE_HR_DICT</span><span class="p">,</span> 
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>                                  <span class="n">plot_or_not</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a><span class="sd">        A method that utilise one portfolio to run multi-asset backtest using </span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a><span class="sd">        preloaded data with multiple assets.</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a><span class="sd">        portfo : Portfolio</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a><span class="sd">        trade_method : TYPE</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a><span class="sd">        signal_table : pd.DataFrame</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a><span class="sd">        histroy_intraday_data_pkl : TYPE</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a><span class="sd">        give_obj_name : str, optional</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a><span class="sd">            DESCRIPTION. The default is &quot;USD&quot;.</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a><span class="sd">        get_obj_quantity : int, optional</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a><span class="sd">            DESCRIPTION. The default is 1.</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a><span class="sd">        plot_or_not : bool, optional</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a><span class="sd">            DESCRIPTION. The default is False.</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a><span class="sd">        -------</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a><span class="sd">        portfo : TYPE</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a><span class="c1"># =============================================================================</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a><span class="c1">#         </span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a><span class="c1">#         #print(&#39;histroy_minute_cumavg_data_pkl&#39;, histroy_minute_cumavg_data_pkl)</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a><span class="c1">#         first_entry = signal_table.iloc[0]</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a><span class="c1">#         </span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a><span class="c1">#         first_symbol = first_entry[&#39;Price_Code&#39;]</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a><span class="c1">#         month = extract_month_minute_data(histroy_intraday_data_pkl[first_symbol],</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a><span class="c1">#                                           first_entry[&#39;Date&#39;],</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a><span class="c1">#                                           open_hr=open_hr_dict[first_symbol], </span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a><span class="c1">#                                           close_hr=close_hr_dict[first_symbol])</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a><span class="c1">#         </span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a><span class="c1">#         </span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a><span class="c1">#         histroy_minute_cumavg_data = histroy_minute_cumavg_data_pkl[first_symbol]</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a><span class="c1"># =============================================================================</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>        <span class="c1">#print(&quot;signal_table&quot;, signal_table)</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>        <span class="c1"># Initialise month_tracker using the first entry</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>        <span class="c1">#month_tracker = first_entry[&#39;Date&#39;].month</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">signal_table</span><span class="p">)):</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>            <span class="c1"># setup trade inputs ###########</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>            <span class="n">item</span> <span class="o">=</span> <span class="n">signal_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>            <span class="c1">#print(item)</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>            <span class="n">symbol</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Price_Code&#39;</span><span class="p">]</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>            <span class="n">date_interest</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>            <span class="n">get_obj_name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Price_Code&#39;</span><span class="p">]</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>            <span class="n">open_hr</span> <span class="o">=</span> <span class="n">open_hr_dict</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>            <span class="n">close_hr</span> <span class="o">=</span> <span class="n">close_hr_dict</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>            <span class="c1">#histroy_intraday_data = histroy_intraday_data_pkl[symbol]</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>            <span class="n">histroy_minute_cumavg_data</span> <span class="o">=</span> <span class="n">histroy_minute_cumavg_data_pkl</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>            <span class="n">current_month</span> <span class="o">=</span> <span class="n">date_interest</span><span class="o">.</span><span class="n">month</span>    
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">current_month</span> <span class="p">,</span> <span class="n">date_interest</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a><span class="c1"># =============================================================================</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="c1">#             month = extract_month_minute_data(histroy_intraday_data, </span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="c1">#                                               date_interest,</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a><span class="c1">#                                               open_hr=open_hr, </span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a><span class="c1">#                                               close_hr=close_hr)</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a><span class="c1">#             </span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a><span class="c1"># =============================================================================</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>            <span class="n">minute_cumavg_data</span> <span class="o">=</span> <span class="n">extract_month_minute_data</span><span class="p">(</span><span class="n">histroy_minute_cumavg_data</span><span class="p">,</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>                                                           <span class="n">date_interest</span><span class="p">,</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>                                                           <span class="n">open_hr</span><span class="o">=</span><span class="n">open_hr</span><span class="p">,</span> 
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>                                                           <span class="n">close_hr</span><span class="o">=</span><span class="n">close_hr</span><span class="p">)</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;minute_cumavg_data&#39;</span><span class="p">,</span> <span class="n">minute_cumavg_data</span><span class="p">)</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>            <span class="c1"># ^ really fast, not a problem here</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>            <span class="c1">#if current_month!= month_tracker:</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>                <span class="c1"># If the current month is not the same as the tracker, we</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>                <span class="c1"># load the data from the next month and update the tracker</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>            <span class="c1">#    month_tracker = current_month</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a><span class="c1"># =============================================================================</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a><span class="c1">#             day = extract_intraday_minute_data(histroy_intraday_data, </span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a><span class="c1">#                                                date_interest, </span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a><span class="c1">#                                                open_hr=open_hr, </span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a><span class="c1">#                                                close_hr=close_hr)</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a><span class="c1"># =============================================================================</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>            <span class="c1">#print(&quot;month&quot;, month, &#39;day&#39;,day)</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>            <span class="n">first_date</span> <span class="o">=</span> <span class="n">minute_cumavg_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>            <span class="n">last_date</span> <span class="o">=</span> <span class="n">minute_cumavg_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;first_date&#39;</span><span class="p">,</span> <span class="s1">&#39;last_date&#39;</span><span class="p">,</span> <span class="n">first_date</span><span class="p">,</span> <span class="n">last_date</span><span class="p">)</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>            <span class="n">open_hr_dt</span><span class="p">,</span> <span class="n">open_price</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_closest_price_datetime</span><span class="p">(</span><span class="n">minute_cumavg_data</span><span class="p">,</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>                                                                      <span class="n">first_date</span><span class="p">,</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>                                                                      <span class="n">target_hr</span><span class="o">=</span> <span class="n">open_hr</span><span class="p">,</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>                                                                      <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;forward&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>                                                                      <span class="n">price_proxy</span><span class="o">=</span><span class="s1">&#39;today_cum_avg&#39;</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>                                                                      <span class="p">)</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>            <span class="n">close_hr_dt</span><span class="p">,</span> <span class="n">close_price</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_closest_price_datetime</span><span class="p">(</span><span class="n">minute_cumavg_data</span><span class="p">,</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>                                                                        <span class="n">last_date</span><span class="p">,</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>                                                                        <span class="n">target_hr</span><span class="o">=</span> <span class="n">close_hr</span><span class="p">,</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>                                                                        <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>                                                                        <span class="n">price_proxy</span><span class="o">=</span><span class="s1">&#39;today_cum_avg&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>            <span class="c1"># ^ tested these two they also ran fast</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>            <span class="c1"># The time to open all positions</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>            <span class="c1"># This may not be straightly accurate but this varaible is only </span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>            <span class="c1"># for record keeping. it is similar to the real value</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>            <span class="n">pos_open_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">date_interest</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">open_hr_dt</span><span class="p">)</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>            <span class="c1"># Setup trade ##########</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>            <span class="n">trade_id</span> <span class="o">=</span> <span class="n">i</span> <span class="c1">#direction + str(i)</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>            <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> \
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>            <span class="n">stop_exit</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="n">load_EES_from_signal</span><span class="p">(</span><span class="n">trade_method</span><span class="p">,</span> 
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_loop_type</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">pos_open_dt</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>            <span class="c1">#print(self._loop_type, day, target_entry,</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>            <span class="c1">#      target_exit, stop_exit, open_hr_dt, close_hr_dt, direction)</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>            <span class="c1"># Find the truncation dict and the modified target entry and exit</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>            <span class="n">trunc_dict</span><span class="p">,</span> \
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>            <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> <span class="n">stop_exit</span> <span class="o">=</span> <span class="n">gen_trunc_dict_long</span><span class="p">(</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>                                                                <span class="bp">self</span><span class="o">.</span><span class="n">_loop_type</span><span class="p">,</span> 
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>                                                                <span class="n">minute_cumavg_data</span><span class="p">,</span> 
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>                                                                <span class="n">target_entry</span><span class="p">,</span> 
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>                                                                <span class="n">target_exit</span><span class="p">,</span> 
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>                                                                <span class="n">stop_exit</span><span class="p">,</span> 
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>                                                                <span class="n">open_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>                                                                <span class="n">close_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>                                                                <span class="n">direction</span><span class="p">)</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;trunc_dict&quot;</span><span class="p">,</span> <span class="n">trunc_dict</span><span class="p">)</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> <span class="n">stop_exit</span><span class="p">)</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>            <span class="c1"># Run the trade itself</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>            <span class="n">trade_open</span><span class="p">,</span> <span class="n">trade_close</span><span class="p">,</span> \
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>            <span class="n">pos</span><span class="p">,</span> <span class="n">exec_pos</span> <span class="o">=</span> <span class="n">trade_method</span><span class="p">(</span><span class="n">portfo</span><span class="p">,</span> <span class="n">trade_id</span> <span class="o">=</span> <span class="n">trade_id</span><span class="p">)</span><span class="o">.</span>\
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>                                                 <span class="n">run_trade</span><span class="p">(</span><span class="n">trunc_dict</span><span class="p">,</span> 
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>                                                           <span class="n">give_obj_name</span><span class="p">,</span> 
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>                                                           <span class="n">get_obj_name</span><span class="p">,</span> 
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>                                                           <span class="n">get_obj_quantity</span><span class="p">,</span> 
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>                                                           <span class="n">target_entry</span><span class="p">,</span> 
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>                                                           <span class="n">target_exit</span><span class="p">,</span> 
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>                                                           <span class="n">stop_exit</span><span class="p">,</span> 
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>                                                           <span class="n">open_hr</span> <span class="o">=</span> <span class="n">open_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>                                                           <span class="n">close_hr</span><span class="o">=</span><span class="n">close_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>                                                           <span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="p">,</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>                                                           <span class="n">fee</span><span class="o">=</span><span class="n">OIL_FUTURES_FEES</span><span class="p">[</span><span class="n">symbol</span><span class="p">],</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>                                                           <span class="n">open_time</span><span class="o">=</span> <span class="n">pos_open_dt</span><span class="p">)</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>            <span class="c1"># plotting mid-backtest</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>            <span class="n">plot_in_backtest</span><span class="p">(</span><span class="n">date_interest</span><span class="p">,</span><span class="n">get_obj_name</span><span class="p">,</span> <span class="n">trunc_dict</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> 
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>                             <span class="n">plot_or_not</span><span class="o">=</span><span class="n">plot_or_not</span><span class="p">)</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>        <span class="k">return</span> <span class="n">portfo</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="EC_tools.backtest.Loop.loop_date" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">loop_date</span><span class="p">(</span><span class="n">trade_method</span><span class="p">,</span> <span class="n">signal_table</span><span class="p">,</span> <span class="n">histroy_intraday_data</span><span class="p">,</span> <span class="n">strategy_name</span><span class="o">=</span><span class="s1">&#39;argus_exact&#39;</span><span class="p">,</span> <span class="n">open_hr</span><span class="o">=</span><span class="s1">&#39;0330&#39;</span><span class="p">,</span> <span class="n">close_hr</span><span class="o">=</span><span class="s1">&#39;1930&#39;</span><span class="p">,</span> <span class="n">plot_or_not</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s1">&#39;Entry_Date&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Fast looping method that generate simple CSV output file.
This loop is meant to be fast and only produce a 
simple table, not a portfolio file.</p>
<p>This loop assume trading one asset with a unique symbol.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>trade_method</code></b>
                  (<code>TYPE</code>)
              
              <div class="doc-md-description">
                <p>Note that the method here only takes in trade functions from 
simple_trade moudle.</p>
              </div>
            </li>
            <li>
              <b><code>signal_table</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>histroy_intraday_data</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>strategy_name</code></b>
                  (<code>str</code>, default:
                      <code>&#39;argus_exact&#39;</code>
)
              
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is 'argus_exact'.</p>
              </div>
            </li>
            <li>
              <b><code>open_hr</code></b>
                  (<code>str</code>, default:
                      <code>&#39;0330&#39;</code>
)
              
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is '0330'.</p>
              </div>
            </li>
            <li>
              <b><code>close_hr</code></b>
                  (<code>str</code>, default:
                      <code>&#39;1930&#39;</code>
)
              
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is '1930'.</p>
              </div>
            </li>
            <li>
              <b><code>plot_or_not</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is False.</p>
              </div>
            </li>
            <li>
              <b><code>sort_by</code></b>
                  (<code>str</code>, default:
                      <code>&#39;Entry_Date&#39;</code>
)
              
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is 'Entry_Date'.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>Exception</code>
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>dict_trade_PNL</code></b>(                  <code>TYPE</code>
)              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/backtest.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="k">def</span> <span class="nf">loop_date</span><span class="p">(</span><span class="n">trade_method</span><span class="p">,</span> 
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>              <span class="n">signal_table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>              <span class="n">histroy_intraday_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>              <span class="n">strategy_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;argus_exact&#39;</span><span class="p">,</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>              <span class="n">open_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;0330&#39;</span><span class="p">,</span> <span class="n">close_hr</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;1930&#39;</span><span class="p">,</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>              <span class="n">plot_or_not</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>              <span class="n">sort_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Entry_Date&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">    Fast looping method that generate simple CSV output file.</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">    This loop is meant to be fast and only produce a </span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">    simple table, not a portfolio file.</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">    This loop assume trading one asset with a unique symbol.</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">    trade_method : TYPE</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">        Note that the method here only takes in trade functions from </span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">        simple_trade moudle.</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">    signal_table : pd.DataFrame</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">    histroy_intraday_data : pd.DataFrame</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="sd">    strategy_name : str, optional</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="sd">        DESCRIPTION. The default is &#39;argus_exact&#39;.</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a><span class="sd">    open_hr : str, optional</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">        DESCRIPTION. The default is &#39;0330&#39;.</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">    close_hr : str, optional</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">        DESCRIPTION. The default is &#39;1930&#39;.</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">    plot_or_not : bool, optional</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">        DESCRIPTION. The default is False.</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">    sort_by : str, optional</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">        DESCRIPTION. The default is &#39;Entry_Date&#39;.</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="sd">    ------</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">    Exception</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">    -------</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">    dict_trade_PNL : TYPE</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>    <span class="c1"># make bucket </span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>    <span class="n">book</span> <span class="o">=</span> <span class="n">Bookkeep</span><span class="p">(</span><span class="n">bucket_type</span><span class="o">=</span><span class="s1">&#39;backtest&#39;</span><span class="p">)</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>    <span class="n">dict_trade_PNL</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">make_bucket</span><span class="p">(</span><span class="n">keyword</span><span class="o">=</span><span class="n">strategy_name</span><span class="p">)</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>    <span class="n">trade_id</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">signal_table</span><span class="p">)):</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>        <span class="c1"># Inputs</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>        <span class="n">date_interest</span> <span class="o">=</span> <span class="n">signal_table</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>        <span class="n">direction</span> <span class="o">=</span> <span class="n">signal_table</span><span class="p">[</span><span class="s1">&#39;Direction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>        <span class="n">commodity_name</span> <span class="o">=</span> <span class="n">signal_table</span><span class="p">[</span><span class="s1">&#39;Commodity_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>        <span class="n">entry_price</span> <span class="o">=</span> <span class="n">signal_table</span><span class="p">[</span><span class="s1">&#39;Entry_Price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="n">exit_price</span> <span class="o">=</span> <span class="n">signal_table</span><span class="p">[</span><span class="s1">&#39;Exit_Price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>        <span class="n">stoploss_price</span> <span class="o">=</span> <span class="n">signal_table</span><span class="p">[</span><span class="s1">&#39;StopLoss_Price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>        <span class="n">price_code</span> <span class="o">=</span> <span class="n">signal_table</span><span class="p">[</span><span class="s1">&#39;Price_Code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>        <span class="n">full_contract_symbol</span> <span class="o">=</span> <span class="n">signal_table</span><span class="p">[</span><span class="s1">&#39;Contract_Month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>        <span class="n">strategy_name</span> <span class="o">=</span> <span class="n">signal_table</span><span class="p">[</span><span class="s1">&#39;strategy_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Buy&#39;</span><span class="p">:</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>            <span class="n">target_entry</span> <span class="o">=</span> <span class="n">entry_price</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>            <span class="n">target_exit</span> <span class="o">=</span> <span class="n">exit_price</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Sell&#39;</span><span class="p">:</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>            <span class="n">target_entry</span> <span class="o">=</span> <span class="n">entry_price</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>            <span class="n">target_exit</span> <span class="o">=</span> <span class="n">exit_price</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>            <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span><span class="p">,</span> <span class="s1">&#39;NA&#39;</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>        <span class="c1"># Define the date of interest by reading TimeStamp. </span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>        <span class="c1"># We may want to remake all this and make Timestamp the universal </span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>        <span class="c1"># parameter when dealing with time</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>        <span class="n">day</span> <span class="o">=</span> <span class="n">extract_intraday_minute_data</span><span class="p">(</span><span class="n">histroy_intraday_data</span><span class="p">,</span> <span class="n">date_interest</span><span class="p">,</span> 
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>                                           <span class="n">open_hr</span><span class="o">=</span><span class="n">open_hr</span><span class="p">,</span> <span class="n">close_hr</span><span class="o">=</span><span class="n">close_hr</span><span class="p">)</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>        <span class="c1">#print(day[&#39;Date&#39;].iloc[0], direction, target_entry, target_exit, stop_exit)</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>        <span class="n">open_hr_dt</span><span class="p">,</span> <span class="n">open_price</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_closest_price</span><span class="p">(</span><span class="n">day</span><span class="p">,</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>                                                           <span class="n">target_hr</span><span class="o">=</span> <span class="n">open_hr</span><span class="p">,</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>                                                           <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;forward&#39;</span><span class="p">)</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>        <span class="c1">#print(&#39;open&#39;,open_hr_dt, open_price)</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>        <span class="n">close_hr_dt</span><span class="p">,</span> <span class="n">close_price</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_closest_price</span><span class="p">(</span><span class="n">day</span><span class="p">,</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>                                                           <span class="n">target_hr</span><span class="o">=</span> <span class="n">close_hr</span><span class="p">,</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>                                                           <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">)</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>        <span class="c1">#print(&#39;close&#39;, close_hr_dt, close_price)</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>        <span class="c1"># make a dictionary for all the possible EES time and values</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>        <span class="n">EES_dict</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_minute_EES</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> 
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>                                        <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> <span class="n">stoploss_price</span><span class="p">,</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>                                        <span class="n">open_hr</span><span class="o">=</span><span class="n">open_hr_dt</span><span class="p">,</span> <span class="n">close_hr</span><span class="o">=</span><span class="n">close_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>                                        <span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="p">)</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>        <span class="c1"># make the trade.</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>        <span class="n">trade_open</span><span class="p">,</span> <span class="n">trade_close</span> <span class="o">=</span> <span class="n">trade_method</span><span class="p">(</span><span class="n">EES_dict</span><span class="p">)</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>        <span class="k">if</span> <span class="n">trade_open</span> <span class="o">!=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> <span class="ow">and</span> <span class="n">trade_close</span> <span class="o">==</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;trade WTF </span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trade_open</span><span class="p">,</span> <span class="n">trade_close</span><span class="p">))</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>       <span class="c1"># print(&#39;trade&#39;, trade_open, trade_close)</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>        <span class="n">entry_price</span><span class="p">,</span> <span class="n">entry_datetime</span> <span class="o">=</span> <span class="n">trade_open</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">trade_open</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>        <span class="n">exit_price</span><span class="p">,</span> <span class="n">exit_datetime</span> <span class="o">=</span> <span class="n">trade_close</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">trade_close</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>        <span class="c1"># calculate statistics EES_dict</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;Buy&quot;</span><span class="p">:</span> <span class="c1"># for buy, we are longing</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>            <span class="n">return_trades</span> <span class="o">=</span> <span class="n">exit_price</span> <span class="o">-</span> <span class="n">entry_price</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;Sell&quot;</span><span class="p">:</span> <span class="c1"># for sell, we are shorting</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>            <span class="n">return_trades</span> <span class="o">=</span> <span class="n">entry_price</span> <span class="o">-</span> <span class="n">exit_price</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>        <span class="c1"># The risk and reward ratio is based on Abbe&#39;s old script but it should be the sharpe ratio</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>        <span class="n">risk_reward_ratio</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">target_entry</span><span class="o">-</span><span class="n">stoploss_price</span><span class="p">)</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">target_entry</span><span class="o">-</span><span class="n">target_exit</span><span class="p">)</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>        <span class="c1"># put all the data in a singular list       </span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">trade_id</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">commodity_name</span><span class="p">,</span>  <span class="n">price_code</span><span class="p">,</span> 
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>                <span class="n">full_contract_symbol</span><span class="p">,</span> 
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>                <span class="n">date_interest</span><span class="p">,</span> <span class="n">entry_datetime</span><span class="p">,</span> <span class="n">entry_price</span><span class="p">,</span> 
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>                <span class="n">date_interest</span><span class="p">,</span> <span class="n">exit_datetime</span><span class="p">,</span> <span class="n">exit_price</span><span class="p">,</span> 
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>                <span class="n">return_trades</span><span class="p">,</span> <span class="n">risk_reward_ratio</span><span class="p">,</span> <span class="n">strategy_name</span><span class="p">]</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>        <span class="c1"># Storing the data    </span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>        <span class="n">dict_trade_PNL</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">store_to_bucket_single</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>        <span class="c1"># plotting mid-backtest</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>        <span class="n">plot_in_backtest</span><span class="p">(</span><span class="n">date_interest</span><span class="p">,</span> <span class="n">price_code</span><span class="p">,</span> <span class="n">EES_dict</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> 
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>                         <span class="n">plot_or_not</span><span class="o">=</span><span class="n">plot_or_not</span><span class="p">)</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>        <span class="n">trade_id</span> <span class="o">=</span> <span class="n">trade_id</span> <span class="o">+</span><span class="mi">1</span>       
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>        <span class="c1">#print(&#39;info&#39;, data)</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>    <span class="n">dict_trade_PNL</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dict_trade_PNL</span><span class="p">)</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>    <span class="c1">#sort by date</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>    <span class="n">dict_trade_PNL</span> <span class="o">=</span> <span class="n">dict_trade_PNL</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">sort_by</span><span class="p">)</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>    <span class="k">return</span> <span class="n">dict_trade_PNL</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="EC_tools.backtest.Loop.loop_date_portfolio" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">loop_date_portfolio</span><span class="p">(</span><span class="n">portfo</span><span class="p">,</span> <span class="n">trade_method</span><span class="p">,</span> <span class="n">signal_table</span><span class="p">,</span> <span class="n">histroy_intraday_data</span><span class="p">,</span> <span class="n">strategy_name</span><span class="o">=</span><span class="s1">&#39;argus_exact&#39;</span><span class="p">,</span> <span class="n">give_obj_name</span><span class="o">=</span><span class="s1">&#39;USD&#39;</span><span class="p">,</span> <span class="n">get_obj_name</span><span class="o">=</span><span class="s1">&#39;CLc1&#39;</span><span class="p">,</span> <span class="n">get_obj_quantity</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">open_hr</span><span class="o">=</span><span class="s1">&#39;0330&#39;</span><span class="p">,</span> <span class="n">close_hr</span><span class="o">=</span><span class="s1">&#39;1930&#39;</span><span class="p">,</span> <span class="n">plot_or_not</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Portfolio module method. This method assume looping through using only
one unique asset.</p>

            <details class="quote">
              <summary>Source code in <code>EC_tools/backtest.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="k">def</span> <span class="nf">loop_date_portfolio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>                        <span class="n">portfo</span><span class="p">:</span> <span class="n">Portfolio</span><span class="p">,</span> 
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>                        <span class="n">trade_method</span><span class="p">:</span> <span class="n">Trade</span><span class="p">,</span> 
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>                        <span class="n">signal_table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>                        <span class="n">histroy_intraday_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>                        <span class="n">strategy_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;argus_exact&#39;</span><span class="p">,</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>                        <span class="n">give_obj_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;USD&quot;</span><span class="p">,</span> 
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>                        <span class="n">get_obj_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;CLc1&quot;</span><span class="p">,</span> 
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>                        <span class="n">get_obj_quantity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>                        <span class="n">open_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;0330&#39;</span><span class="p">,</span> <span class="n">close_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;1930&#39;</span><span class="p">,</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>                        <span class="n">plot_or_not</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a><span class="sd">    Portfolio module method. This method assume looping through using only</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a><span class="sd">    one unique asset.</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">signal_table</span><span class="p">)):</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>        <span class="n">item</span> <span class="o">=</span> <span class="n">signal_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>        <span class="n">price_code</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Price_Code&#39;</span><span class="p">]</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>        <span class="n">date_interest</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>        <span class="n">get_obj_name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Price_Code&#39;</span><span class="p">]</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>        <span class="c1"># Define the date of interest by reading TimeStamp. </span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>        <span class="c1"># We may want to remake all this and make Timestamp the universal </span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>        <span class="c1"># parameter when dealing with time</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>        <span class="n">day</span> <span class="o">=</span> <span class="n">extract_intraday_minute_data</span><span class="p">(</span><span class="n">histroy_intraday_data</span><span class="p">,</span> <span class="n">date_interest</span><span class="p">,</span> 
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>                                           <span class="n">open_hr</span><span class="o">=</span><span class="n">open_hr</span><span class="p">,</span> <span class="n">close_hr</span><span class="o">=</span><span class="n">close_hr</span><span class="p">)</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>        <span class="n">open_hr_dt</span><span class="p">,</span> <span class="n">open_price</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_closest_price</span><span class="p">(</span><span class="n">day</span><span class="p">,</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>                                                         <span class="n">target_hr</span><span class="o">=</span> <span class="n">open_hr</span><span class="p">,</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>                                                         <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;forward&#39;</span><span class="p">)</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">,</span><span class="n">open_hr_dt</span><span class="p">,</span> <span class="n">open_price</span><span class="p">)</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>        <span class="n">close_hr_dt</span><span class="p">,</span> <span class="n">close_price</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_closest_price</span><span class="p">(</span><span class="n">day</span><span class="p">,</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>                                                           <span class="n">target_hr</span><span class="o">=</span> <span class="n">close_hr</span><span class="p">,</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>                                                           <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">)</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="n">close_hr_dt</span><span class="p">,</span> <span class="n">close_price</span><span class="p">)</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;==================================&#39;</span><span class="p">)</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>        <span class="c1"># The main Trade function here</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>        <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> \
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>        <span class="n">stop_exit</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="n">load_EES_from_signal</span><span class="p">(</span><span class="n">trade_method</span><span class="p">,</span> 
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">_loop_type</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>        <span class="c1"># Find the truncation dict and the modified target entry and exit</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>        <span class="n">trunc_dict</span><span class="p">,</span> \
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>        <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> <span class="n">stop_exit</span> <span class="o">=</span> <span class="n">gen_trunc_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop_type</span><span class="p">,</span> 
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>                                                              <span class="n">day</span><span class="p">,</span> 
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>                                                              <span class="n">target_entry</span><span class="p">,</span> 
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>                                                              <span class="n">target_exit</span><span class="p">,</span> 
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>                                                              <span class="n">stop_exit</span><span class="p">,</span> 
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>                                                              <span class="n">open_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>                                                              <span class="n">close_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>                                                              <span class="n">direction</span><span class="p">)</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">day</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">direction</span><span class="p">,</span> <span class="n">target_entry</span><span class="p">,</span> \
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>              <span class="n">target_exit</span><span class="p">,</span> <span class="n">stop_exit</span><span class="p">)</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>        <span class="c1"># Run the trade</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>        <span class="n">trade_open</span><span class="p">,</span> <span class="n">trade_close</span><span class="p">,</span> \
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>        <span class="n">pos</span><span class="p">,</span> <span class="n">exec_pos</span> <span class="o">=</span> <span class="n">trade_method</span><span class="p">(</span><span class="n">portfo</span><span class="p">,</span> <span class="n">trade_id</span> <span class="o">=</span><span class="n">i</span><span class="p">)</span><span class="o">.</span>\
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>                                             <span class="n">run_trade</span><span class="p">(</span><span class="n">trunc_dict</span><span class="p">,</span> 
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>                                                       <span class="n">give_obj_name</span><span class="p">,</span> 
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>                                                       <span class="n">get_obj_name</span><span class="p">,</span> 
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>                                                       <span class="n">get_obj_quantity</span><span class="p">,</span> 
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>                                                       <span class="n">target_entry</span><span class="p">,</span> 
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>                                                       <span class="n">target_exit</span><span class="p">,</span> 
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>                                                       <span class="n">stop_exit</span><span class="p">,</span> 
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>                                                       <span class="n">open_hr</span> <span class="o">=</span> <span class="n">open_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>                                                       <span class="n">close_hr</span> <span class="o">=</span> <span class="n">close_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>                                                       <span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="p">,</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>                                                       <span class="n">fee</span><span class="o">=</span><span class="n">OIL_FUTURES_FEES</span><span class="p">[</span><span class="n">price_code</span><span class="p">],</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>                                                       <span class="n">open_time</span> <span class="o">=</span> <span class="n">open_hr_dt</span><span class="p">)</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>        <span class="c1"># plotting mid-backtest</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>        <span class="n">plot_in_backtest</span><span class="p">(</span><span class="n">date_interest</span><span class="p">,</span> <span class="n">price_code</span><span class="p">,</span> <span class="n">trunc_dict</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> 
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>                         <span class="n">plot_or_not</span><span class="o">=</span><span class="n">plot_or_not</span><span class="p">)</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>    <span class="k">return</span> <span class="n">portfo</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="EC_tools.backtest.Loop.loop_portfolio_preloaded" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">loop_portfolio_preloaded</span><span class="p">(</span><span class="n">portfo</span><span class="p">,</span> <span class="n">trade_method</span><span class="p">,</span> <span class="n">signal_table</span><span class="p">,</span> <span class="n">histroy_intraday_data_pkl</span><span class="p">,</span> <span class="n">give_obj_name</span><span class="o">=</span><span class="s1">&#39;USD&#39;</span><span class="p">,</span> <span class="n">get_obj_quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">open_hr_dict</span><span class="o">=</span><span class="n">OPEN_HR_DICT</span><span class="p">,</span> <span class="n">close_hr_dict</span><span class="o">=</span><span class="n">CLOSE_HR_DICT</span><span class="p">,</span> <span class="n">plot_or_not</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>A method that utilise one portfolio to run multi-asset backtest using 
preloaded data with multiple assets.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>portfo</code></b>
                  (<code><a class="autorefs autorefs-internal" title="EC_tools.portfolio.Portfolio" href="../portfolio/#EC_tools.portfolio.Portfolio">Portfolio</a></code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>trade_method</code></b>
                  (<code>TYPE</code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>signal_table</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>histroy_intraday_data_pkl</code></b>
                  (<code>TYPE</code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>give_obj_name</code></b>
                  (<code>str</code>, default:
                      <code>&#39;USD&#39;</code>
)
              
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is "USD".</p>
              </div>
            </li>
            <li>
              <b><code>get_obj_quantity</code></b>
                  (<code>int</code>, default:
                      <code>1</code>
)
              
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is 1.</p>
              </div>
            </li>
            <li>
              <b><code>plot_or_not</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is False.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>portfo</code></b>(                  <code>TYPE</code>
)              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/backtest.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-772" name="__codelineno-0-772"></a><span class="k">def</span> <span class="nf">loop_portfolio_preloaded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>                              <span class="n">portfo</span><span class="p">:</span> <span class="n">Portfolio</span><span class="p">,</span> 
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>                              <span class="n">trade_method</span><span class="p">,</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>                              <span class="n">signal_table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>                              <span class="n">histroy_intraday_data_pkl</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> 
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>                              <span class="n">give_obj_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;USD&quot;</span><span class="p">,</span> 
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>                              <span class="n">get_obj_quantity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>                              <span class="n">open_hr_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">OPEN_HR_DICT</span><span class="p">,</span> 
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>                              <span class="n">close_hr_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">CLOSE_HR_DICT</span><span class="p">,</span> 
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>                              <span class="n">plot_or_not</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a><span class="sd">    A method that utilise one portfolio to run multi-asset backtest using </span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a><span class="sd">    preloaded data with multiple assets.</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">    portfo : Portfolio</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a><span class="sd">    trade_method : TYPE</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a><span class="sd">    signal_table : pd.DataFrame</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a><span class="sd">    histroy_intraday_data_pkl : TYPE</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a><span class="sd">    give_obj_name : str, optional</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a><span class="sd">        DESCRIPTION. The default is &quot;USD&quot;.</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a><span class="sd">    get_obj_quantity : int, optional</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a><span class="sd">        DESCRIPTION. The default is 1.</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a><span class="sd">    plot_or_not : bool, optional</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a><span class="sd">        DESCRIPTION. The default is False.</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a><span class="sd">    -------</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">    portfo : TYPE</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">signal_table</span><span class="p">)):</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>        <span class="c1"># setup trade inputs ###########</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>        <span class="n">item</span> <span class="o">=</span> <span class="n">signal_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>        <span class="n">symbol</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Price_Code&#39;</span><span class="p">]</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>        <span class="n">date_interest</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>        <span class="n">get_obj_name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Price_Code&#39;</span><span class="p">]</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>        <span class="n">open_hr</span> <span class="o">=</span> <span class="n">open_hr_dict</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>        <span class="n">close_hr</span> <span class="o">=</span> <span class="n">close_hr_dict</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>        <span class="n">histroy_intraday_data</span> <span class="o">=</span> <span class="n">histroy_intraday_data_pkl</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>        <span class="n">day</span> <span class="o">=</span> <span class="n">extract_intraday_minute_data</span><span class="p">(</span><span class="n">histroy_intraday_data</span><span class="p">,</span> 
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>                                           <span class="n">date_interest</span><span class="p">,</span> 
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>                                           <span class="n">open_hr</span><span class="o">=</span><span class="n">open_hr</span><span class="p">,</span> 
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>                                           <span class="n">close_hr</span><span class="o">=</span><span class="n">close_hr</span><span class="p">)</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>        <span class="n">open_hr_dt</span><span class="p">,</span> <span class="n">open_price</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_closest_price</span><span class="p">(</span><span class="n">day</span><span class="p">,</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>                                                         <span class="n">target_hr</span><span class="o">=</span> <span class="n">open_hr</span><span class="p">,</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>                                                         <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;forward&#39;</span><span class="p">)</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>        <span class="n">close_hr_dt</span><span class="p">,</span> <span class="n">close_price</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_closest_price</span><span class="p">(</span><span class="n">day</span><span class="p">,</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>                                                           <span class="n">target_hr</span><span class="o">=</span> <span class="n">close_hr</span><span class="p">,</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>                                                           <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">)</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>        <span class="c1"># The time to open all positions</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>        <span class="n">pos_open_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">date_interest</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">open_hr_dt</span><span class="p">)</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>        <span class="c1"># Setup trade ##########</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>        <span class="n">trade_id</span> <span class="o">=</span> <span class="n">i</span> <span class="c1">#direction + str(i)</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>        <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> \
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>        <span class="n">stop_exit</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="n">load_EES_from_signal</span><span class="p">(</span><span class="n">trade_method</span><span class="p">,</span> 
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">_loop_type</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">pos_open_dt</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>        <span class="c1">#print(self._loop_type, day, target_entry,</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>        <span class="c1">#      target_exit, stop_exit, open_hr_dt, close_hr_dt, direction)</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>        <span class="c1"># Find the truncation dict and the modified target entry and exit</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>        <span class="n">trunc_dict</span><span class="p">,</span> \
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>        <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> <span class="n">stop_exit</span> <span class="o">=</span> <span class="n">gen_trunc_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop_type</span><span class="p">,</span> 
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>                                                              <span class="n">day</span><span class="p">,</span> 
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>                                                              <span class="n">target_entry</span><span class="p">,</span> 
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>                                                              <span class="n">target_exit</span><span class="p">,</span> 
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>                                                              <span class="n">stop_exit</span><span class="p">,</span> 
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>                                                              <span class="n">open_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>                                                              <span class="n">close_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>                                                              <span class="n">direction</span><span class="p">)</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>        <span class="c1"># Run the trade itself</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>        <span class="n">trade_open</span><span class="p">,</span> <span class="n">trade_close</span><span class="p">,</span> \
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>        <span class="n">pos</span><span class="p">,</span> <span class="n">exec_pos</span> <span class="o">=</span> <span class="n">trade_method</span><span class="p">(</span><span class="n">portfo</span><span class="p">,</span> <span class="n">trade_id</span> <span class="o">=</span> <span class="n">trade_id</span><span class="p">)</span><span class="o">.</span>\
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>                                             <span class="n">run_trade</span><span class="p">(</span><span class="n">trunc_dict</span><span class="p">,</span> 
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>                                                       <span class="n">give_obj_name</span><span class="p">,</span> 
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>                                                       <span class="n">get_obj_name</span><span class="p">,</span> 
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>                                                       <span class="n">get_obj_quantity</span><span class="p">,</span> 
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>                                                       <span class="n">target_entry</span><span class="p">,</span> 
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>                                                       <span class="n">target_exit</span><span class="p">,</span> 
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>                                                       <span class="n">stop_exit</span><span class="p">,</span> 
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>                                                       <span class="n">open_hr</span> <span class="o">=</span> <span class="n">open_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>                                                       <span class="n">close_hr</span><span class="o">=</span><span class="n">close_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>                                                       <span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="p">,</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>                                                       <span class="n">fee</span><span class="o">=</span><span class="n">OIL_FUTURES_FEES</span><span class="p">[</span><span class="n">symbol</span><span class="p">],</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>                                                       <span class="n">open_time</span><span class="o">=</span> <span class="n">pos_open_dt</span><span class="p">)</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>        <span class="c1"># plotting mid-backtest</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>        <span class="n">plot_in_backtest</span><span class="p">(</span><span class="n">date_interest</span><span class="p">,</span><span class="n">get_obj_name</span><span class="p">,</span> <span class="n">trunc_dict</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> 
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>                         <span class="n">plot_or_not</span><span class="o">=</span><span class="n">plot_or_not</span><span class="p">)</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>    <span class="k">return</span> <span class="n">portfo</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="EC_tools.backtest.Loop.loop_portfolio_preloaded_long" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">loop_portfolio_preloaded_long</span><span class="p">(</span><span class="n">portfo</span><span class="p">,</span> <span class="n">trade_method</span><span class="p">,</span> <span class="n">signal_table</span><span class="p">,</span> <span class="n">histroy_intraday_data_pkl</span><span class="p">,</span> <span class="n">histroy_minute_cumavg_data_pkl</span><span class="p">,</span> <span class="n">give_obj_name</span><span class="o">=</span><span class="s1">&#39;USD&#39;</span><span class="p">,</span> <span class="n">get_obj_quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">open_hr_dict</span><span class="o">=</span><span class="n">OPEN_HR_DICT</span><span class="p">,</span> <span class="n">close_hr_dict</span><span class="o">=</span><span class="n">CLOSE_HR_DICT</span><span class="p">,</span> <span class="n">plot_or_not</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>A method that utilise one portfolio to run multi-asset backtest using 
preloaded data with multiple assets.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>portfo</code></b>
                  (<code><a class="autorefs autorefs-internal" title="EC_tools.portfolio.Portfolio" href="../portfolio/#EC_tools.portfolio.Portfolio">Portfolio</a></code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>trade_method</code></b>
                  (<code>TYPE</code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>signal_table</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>histroy_intraday_data_pkl</code></b>
                  (<code>TYPE</code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>give_obj_name</code></b>
                  (<code>str</code>, default:
                      <code>&#39;USD&#39;</code>
)
              
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is "USD".</p>
              </div>
            </li>
            <li>
              <b><code>get_obj_quantity</code></b>
                  (<code>int</code>, default:
                      <code>1</code>
)
              
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is 1.</p>
              </div>
            </li>
            <li>
              <b><code>plot_or_not</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is False.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>portfo</code></b>(                  <code>TYPE</code>
)              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/backtest.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-885" name="__codelineno-0-885"></a>    <span class="k">def</span> <span class="nf">loop_portfolio_preloaded_long</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>                                  <span class="n">portfo</span><span class="p">:</span> <span class="n">Portfolio</span><span class="p">,</span> 
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>                                  <span class="n">trade_method</span><span class="p">,</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>                                  <span class="n">signal_table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>                                  <span class="n">histroy_intraday_data_pkl</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> 
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>                                  <span class="n">histroy_minute_cumavg_data_pkl</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> 
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>                                  <span class="n">give_obj_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;USD&quot;</span><span class="p">,</span> 
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>                                  <span class="n">get_obj_quantity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>                                  <span class="n">open_hr_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">OPEN_HR_DICT</span><span class="p">,</span> 
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>                                  <span class="n">close_hr_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">CLOSE_HR_DICT</span><span class="p">,</span> 
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>                                  <span class="n">plot_or_not</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a><span class="sd">        A method that utilise one portfolio to run multi-asset backtest using </span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a><span class="sd">        preloaded data with multiple assets.</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a><span class="sd">        portfo : Portfolio</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a><span class="sd">        trade_method : TYPE</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a><span class="sd">        signal_table : pd.DataFrame</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a><span class="sd">        histroy_intraday_data_pkl : TYPE</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a><span class="sd">        give_obj_name : str, optional</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a><span class="sd">            DESCRIPTION. The default is &quot;USD&quot;.</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a><span class="sd">        get_obj_quantity : int, optional</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a><span class="sd">            DESCRIPTION. The default is 1.</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a><span class="sd">        plot_or_not : bool, optional</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a><span class="sd">            DESCRIPTION. The default is False.</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a><span class="sd">        -------</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a><span class="sd">        portfo : TYPE</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a><span class="c1"># =============================================================================</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a><span class="c1">#         </span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a><span class="c1">#         #print(&#39;histroy_minute_cumavg_data_pkl&#39;, histroy_minute_cumavg_data_pkl)</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a><span class="c1">#         first_entry = signal_table.iloc[0]</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a><span class="c1">#         </span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a><span class="c1">#         first_symbol = first_entry[&#39;Price_Code&#39;]</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a><span class="c1">#         month = extract_month_minute_data(histroy_intraday_data_pkl[first_symbol],</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a><span class="c1">#                                           first_entry[&#39;Date&#39;],</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a><span class="c1">#                                           open_hr=open_hr_dict[first_symbol], </span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a><span class="c1">#                                           close_hr=close_hr_dict[first_symbol])</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a><span class="c1">#         </span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a><span class="c1">#         </span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a><span class="c1">#         histroy_minute_cumavg_data = histroy_minute_cumavg_data_pkl[first_symbol]</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a><span class="c1"># =============================================================================</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>        <span class="c1">#print(&quot;signal_table&quot;, signal_table)</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>        <span class="c1"># Initialise month_tracker using the first entry</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>        <span class="c1">#month_tracker = first_entry[&#39;Date&#39;].month</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">signal_table</span><span class="p">)):</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>            <span class="c1"># setup trade inputs ###########</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>            <span class="n">item</span> <span class="o">=</span> <span class="n">signal_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>            <span class="c1">#print(item)</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>            <span class="n">symbol</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Price_Code&#39;</span><span class="p">]</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>            <span class="n">date_interest</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>            <span class="n">get_obj_name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Price_Code&#39;</span><span class="p">]</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>            <span class="n">open_hr</span> <span class="o">=</span> <span class="n">open_hr_dict</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>            <span class="n">close_hr</span> <span class="o">=</span> <span class="n">close_hr_dict</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>            <span class="c1">#histroy_intraday_data = histroy_intraday_data_pkl[symbol]</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>            <span class="n">histroy_minute_cumavg_data</span> <span class="o">=</span> <span class="n">histroy_minute_cumavg_data_pkl</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>            <span class="n">current_month</span> <span class="o">=</span> <span class="n">date_interest</span><span class="o">.</span><span class="n">month</span>    
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">current_month</span> <span class="p">,</span> <span class="n">date_interest</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a><span class="c1"># =============================================================================</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="c1">#             month = extract_month_minute_data(histroy_intraday_data, </span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="c1">#                                               date_interest,</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a><span class="c1">#                                               open_hr=open_hr, </span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a><span class="c1">#                                               close_hr=close_hr)</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a><span class="c1">#             </span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a><span class="c1"># =============================================================================</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>            <span class="n">minute_cumavg_data</span> <span class="o">=</span> <span class="n">extract_month_minute_data</span><span class="p">(</span><span class="n">histroy_minute_cumavg_data</span><span class="p">,</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>                                                           <span class="n">date_interest</span><span class="p">,</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>                                                           <span class="n">open_hr</span><span class="o">=</span><span class="n">open_hr</span><span class="p">,</span> 
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>                                                           <span class="n">close_hr</span><span class="o">=</span><span class="n">close_hr</span><span class="p">)</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;minute_cumavg_data&#39;</span><span class="p">,</span> <span class="n">minute_cumavg_data</span><span class="p">)</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>            <span class="c1"># ^ really fast, not a problem here</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>            <span class="c1">#if current_month!= month_tracker:</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>                <span class="c1"># If the current month is not the same as the tracker, we</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>                <span class="c1"># load the data from the next month and update the tracker</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>            <span class="c1">#    month_tracker = current_month</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a><span class="c1"># =============================================================================</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a><span class="c1">#             day = extract_intraday_minute_data(histroy_intraday_data, </span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a><span class="c1">#                                                date_interest, </span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a><span class="c1">#                                                open_hr=open_hr, </span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a><span class="c1">#                                                close_hr=close_hr)</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a><span class="c1"># =============================================================================</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>            <span class="c1">#print(&quot;month&quot;, month, &#39;day&#39;,day)</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>            <span class="n">first_date</span> <span class="o">=</span> <span class="n">minute_cumavg_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>            <span class="n">last_date</span> <span class="o">=</span> <span class="n">minute_cumavg_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;first_date&#39;</span><span class="p">,</span> <span class="s1">&#39;last_date&#39;</span><span class="p">,</span> <span class="n">first_date</span><span class="p">,</span> <span class="n">last_date</span><span class="p">)</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>            <span class="n">open_hr_dt</span><span class="p">,</span> <span class="n">open_price</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_closest_price_datetime</span><span class="p">(</span><span class="n">minute_cumavg_data</span><span class="p">,</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>                                                                      <span class="n">first_date</span><span class="p">,</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>                                                                      <span class="n">target_hr</span><span class="o">=</span> <span class="n">open_hr</span><span class="p">,</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>                                                                      <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;forward&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>                                                                      <span class="n">price_proxy</span><span class="o">=</span><span class="s1">&#39;today_cum_avg&#39;</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>                                                                      <span class="p">)</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>            <span class="n">close_hr_dt</span><span class="p">,</span> <span class="n">close_price</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_closest_price_datetime</span><span class="p">(</span><span class="n">minute_cumavg_data</span><span class="p">,</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>                                                                        <span class="n">last_date</span><span class="p">,</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>                                                                        <span class="n">target_hr</span><span class="o">=</span> <span class="n">close_hr</span><span class="p">,</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>                                                                        <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>                                                                        <span class="n">price_proxy</span><span class="o">=</span><span class="s1">&#39;today_cum_avg&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>            <span class="c1"># ^ tested these two they also ran fast</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>            <span class="c1"># The time to open all positions</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>            <span class="c1"># This may not be straightly accurate but this varaible is only </span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>            <span class="c1"># for record keeping. it is similar to the real value</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>            <span class="n">pos_open_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">date_interest</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">open_hr_dt</span><span class="p">)</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>            <span class="c1"># Setup trade ##########</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>            <span class="n">trade_id</span> <span class="o">=</span> <span class="n">i</span> <span class="c1">#direction + str(i)</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>            <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> \
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>            <span class="n">stop_exit</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="n">load_EES_from_signal</span><span class="p">(</span><span class="n">trade_method</span><span class="p">,</span> 
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_loop_type</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">pos_open_dt</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>            <span class="c1">#print(self._loop_type, day, target_entry,</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>            <span class="c1">#      target_exit, stop_exit, open_hr_dt, close_hr_dt, direction)</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>            <span class="c1"># Find the truncation dict and the modified target entry and exit</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>            <span class="n">trunc_dict</span><span class="p">,</span> \
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>            <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> <span class="n">stop_exit</span> <span class="o">=</span> <span class="n">gen_trunc_dict_long</span><span class="p">(</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>                                                                <span class="bp">self</span><span class="o">.</span><span class="n">_loop_type</span><span class="p">,</span> 
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>                                                                <span class="n">minute_cumavg_data</span><span class="p">,</span> 
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>                                                                <span class="n">target_entry</span><span class="p">,</span> 
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>                                                                <span class="n">target_exit</span><span class="p">,</span> 
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>                                                                <span class="n">stop_exit</span><span class="p">,</span> 
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>                                                                <span class="n">open_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>                                                                <span class="n">close_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>                                                                <span class="n">direction</span><span class="p">)</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;trunc_dict&quot;</span><span class="p">,</span> <span class="n">trunc_dict</span><span class="p">)</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> <span class="n">stop_exit</span><span class="p">)</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>            <span class="c1"># Run the trade itself</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>            <span class="n">trade_open</span><span class="p">,</span> <span class="n">trade_close</span><span class="p">,</span> \
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>            <span class="n">pos</span><span class="p">,</span> <span class="n">exec_pos</span> <span class="o">=</span> <span class="n">trade_method</span><span class="p">(</span><span class="n">portfo</span><span class="p">,</span> <span class="n">trade_id</span> <span class="o">=</span> <span class="n">trade_id</span><span class="p">)</span><span class="o">.</span>\
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>                                                 <span class="n">run_trade</span><span class="p">(</span><span class="n">trunc_dict</span><span class="p">,</span> 
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>                                                           <span class="n">give_obj_name</span><span class="p">,</span> 
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>                                                           <span class="n">get_obj_name</span><span class="p">,</span> 
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>                                                           <span class="n">get_obj_quantity</span><span class="p">,</span> 
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>                                                           <span class="n">target_entry</span><span class="p">,</span> 
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>                                                           <span class="n">target_exit</span><span class="p">,</span> 
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>                                                           <span class="n">stop_exit</span><span class="p">,</span> 
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>                                                           <span class="n">open_hr</span> <span class="o">=</span> <span class="n">open_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>                                                           <span class="n">close_hr</span><span class="o">=</span><span class="n">close_hr_dt</span><span class="p">,</span> 
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>                                                           <span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="p">,</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>                                                           <span class="n">fee</span><span class="o">=</span><span class="n">OIL_FUTURES_FEES</span><span class="p">[</span><span class="n">symbol</span><span class="p">],</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>                                                           <span class="n">open_time</span><span class="o">=</span> <span class="n">pos_open_dt</span><span class="p">)</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>            <span class="c1"># plotting mid-backtest</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>            <span class="n">plot_in_backtest</span><span class="p">(</span><span class="n">date_interest</span><span class="p">,</span><span class="n">get_obj_name</span><span class="p">,</span> <span class="n">trunc_dict</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> 
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>                             <span class="n">plot_or_not</span><span class="o">=</span><span class="n">plot_or_not</span><span class="p">)</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>        <span class="k">return</span> <span class="n">portfo</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="EC_tools.backtest.LoopType" class="doc doc-heading">
            <code>LoopType</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


        <p>There are three types of loops
1) Crossover: It creates a dict of crossover points based on a set of 
              Entry/Exit/StopLoss (EES) values. This is the default 
              option and is usually the fastest loop.
2) Range: It creates a dict of points within a given range defined by 
          the upper and lower limit of the Entry/Exit prices, plus a value 
          of StopLoss. 
3) Full: It is a loop that iterate over all points of the input data. 
         This is the slowest loop but can capture the most details.</p>

              <details class="quote">
                <summary>Source code in <code>EC_tools/backtest.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="k">class</span> <span class="nc">LoopType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    There are three types of loops</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    1) Crossover: It creates a dict of crossover points based on a set of </span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">                  Entry/Exit/StopLoss (EES) values. This is the default </span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">                  option and is usually the fastest loop.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    2) Range: It creates a dict of points within a given range defined by </span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">              the upper and lower limit of the Entry/Exit prices, plus a value </span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">              of StopLoss. </span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    3) Full: It is a loop that iterate over all points of the input data. </span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">             This is the slowest loop but can capture the most details.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="n">CROSSOVER</span> <span class="o">=</span> <span class="s2">&quot;Crossover&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="n">RANGE</span> <span class="o">=</span> <span class="s2">&quot;Range&quot;</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="n">FULL</span> <span class="o">=</span> <span class="s2">&quot;Full&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="EC_tools.backtest.extract_intraday_minute_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_intraday_minute_data</span><span class="p">(</span><span class="n">histroy_intraday_data</span><span class="p">,</span> <span class="n">date_interest</span><span class="p">,</span> <span class="n">open_hr</span><span class="o">=</span><span class="s1">&#39;0330&#39;</span><span class="p">,</span> <span class="n">close_hr</span><span class="o">=</span><span class="s1">&#39;1900&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>A function that extract only the minute pricing data from a master file 
given a single date of interest.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>histrot_data_intraday</code></b>
                  (<code>pandas dataframe</code>)
              
              <div class="doc-md-description">
                <p>The master file for minute data.</p>
              </div>
            </li>
            <li>
              <b><code>date_interest</code></b>
                  (<code>str</code>)
              
              <div class="doc-md-description">
                <p>In the format of '2020-02-02'.</p>
              </div>
            </li>
            <li>
              <b><code>open_hr</code></b>
                  (<code>str</code>, default:
                      <code>&#39;0330&#39;</code>
)
              
              <div class="doc-md-description">
                <p>Opening trading hour. The default is 300.</p>
              </div>
            </li>
            <li>
              <b><code>close_hr</code></b>
                  (<code>str</code>, default:
                      <code>&#39;1900&#39;</code>
)
              
              <div class="doc-md-description">
                <p>Closing trading hour. The default is 1900.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>histroy_data_intraday</code></b>(                  <code>pandas dataframe</code>
)              
              <div class="doc-md-description">
                <p>A table isolated by the date of interest.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/backtest.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="k">def</span> <span class="nf">extract_intraday_minute_data</span><span class="p">(</span><span class="n">histroy_intraday_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                                 <span class="n">date_interest</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                                 <span class="n">open_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;0330&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                                 <span class="n">close_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;1900&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    A function that extract only the minute pricing data from a master file </span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    given a single date of interest.</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    histrot_data_intraday : pandas dataframe</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">        The master file for minute data.</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    date_interest : str</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">        In the format of &#39;2020-02-02&#39;.</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    open_hr : str, optional</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">        Opening trading hour. The default is 300.</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">    close_hr : str, optional</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">        Closing trading hour. The default is 1900.</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">    -------</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">    histroy_data_intraday : pandas dataframe</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">        A table isolated by the date of interest.</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">    &quot;&quot;&quot;</span>    
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="c1"># convert the string hour and minute input to datetime.time object</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">open_hr</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="n">open_hr_str</span><span class="p">,</span> <span class="n">open_min_str</span> <span class="o">=</span> <span class="n">open_hr</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">open_hr</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="n">open_hr</span> <span class="o">=</span>  <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">open_hr_str</span><span class="p">),</span> <span class="n">minute</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">open_min_str</span><span class="p">))</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">open_hr</span><span class="p">)</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="k">pass</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">close_hr</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="n">close_hr_str</span><span class="p">,</span> <span class="n">close_min_str</span> <span class="o">=</span> <span class="n">close_hr</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">close_hr</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="n">close_hr</span> <span class="o">=</span>  <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">close_hr_str</span><span class="p">),</span> <span class="n">minute</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">close_min_str</span><span class="p">))</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">close_hr</span><span class="p">)</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">:</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="k">pass</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="c1"># Given a date of interest, and read-in the intraday data.</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>    <span class="n">histroy_intraday_data</span> <span class="o">=</span> <span class="n">histroy_intraday_data</span><span class="p">[</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>                                <span class="n">histroy_intraday_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>  <span class="o">==</span> <span class="n">date_interest</span><span class="p">]</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="c1"># isolate the region of interest between the opening hour and the closing hour</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="n">histroy_intraday_data</span> <span class="o">=</span> <span class="n">histroy_intraday_data</span><span class="p">[</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>                                            <span class="n">histroy_intraday_data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">open_hr</span><span class="p">]</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="n">histroy_intraday_data</span> <span class="o">=</span> <span class="n">histroy_intraday_data</span><span class="p">[</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>                                            <span class="n">histroy_intraday_data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">close_hr</span><span class="p">]</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="k">return</span> <span class="n">histroy_intraday_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.backtest.extract_month_minute_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_month_minute_data</span><span class="p">(</span><span class="n">histroy_data</span><span class="p">,</span> <span class="n">date_interest</span><span class="p">,</span> <span class="n">open_hr</span><span class="o">=</span><span class="s1">&#39;0330&#39;</span><span class="p">,</span> <span class="n">close_hr</span><span class="o">=</span><span class="s1">&#39;1959&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>histroy_data</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>date_interest</code></b>
                  (<code>str</code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>open_hr</code></b>
                  (<code>str</code>, default:
                      <code>&#39;0330&#39;</code>
)
              
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is '0330'.</p>
              </div>
            </li>
            <li>
              <b><code>close_hr</code></b>
                  (<code>str</code>, default:
                      <code>&#39;1959&#39;</code>
)
              
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is '1959'.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>histroy_data</code></b>(                  <code>TYPE</code>
)              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/backtest.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="k">def</span> <span class="nf">extract_month_minute_data</span><span class="p">(</span><span class="n">histroy_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>                              <span class="n">date_interest</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                              <span class="n">open_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;0330&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                              <span class="n">close_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;1959&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span> <span class="c1"># tested</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">    histroy_data : pd.DataFrame</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">    date_interest : str</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">    open_hr : str, optional</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">        DESCRIPTION. The default is &#39;0330&#39;.</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">    close_hr : str, optional</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">        DESCRIPTION. The default is &#39;1959&#39;.</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">    -------</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">    histroy_data : TYPE</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="c1"># convert the string hour and minute input to datetime.time object</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">open_hr</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="n">open_hr_str</span><span class="p">,</span> <span class="n">open_min_str</span> <span class="o">=</span> <span class="n">open_hr</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">open_hr</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="n">open_hr</span> <span class="o">=</span>  <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">open_hr_str</span><span class="p">),</span> <span class="n">minute</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">open_min_str</span><span class="p">))</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">open_hr</span><span class="p">)</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">:</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="k">pass</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">close_hr</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="n">close_hr_str</span><span class="p">,</span> <span class="n">close_min_str</span> <span class="o">=</span> <span class="n">close_hr</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">close_hr</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="n">close_hr</span> <span class="o">=</span>  <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">close_hr_str</span><span class="p">),</span> <span class="n">minute</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">close_min_str</span><span class="p">))</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">close_hr</span><span class="p">)</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">:</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="k">pass</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="c1">#date_interest_2 = date_interest</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="c1"># Each month has different duration</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="c1">#duration = pd.to_datetime(date_interest_2, format= &#39;%Y-%m-%d&#39;).days_in_month</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>    <span class="c1">#duration = date_interest.days_in_month</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="n">_</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">date_interest</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">date_interest</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>    <span class="c1"># Convert date_interest from str to datetime</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="c1">#date_interest = datetime.datetime.strptime(date_interest, &#39;%Y-%m-%d&#39;)</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>    <span class="c1"># Find the starting date and ending date of a particular month</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="n">month_start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">date_interest</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">date_interest</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="n">month_end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">date_interest</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">date_interest</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;month_start,month_end&#39;</span><span class="p">,</span> <span class="n">month_start</span><span class="p">,</span><span class="n">month_end</span><span class="p">)</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="c1"># Four selection crtieria in total, ser</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>    <span class="c1"># Given a date of interest, and read-in the intraday data.</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="n">histroy_data</span> <span class="o">=</span> <span class="n">histroy_data</span><span class="p">[</span><span class="n">histroy_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">month_start</span><span class="p">]</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="n">histroy_data</span> <span class="o">=</span> <span class="n">histroy_data</span><span class="p">[</span><span class="n">histroy_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">month_end</span><span class="p">]</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="c1"># isolate the region of interest between the opening hour and the closing hour</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="n">histroy_data</span> <span class="o">=</span> <span class="n">histroy_data</span><span class="p">[</span><span class="n">histroy_data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">open_hr</span><span class="p">]</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="n">histroy_data</span> <span class="o">=</span> <span class="n">histroy_data</span><span class="p">[</span><span class="n">histroy_data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">close_hr</span><span class="p">]</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="k">return</span> <span class="n">histroy_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.backtest.gen_trunc_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">gen_trunc_dict</span><span class="p">(</span><span class="n">loop_type</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> <span class="n">stop_exit</span><span class="p">,</span> <span class="n">open_hr</span><span class="p">,</span> <span class="n">close_hr</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>A function to choose what style of truncation dictionary to be generated.
All trunc_dict have the following format:
    {"entry": [(...,...), ...], "exit": [(...,...), ...], 
     "stop": [(...,...), ...], "open": (...,...) ,"close": (...,...)}
This method allows you to choose whether to generate a trunc_dict using a 
given set of EES value (for crossover loop) or EES range (for range loop).
For crossover loop, the </p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>day</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>target_entry</code></b>
                  (<code>float</code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>target_exit</code></b>
                  (<code>float</code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>stop_exit</code></b>
                  (<code>float</code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>open_hr</code></b>
                  (<code><span title="datetime.datetime">datetime</span></code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>close_hr</code></b>
                  (<code><span title="datetime.datetime">datetime</span></code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>direction</code></b>
                  (<code>str</code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>loop_type</code></b>
                  (<code><a class="autorefs autorefs-internal" title="EC_tools.backtest.LoopType" href="#EC_tools.backtest.LoopType">LoopType</a></code>)
              
              <div class="doc-md-description">
                <p>The loop type. The default is LoopType.CROSSOVER</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>trunc_dict</code></b>(                  <code>TYPE</code>
)              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
<b><code>target_entry</code></b>(                  <code>TYPE</code>
)              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
<b><code>target_exit</code></b>(                  <code>TYPE</code>
)              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/backtest.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="k">def</span> <span class="nf">gen_trunc_dict</span><span class="p">(</span><span class="n">loop_type</span><span class="p">:</span> <span class="n">LoopType</span><span class="p">,</span> 
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>                   <span class="n">day</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>                   <span class="n">target_entry</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> 
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>                                 <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>                   <span class="n">target_exit</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> 
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>                                <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>                   <span class="n">stop_exit</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>                   <span class="n">open_hr</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> 
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>                   <span class="n">close_hr</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> 
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>                   <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> \
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>                  <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">list</span><span class="o">|</span><span class="nb">tuple</span><span class="p">],</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">    A function to choose what style of truncation dictionary to be generated.</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">    All trunc_dict have the following format:</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">        {&quot;entry&quot;: [(...,...), ...], &quot;exit&quot;: [(...,...), ...], </span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">         &quot;stop&quot;: [(...,...), ...], &quot;open&quot;: (...,...) ,&quot;close&quot;: (...,...)}</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">    This method allows you to choose whether to generate a trunc_dict using a </span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">    given set of EES value (for crossover loop) or EES range (for range loop).</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">    For crossover loop, the </span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">    day : pd.DataFrame</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">    target_entry : float</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">    target_exit : float</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">    stop_exit : float</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">    open_hr : datetime.datetime</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="sd">    close_hr : datetime.datetime</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">    direction : str</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">    loop_type : LoopType</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">        The loop type. The default is LoopType.CROSSOVER</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">    -------</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">    trunc_dict : TYPE</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">    target_entry : TYPE</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">    target_exit : TYPE</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>    <span class="k">if</span> <span class="n">loop_type</span> <span class="o">==</span> <span class="n">LoopType</span><span class="o">.</span><span class="n">CROSSOVER</span><span class="p">:</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="c1"># Find the crossover points of EES</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="n">trunc_dict</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_minute_EES</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> 
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>                                          <span class="n">target_entry</span><span class="p">,</span> 
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>                                          <span class="n">target_exit</span><span class="p">,</span> 
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>                                          <span class="n">stop_exit</span><span class="p">,</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>                                          <span class="n">open_hr</span> <span class="o">=</span> <span class="n">open_hr</span><span class="p">,</span> 
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>                                          <span class="n">close_hr</span> <span class="o">=</span> <span class="n">close_hr</span><span class="p">,</span> 
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>                                          <span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="p">)</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>    <span class="k">elif</span> <span class="n">loop_type</span> <span class="o">==</span> <span class="n">LoopType</span><span class="o">.</span><span class="n">RANGE</span><span class="p">:</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="c1"># Find the appropiate range of EES</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>        <span class="n">trunc_dict</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">find_minute_EES_range</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> 
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>                                                <span class="n">target_entry</span><span class="p">,</span> 
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>                                                <span class="n">target_exit</span><span class="p">,</span> 
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                                                <span class="n">stop_exit</span><span class="p">,</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>                                                <span class="n">open_hr</span> <span class="o">=</span> <span class="n">open_hr</span><span class="p">,</span> 
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>                                                <span class="n">close_hr</span> <span class="o">=</span> <span class="n">close_hr</span><span class="p">,</span> 
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>                                                <span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="p">)</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>        <span class="c1"># target entry/exit are first estimations of the prices using</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="c1"># the mid point of the target range. The final entry/exit prices</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="c1"># will changeas the algo find the optimal price based on the selected</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>        <span class="c1"># trade logic</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>        <span class="n">target_entry_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">target_entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_entry</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="n">target_exit_mid</span> <span class="o">=</span>  <span class="p">(</span><span class="n">target_exit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_exit</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>        <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span> <span class="o">=</span> <span class="n">target_entry_mid</span><span class="p">,</span> <span class="n">target_exit_mid</span> 
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="k">return</span> <span class="n">trunc_dict</span><span class="p">,</span> <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> <span class="n">stop_exit</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.backtest.load_EES_from_signal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_EES_from_signal</span><span class="p">(</span><span class="n">trade_method</span><span class="p">,</span> <span class="n">loop_type</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This method load the EES values based on the given trade logic and loop
method.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>trade_method</code></b>
                  (<code>TYPE</code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>loop_method</code></b>
                  (<code>TYPE</code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>item</code></b>
                  (<code>TYPE</code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>target_entry</code></b>(                  <code>TYPE</code>
)              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
<b><code>target_exit</code></b>(                  <code>TYPE</code>
)              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
<b><code>stop_exit</code></b>(                  <code>TYPE</code>
)              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
<b><code>direction</code></b>(                  <code>TYPE</code>
)              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/backtest.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="k">def</span> <span class="nf">load_EES_from_signal</span><span class="p">(</span><span class="n">trade_method</span><span class="p">,</span> 
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>                         <span class="n">loop_type</span><span class="p">:</span> <span class="n">LoopType</span><span class="p">,</span> 
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>                         <span class="n">item</span><span class="p">:</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> \
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>                         <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="o">|</span><span class="nb">int</span><span class="o">|</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> 
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>                                  <span class="nb">float</span><span class="o">|</span><span class="nb">int</span><span class="o">|</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> 
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>                                  <span class="nb">float</span><span class="o">|</span><span class="nb">int</span><span class="o">|</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> 
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>                                  <span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">    This method load the EES values based on the given trade logic and loop</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">    method.</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">    trade_method : TYPE</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">    loop_method : TYPE</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">    item : TYPE</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">    -------</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">    target_entry : TYPE</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">    target_exit : TYPE</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="sd">    stop_exit : TYPE</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">    direction : TYPE</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>    <span class="k">if</span> <span class="n">trade_method</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;OneTradePerDay&quot;</span> <span class="ow">or</span> \
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="n">trade_method</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;OneTradePerDay_2&quot;</span> <span class="ow">or</span>\
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>        <span class="n">trade_method</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;MultiTradePerMonth&quot;</span><span class="p">:</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="n">direction</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Direction&#39;</span><span class="p">]</span> 
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>        <span class="k">if</span> <span class="n">loop_type</span> <span class="o">==</span> <span class="n">LoopType</span><span class="o">.</span><span class="n">CROSSOVER</span><span class="p">:</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Buy&#39;</span> <span class="ow">or</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Sell&#39;</span><span class="p">:</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>                <span class="n">target_entry</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Entry_Price&#39;</span><span class="p">]</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>                <span class="n">target_exit</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Exit_Price&#39;</span><span class="p">]</span> 
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>                <span class="n">stop_exit</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;StopLoss_Price&#39;</span><span class="p">]</span> 
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>                <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> <span class="n">stop_exit</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span><span class="p">,</span> <span class="s1">&#39;NA&#39;</span><span class="p">,</span> <span class="s1">&#39;NA&#39;</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>        <span class="k">elif</span> <span class="n">loop_type</span> <span class="o">==</span> <span class="n">LoopType</span><span class="o">.</span><span class="n">RANGE</span><span class="p">:</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Buy&#39;</span> <span class="ow">or</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Sell&#39;</span><span class="p">:</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>                <span class="n">target_entry</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;Target_Lower_Entry_Price&#39;</span><span class="p">],</span> 
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>                                <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Target_Upper_Entry_Price&#39;</span><span class="p">]]</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>                <span class="n">target_exit</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;Target_Lower_Exit_Price&#39;</span><span class="p">],</span> 
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>                               <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Target_Upper_Exit_Price&#39;</span><span class="p">]]</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>                <span class="n">stop_exit</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;StopLoss_Price&#39;</span><span class="p">]</span> 
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>                <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> <span class="n">stop_exit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span> <span class="s1">&#39;NA&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span><span class="s1">&#39;NA&#39;</span><span class="p">],</span> <span class="s1">&#39;NA&#39;</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>    <span class="k">elif</span> <span class="n">trade_method</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;BiDirectionalTrade&quot;</span><span class="p">:</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>        <span class="k">if</span> <span class="n">loop_type</span> <span class="o">==</span> <span class="n">LoopType</span><span class="o">.</span><span class="n">CROSSOVER</span><span class="p">:</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>            <span class="c1"># Target_Lower_Entry_Price	Target_Upper_Entry_Price	</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>            <span class="c1"># Target_Lower_Exit_Price	Target_Upper_Exit_Price</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>            <span class="n">target_entry</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Buy&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Q0.4&#39;</span><span class="p">],</span><span class="s1">&#39;Sell&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Q0.6&#39;</span><span class="p">]}</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>            <span class="n">target_exit</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Buy&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Q0.6&#39;</span><span class="p">],</span> <span class="s1">&#39;Sell&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Q0.4&#39;</span><span class="p">]}</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>            <span class="n">stop_exit</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Buy&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Q0.1&#39;</span><span class="p">],</span> <span class="s1">&#39;Sell&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Q0.9&#39;</span><span class="p">]}</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>            <span class="n">direction</span> <span class="o">=</span> <span class="s1">&#39;Bitrade-&#39;</span> 
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>    <span class="k">return</span> <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> <span class="n">stop_exit</span><span class="p">,</span> <span class="n">direction</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.backtest.plot_in_backtest" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_in_backtest</span><span class="p">(</span><span class="n">date_interest</span><span class="p">,</span> <span class="n">asset_name</span><span class="p">,</span> <span class="n">EES_dict</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">plot_or_not</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>date_interest</code></b>
                  (<code>str | <span title="datetime.datetime">datetime</span></code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>asset_name</code></b>
                  (<code>str</code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>EES_dict</code></b>
                  (<code>dict</code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>direction</code></b>
                  (<code>str</code>)
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
            <li>
              <b><code>plot_or_not</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              
              <div class="doc-md-description">
                <p>DESCRIPTION. The default is False.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>None</code>
              
              <div class="doc-md-description">
                <p>DESCRIPTION.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/backtest.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="k">def</span> <span class="nf">plot_in_backtest</span><span class="p">(</span><span class="n">date_interest</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> 
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>                     <span class="n">asset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>                     <span class="n">EES_dict</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> 
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                     <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>                     <span class="n">plot_or_not</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">    date_interest : str | datetime.datetime</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">    asset_name : str</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">    EES_dict : dict</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">    direction : str</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">    plot_or_not : bool, optional</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">        DESCRIPTION. The default is False.</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">    -------</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">    None</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">        DESCRIPTION.</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>    <span class="k">if</span> <span class="n">plot_or_not</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">date_interest</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="n">date_interest_str</span> <span class="o">=</span> <span class="n">date_interest</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">date_interest</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="n">date_interest_str</span> <span class="o">=</span> <span class="n">date_interest</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">EES_dict</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>    
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="n">entry_times</span><span class="p">,</span> <span class="n">entry_pts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">EES_dict</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="n">entry_times</span><span class="p">,</span> <span class="n">entry_pts</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">EES_dict</span><span class="p">[</span><span class="s1">&#39;exit&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="n">exit_times</span><span class="p">,</span> <span class="n">exit_pts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">EES_dict</span><span class="p">[</span><span class="s1">&#39;exit&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>            <span class="n">exit_times</span><span class="p">,</span> <span class="n">exit_pts</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">EES_dict</span><span class="p">[</span><span class="s1">&#39;stop&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>            <span class="n">stop_times</span><span class="p">,</span> <span class="n">stop_pts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">EES_dict</span><span class="p">[</span><span class="s1">&#39;stop&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="k">else</span><span class="p">:</span> 
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>            <span class="n">stop_times</span><span class="p">,</span> <span class="n">stop_pts</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bppt&#39;</span><span class="p">,</span> <span class="n">entry_times</span><span class="p">,</span> <span class="n">entry_pts</span><span class="p">,</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                      <span class="n">exit_times</span><span class="p">,</span> <span class="n">exit_pts</span><span class="p">,</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>                      <span class="n">stop_times</span><span class="p">,</span> <span class="n">stop_pts</span><span class="p">)</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="n">minute_data</span> <span class="o">=</span> <span class="n">HISTORY_MINTUE_FILE_LOC</span><span class="p">[</span><span class="n">asset_name</span><span class="p">]</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="n">apc_data</span> <span class="o">=</span> <span class="n">APC_FILE_LOC</span><span class="p">[</span><span class="n">asset_name</span><span class="p">]</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="n">plot</span><span class="o">.</span><span class="n">plot_minute</span><span class="p">(</span><span class="n">minute_data</span><span class="p">,</span> <span class="n">apc_data</span><span class="p">,</span> 
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>                         <span class="n">date_interest</span> <span class="o">=</span> <span class="n">date_interest_str</span><span class="p">,</span> 
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>                         <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>                         <span class="n">bppt_x1</span><span class="o">=</span><span class="n">entry_times</span><span class="p">,</span> <span class="n">bppt_y1</span><span class="o">=</span><span class="n">entry_pts</span><span class="p">,</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>                         <span class="n">bppt_x2</span><span class="o">=</span><span class="n">exit_times</span><span class="p">,</span> <span class="n">bppt_y2</span><span class="o">=</span><span class="n">exit_pts</span><span class="p">,</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>                         <span class="n">bppt_x3</span><span class="o">=</span><span class="n">stop_times</span><span class="p">,</span> <span class="n">bppt_y3</span><span class="o">=</span><span class="n">stop_pts</span><span class="p">)</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span class="k">elif</span> <span class="n">plot_or_not</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.backtest.prepare_signal_interest" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepare_signal_interest</span><span class="p">(</span><span class="n">filename_buysell_signals</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Buy&#39;</span><span class="p">,</span> <span class="s1">&#39;Sell&#39;</span><span class="p">],</span> <span class="n">trim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>A function that extract data from a signal table based on some directional 
instruction.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>filename_buysell_signals</code></b>
                  (<code>str</code>)
              
              <div class="doc-md-description">
                <p>The file name of the directional data. It read the table as a dataframe.</p>
              </div>
            </li>
            <li>
              <b><code>direction</code></b>
                  (<code>(list, str)</code>, default:
                      <code>[&#39;Buy&#39;, &#39;Sell&#39;]</code>
)
              
              <div class="doc-md-description">
                <p>The directional instruction. The default is ["Buy", "Sell"].</p>
              </div>
            </li>
            <li>
              <b><code>trim</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              
              <div class="doc-md-description">
                <p>Choose whether the result table contain only two clomns. 
The default is False.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>data</code></b>(                  <code>pandas dataframe</code>
)              
              <div class="doc-md-description">
                <p>The tuncated table with only the data of interest.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/backtest.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="k">def</span> <span class="nf">prepare_signal_interest</span><span class="p">(</span><span class="n">filename_buysell_signals</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>                            <span class="n">direction</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Buy&quot;</span><span class="p">,</span> <span class="s2">&quot;Sell&quot;</span><span class="p">],</span> 
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>                            <span class="n">trim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    A function that extract data from a signal table based on some directional </span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    instruction.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    filename_buysell_signals : str</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        The file name of the directional data. It read the table as a dataframe.</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    direction : list, str, optional</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        The directional instruction. The default is [&quot;Buy&quot;, &quot;Sell&quot;].</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    trim : bool, optional</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        Choose whether the result table contain only two clomns. </span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        The default is False.</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">    -------</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    data : pandas dataframe</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        The tuncated table with only the data of interest.</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="c1"># read in direction data from the signal generation</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="n">buysell_signals_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename_buysell_signals</span><span class="p">)</span>    
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="c1"># The trim function reduce the number of columns to only &#39;Date&#39; and &#39;direction&#39;</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="c1"># This may cut down the computing and memory cost when dealing with large </span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="c1"># table.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="k">if</span> <span class="n">trim</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="n">buysell_signals_data</span> <span class="o">=</span> <span class="n">buysell_signals_data</span><span class="p">[[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Direction&#39;</span><span class="p">]]</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="k">elif</span> <span class="n">trim</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="k">pass</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="c1"># Select for the signals in direction list.</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="n">signal_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">direction</span><span class="p">:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="n">temp</span> <span class="o">=</span> <span class="n">buysell_signals_data</span><span class="p">[</span><span class="n">buysell_signals_data</span><span class="p">[</span><span class="s1">&#39;Direction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">signal_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="c1"># concatenate the list of signals</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="n">signal_interest</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">signal_data</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="c1"># make a column with Timestamp as its content</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="n">signal_interest</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]),</span> 
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                                                  <span class="n">month</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">]),</span> 
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                                                  <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">8</span><span class="p">:]))</span> 
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                                 <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">signal_interest</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]]</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="c1"># sort the table by Date</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="n">signal_interest</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="k">return</span> <span class="n">signal_interest</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../trade/" class="btn btn-neutral float-left" title="trade"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../utility/" class="btn btn-neutral float-right" title="utility">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../trade/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../utility/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
