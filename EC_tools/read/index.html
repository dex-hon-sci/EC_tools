<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>read - EC_tools Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "read";
        var mkdocs_page_input_path = "EC_tools/read.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> EC_tools Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../about/">About</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../main/">Main</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">EC_tools</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../EC_tools/">Introduction</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">read</a>
    <ul class="current">
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../plot/">plot</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../portfolio/">portfolio</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../position/">position</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../strategy/">strategy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../simple_trade/">simple_trade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../trade/">trade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../backtest/">backtest</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../utility/">utility</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Applications</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/app/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_apc_price_study/">Run APC Study</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_backtest/">Run Backtest</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_comparison_plot/">Run Comparison Plot</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_daily_instruction/">Run Daily Instruction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_data_management/">Run Data Management</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_gen_monthly_MR_dir/">Run Generate Monthly MR signals</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_gen_MR_dir/">Run Generate Daily MR signals</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../app/run_plot_heatamp.md">Run Plot Backtest Heatmap</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_PNL_plot/">Run PNL Plots</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_preprocess/">Run Preprocess</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_update_db/">Run Update DB</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">EC_tools Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">EC_tools</li>
      <li class="breadcrumb-item active">read</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="read">read</h2>


<div class="doc doc-object doc-module">



<a id="EC_tools.read"></a>
    <div class="doc doc-contents first">

        <p>Created on Tue Apr  2 14:09:54 2024</p>
<p>@author: dexter</p>
<p>The read module contains handy functions related reading and reformating raw 
data. It also contains some relevant function in mainpulating data or deriving 
new information from the raw data.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.concat_CSVtable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">concat_CSVtable</span><span class="p">(</span><span class="n">filename_list</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Concatenate CSV tables.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>filename_list</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>A list of CSV filename.</p>
              </div>
            </li>
            <li>
              <b><code>sort_by</code></b>
                  (<code>str</code>, default:
                      <code>&#39;Date&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The column name in which the dataframe is sorted. 
The default is 'Date'.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>master_table</code></b>(                  <code>dataframe</code>
)              –
              <div class="doc-md-description">
                <p>The resulting table.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1272" name="__codelineno-0-1272"></a><span class="k">def</span> <span class="nf">concat_CSVtable</span><span class="p">(</span><span class="n">filename_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>                    <span class="n">sort_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a><span class="sd">    Concatenate CSV tables.</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a><span class="sd">    filename_list : list</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a><span class="sd">        A list of CSV filename.</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a><span class="sd">    sort_by : str, optional</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a><span class="sd">        The column name in which the dataframe is sorted. </span>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a><span class="sd">        The default is &#39;Date&#39;.</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a><span class="sd">    master_table : dataframe</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a><span class="sd">        The resulting table.</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>    <span class="n">master_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filename_list</span><span class="p">:</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>        <span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>        <span class="n">master_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">master_table</span><span class="p">,</span><span class="n">temp</span><span class="p">])</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>    <span class="n">master_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">sort_by</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>    <span class="k">return</span> <span class="n">master_table</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.extract_lag_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_lag_data</span><span class="p">(</span><span class="n">signal_data</span><span class="p">,</span> <span class="n">history_data</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">lag_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">time_proxy</span><span class="o">=</span><span class="s1">&#39;PERIOD&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extract the Lag data based on a given date.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>signal_data</code></b>
                  (<code>pandas dataframe</code>)
              –
              <div class="doc-md-description">
                <p>The signal data.</p>
              </div>
            </li>
            <li>
              <b><code>history_data</code></b>
                  (<code>pandas dataframe</code>)
              –
              <div class="doc-md-description">
                <p>The historical data.</p>
              </div>
            </li>
            <li>
              <b><code>date</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The date of interest, format like this "2024-01-10".</p>
              </div>
            </li>
            <li>
              <b><code>lag_size</code></b>
                  (<code>int</code>, default:
                      <code>5</code>
)
              –
              <div class="doc-md-description">
                <p>The size of the lag window. The default is 5 (days).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>signal_data_lag</code></b>(                  <code>pandas data frame</code>
)              –
              <div class="doc-md-description">
                <p>The signal data five (lag_size) days prior to the given date.</p>
              </div>
            </li>
            <li>
<b><code>history_data_lag</code></b>(                  <code>pandas data frame</code>
)              –
              <div class="doc-md-description">
                <p>The historical data five (lag_size) days prior to the given date.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-601" name="__codelineno-0-601"></a><span class="k">def</span> <span class="nf">extract_lag_data</span><span class="p">(</span><span class="n">signal_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>                     <span class="n">history_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>                     <span class="n">date</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>                     <span class="n">lag_size</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>                     <span class="n">time_proxy</span> <span class="o">=</span> <span class="s2">&quot;PERIOD&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> \
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>                     <span class="nb">tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a><span class="sd">    Extract the Lag data based on a given date.</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a><span class="sd">    signal_data : pandas dataframe</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a><span class="sd">        The signal data.</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="sd">    history_data : pandas dataframe</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a><span class="sd">        The historical data.</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a><span class="sd">    date : str</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a><span class="sd">        The date of interest, format like this &quot;2024-01-10&quot;.</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="sd">    lag_size : int, optional</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">        The size of the lag window. The default is 5 (days).</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a><span class="sd">    -------</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a><span class="sd">    signal_data_lag : pandas data frame</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a><span class="sd">        The signal data five (lag_size) days prior to the given date.</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a><span class="sd">    history_data_lag : pandas data frame</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a><span class="sd">        The historical data five (lag_size) days prior to the given date.</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>    <span class="c1"># Find the row index of the history data first</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>    <span class="c1">#row_index = history_data.index[history_data[&#39;Date&#39;] == date].tolist()[0]</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>    <span class="n">row_index</span> <span class="o">=</span> <span class="n">history_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">history_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">date</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>    <span class="c1">#lag_days = datetime.timedelta(days=lag_size)</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>    <span class="c1">#lag5days = row_index-lag_days</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>    <span class="c1">#lag1day = row_index - datetime.timedelta(days=1)</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>    <span class="c1"># extract exactly 5 (default) lag days array</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>    <span class="n">history_data_lag</span> <span class="o">=</span> <span class="n">history_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row_index</span><span class="o">-</span><span class="n">lag_size</span><span class="p">:</span><span class="n">row_index</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>    <span class="c1"># history_data_lag = history_data.loc[lag5days:lag1day]</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>    <span class="c1"># use the relevant date from history data to get signal data to ensure matching date</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>    <span class="n">window</span> <span class="o">=</span> <span class="n">history_data_lag</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>    <span class="c1"># turn Timstamp into string</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>    <span class="c1">#window = [str(window[i])[0:10] for i in range(lag_size)]</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>    <span class="c1">#Store the lag signal data in a list</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>    <span class="c1">#signal_data_lag = signal_data[signal_data[&#39;Forecast Period&#39;] == window[0]]</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>    <span class="n">signal_data_lag</span> <span class="o">=</span> <span class="n">signal_data</span><span class="p">[</span><span class="n">signal_data</span><span class="p">[</span><span class="n">time_proxy</span><span class="p">]</span> <span class="o">==</span> <span class="n">window</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lag_size</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>        <span class="n">curve</span> <span class="o">=</span> <span class="n">signal_data</span><span class="p">[</span><span class="n">signal_data</span><span class="p">[</span><span class="n">time_proxy</span><span class="p">]</span> <span class="o">==</span> <span class="n">window</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>        <span class="n">signal_data_lag</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">signal_data_lag</span><span class="p">,</span> <span class="n">curve</span><span class="p">])</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>    <span class="k">return</span> <span class="n">signal_data_lag</span><span class="p">,</span> <span class="n">history_data_lag</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.find_closest_price" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_closest_price</span><span class="p">(</span><span class="n">day_minute_data</span><span class="p">,</span> <span class="n">target_hr</span><span class="o">=</span><span class="s1">&#39;0330&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;forward&#39;</span><span class="p">,</span> <span class="n">price_proxy</span><span class="o">=</span><span class="s1">&#39;Open&#39;</span><span class="p">,</span> <span class="n">time_proxy</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">search_time</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>A method to find the closest price next to a traget hour</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>day_minute_data</code></b>
                  (<code>DataFrame</code>)
              –
              <div class="doc-md-description">
                <p>The minute pricing data.</p>
              </div>
            </li>
            <li>
              <b><code>target_hr</code></b>
                  (<code>str</code>, default:
                      <code>&#39;0330&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The target hour for the search. The default is '0330'.</p>
              </div>
            </li>
            <li>
              <b><code>direction</code></b>
                  (<code>dtr</code>, default:
                      <code>&#39;forward&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>To search the list either 'backward' or 'forward'. 
The default is 'forward'.</p>
              </div>
            </li>
            <li>
              <b><code>step</code></b>
                  (<code>int</code>, default:
                      <code>1</code>
)
              –
              <div class="doc-md-description">
                <p>The step size of the search. The default is 1.</p>
              </div>
            </li>
            <li>
              <b><code>search_time</code></b>
                  (<code>int</code>, default:
                      <code>1000</code>
)
              –
              <div class="doc-md-description">
                <p>The total minutes (steps) of the search. The default is 1000.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>target_hr_dt</code></b>(                  <code><span title="datetime.datetime">datetime</span></code>
)              –
              <div class="doc-md-description">
                <p>The datetime of the closest hour to the target.</p>
              </div>
            </li>
            <li>
                  <code>float</code>
              –
              <div class="doc-md-description">
                <p>The target price.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-658" name="__codelineno-0-658"></a><span class="k">def</span> <span class="nf">find_closest_price</span><span class="p">(</span><span class="n">day_minute_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>                       <span class="n">target_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;0330&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>                       <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;forward&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>                       <span class="n">price_proxy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Open&#39;</span><span class="p">,</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>                       <span class="n">time_proxy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>                       <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>                       <span class="n">search_time</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">-&gt;</span> \
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>                       <span class="nb">tuple</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>    
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">    A method to find the closest price next to a traget hour</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">    day_minute_data : DataFrame</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="sd">        The minute pricing data.</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="sd">    target_hr : str, optional</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="sd">        The target hour for the search. The default is &#39;0330&#39;.</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a><span class="sd">    direction : dtr, optional</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a><span class="sd">        To search the list either &#39;backward&#39; or &#39;forward&#39;. </span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a><span class="sd">        The default is &#39;forward&#39;.</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="sd">    step : int, optional</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a><span class="sd">        The step size of the search. The default is 1.</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a><span class="sd">    search_time : int, optional</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="sd">        The total minutes (steps) of the search. The default is 1000.</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">    -------</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">    target_hr_dt : datetime.datetime</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">        The datetime of the closest hour to the target.</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">    float</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">        The target price.</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>    <span class="c1"># If the input is forward, the loop search forward a unit of minute (step)</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;forward&#39;</span><span class="p">:</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>        <span class="n">step</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">*</span> <span class="n">step</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>    <span class="c1"># If the input is backward, the loop search back a unit of minute (step)</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>    <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;backward&#39;</span><span class="p">:</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>        <span class="n">step</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span> <span class="n">step</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>    <span class="n">target_hr_dt</span><span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">target_hr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]),</span><span class="n">minute</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">target_hr</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]))</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>    <span class="c1">#initial estimation of the target price</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>    <span class="n">target_price</span> <span class="o">=</span> <span class="n">day_minute_data</span><span class="p">[</span><span class="n">day_minute_data</span><span class="p">[</span><span class="n">time_proxy</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_hr_dt</span><span class="p">][</span><span class="n">price_proxy</span><span class="p">]</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>    <span class="c1">#loop through the next 30 minutes to find the opening price    </span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">search_time</span><span class="p">):</span>    
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_price</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>            <span class="n">delta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span> <span class="o">=</span> <span class="n">step</span><span class="p">)</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>            <span class="c1"># Note that the datetime.datetime.today() is a place holder, it does  </span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>            <span class="c1"># not affect the target_hr_dt vatriables.</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>            <span class="n">target_hr_dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> 
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>                            <span class="n">target_hr_dt</span><span class="p">)</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>            <span class="c1">#print(i, target_hr_dt)</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>            <span class="n">target_price</span> <span class="o">=</span> <span class="n">day_minute_data</span><span class="p">[</span><span class="n">day_minute_data</span><span class="p">[</span><span class="n">time_proxy</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_hr_dt</span><span class="p">][</span><span class="n">price_proxy</span><span class="p">]</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>    <span class="n">target_price</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">target_price</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="c1"># make sure that this is float</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>    <span class="k">return</span> <span class="n">target_hr_dt</span><span class="p">,</span> <span class="n">target_price</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.find_closest_price_datetime" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_closest_price_datetime</span><span class="p">(</span><span class="n">day_minute_data</span><span class="p">,</span> <span class="n">target_date</span><span class="p">,</span> <span class="n">target_hr</span><span class="o">=</span><span class="s1">&#39;0330&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;forward&#39;</span><span class="p">,</span> <span class="n">price_proxy</span><span class="o">=</span><span class="s1">&#39;Open&#39;</span><span class="p">,</span> <span class="n">time_proxy</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">date_proxy</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">search_time</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>A method to find the closest price next to a traget date and hour</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>day_minute_data</code></b>
                  (<code>DataFrame</code>)
              –
              <div class="doc-md-description">
                <p>The minute pricing data.</p>
              </div>
            </li>
            <li>
              <b><code>target_hr</code></b>
                  (<code>str</code>, default:
                      <code>&#39;0330&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The target hour for the search. The default is '0330'.</p>
              </div>
            </li>
            <li>
              <b><code>direction</code></b>
                  (<code>dtr</code>, default:
                      <code>&#39;forward&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>To search the list either 'backward' or 'forward'. 
The default is 'forward'.</p>
              </div>
            </li>
            <li>
              <b><code>step</code></b>
                  (<code>int</code>, default:
                      <code>1</code>
)
              –
              <div class="doc-md-description">
                <p>The step size of the search. The default is 1.</p>
              </div>
            </li>
            <li>
              <b><code>search_time</code></b>
                  (<code>int</code>, default:
                      <code>1000</code>
)
              –
              <div class="doc-md-description">
                <p>The total minutes (steps) of the search. The default is 1000.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>target_hr_dt</code></b>(                  <code><span title="datetime.datetime">datetime</span></code>
)              –
              <div class="doc-md-description">
                <p>The datetime of the closest hour to the target.</p>
              </div>
            </li>
            <li>
                  <code>float</code>
              –
              <div class="doc-md-description">
                <p>The target price.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-719" name="__codelineno-0-719"></a><span class="nd">@util</span><span class="o">.</span><span class="n">time_it</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="k">def</span> <span class="nf">find_closest_price_datetime</span><span class="p">(</span><span class="n">day_minute_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>                                <span class="n">target_date</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>                                <span class="n">target_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;0330&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>                                <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;forward&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>                                <span class="n">price_proxy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Open&#39;</span><span class="p">,</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>                                <span class="n">time_proxy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>                                <span class="n">date_proxy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span><span class="p">,</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>                                <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>                                <span class="n">search_time</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">-&gt;</span> \
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>                                <span class="nb">tuple</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>    
<a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a><span class="sd">    A method to find the closest price next to a traget date and hour</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">    day_minute_data : DataFrame</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="sd">        The minute pricing data.</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">    target_hr : str, optional</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a><span class="sd">        The target hour for the search. The default is &#39;0330&#39;.</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="sd">    direction : dtr, optional</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a><span class="sd">        To search the list either &#39;backward&#39; or &#39;forward&#39;. </span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">        The default is &#39;forward&#39;.</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a><span class="sd">    step : int, optional</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a><span class="sd">        The step size of the search. The default is 1.</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a><span class="sd">    search_time : int, optional</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a><span class="sd">        The total minutes (steps) of the search. The default is 1000.</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a><span class="sd">    -------</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="sd">    target_hr_dt : datetime.datetime</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a><span class="sd">        The datetime of the closest hour to the target.</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a><span class="sd">    float</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="sd">        The target price.</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>    <span class="c1"># If the input is forward, the loop search forward a unit of minute (step)</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;forward&#39;</span><span class="p">:</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>        <span class="n">step</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">*</span> <span class="n">step</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>    <span class="c1"># If the input is backward, the loop search back a unit of minute (step)</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>    <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;backward&#39;</span><span class="p">:</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>        <span class="n">step</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span> <span class="n">step</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>    <span class="n">target_hr_dt</span><span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">target_hr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]),</span><span class="n">minute</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">target_hr</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]))</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>    <span class="n">day_minute_data</span> <span class="o">=</span> <span class="n">day_minute_data</span><span class="p">[</span><span class="n">day_minute_data</span><span class="p">[</span><span class="n">date_proxy</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_date</span><span class="p">]</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">target_date</span><span class="p">,</span> <span class="n">day_minute_data</span><span class="p">)</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>    <span class="c1">#initial estimation of the target price</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>    <span class="n">target_price</span> <span class="o">=</span> <span class="n">day_minute_data</span><span class="p">[</span><span class="n">day_minute_data</span><span class="p">[</span><span class="n">time_proxy</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_hr_dt</span><span class="p">][</span><span class="n">price_proxy</span><span class="p">]</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>    <span class="c1">#loop through the next 30 minutes to find the opening price    </span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">search_time</span><span class="p">):</span>    
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_price</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>            <span class="n">delta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span> <span class="o">=</span> <span class="n">step</span><span class="p">)</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>            <span class="c1"># Note that the datetime.datetime.today() is a place holder, it does  </span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>            <span class="c1"># not affect the target_hr_dt vatriables.</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>            <span class="n">target_hr_dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> 
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>                            <span class="n">target_hr_dt</span><span class="p">)</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>            <span class="c1">#print(i, target_hr_dt)</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>            <span class="n">target_price</span> <span class="o">=</span> <span class="n">day_minute_data</span><span class="p">[</span><span class="n">day_minute_data</span><span class="p">[</span><span class="n">time_proxy</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_hr_dt</span><span class="p">][</span><span class="n">price_proxy</span><span class="p">]</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">target_price</span><span class="p">)</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>    <span class="n">target_price</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">target_price</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="c1"># make sure that this is float</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>    <span class="k">return</span> <span class="n">target_hr_dt</span><span class="p">,</span> <span class="n">target_price</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.find_crossover" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_crossover</span><span class="p">(</span><span class="n">input_array</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>A function that find the crossover points' indicies. It finds the points right
after either rise above, or drop below the threshold value.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>input_array</code></b>
                  (<code>numpy array</code>)
              –
              <div class="doc-md-description">
                <p>A 1D numpy array with only numbers.</p>
              </div>
            </li>
            <li>
              <b><code>threshold</code></b>
                  (<code>float, list, numpy array</code>)
              –
              <div class="doc-md-description">
                <p>the threshold value.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>dict</code>
              –
              <div class="doc-md-description">
                <p>The 'rise' value contains a numpy array containing the indicies of 
points that rise above the the threshold.
The 'drop' value contains a numpy array containing the indicies of 
points that drop below the the threshold.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span>
<span class="normal"><a href="#__codelineno-0-918">918</a></span>
<span class="normal"><a href="#__codelineno-0-919">919</a></span>
<span class="normal"><a href="#__codelineno-0-920">920</a></span>
<span class="normal"><a href="#__codelineno-0-921">921</a></span>
<span class="normal"><a href="#__codelineno-0-922">922</a></span>
<span class="normal"><a href="#__codelineno-0-923">923</a></span>
<span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span>
<span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-891" name="__codelineno-0-891"></a><span class="k">def</span> <span class="nf">find_crossover</span><span class="p">(</span><span class="n">input_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>                   <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="o">|</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a><span class="sd">    A function that find the crossover points&#39; indicies. It finds the points right</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a><span class="sd">    after either rise above, or drop below the threshold value.</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a><span class="sd">    input_array : numpy array</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a><span class="sd">        A 1D numpy array with only numbers.</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a><span class="sd">    threshold : float, list, numpy array</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a><span class="sd">        the threshold value.</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a><span class="sd">    -------</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a><span class="sd">    dict</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a><span class="sd">        The &#39;rise&#39; value contains a numpy array containing the indicies of </span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a><span class="sd">        points that rise above the the threshold.</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a><span class="sd">        The &#39;drop&#39; value contains a numpy array containing the indicies of </span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a><span class="sd">        points that drop below the the threshold.</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>        <span class="c1"># make a numpy array of the threshold value    </span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>        <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_array</span><span class="p">))</span> 
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>    <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> \
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>                                        <span class="nb">len</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_array</span><span class="p">):</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Mismatch input and threshold arraty length.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_array</span><span class="p">):</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>        <span class="c1"># make a numpy array of the threshold value    </span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>        <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_array</span><span class="p">):</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>        <span class="k">pass</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>    <span class="c1"># The difference between the input value and the threshold number</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>    <span class="c1"># Positive values mean the input is higher than threshold</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>    <span class="c1"># Negative values mean the input is lower than threshold</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>    <span class="n">delta</span> <span class="o">=</span> <span class="n">input_array</span> <span class="o">-</span> <span class="n">threshold</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>    <span class="c1"># This is an array 1 unit in the past</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>    <span class="n">delta_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]),</span> <span class="n">delta</span><span class="p">])[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>    <span class="c1"># IF delta[i] &gt; delta_lag[i], then the price rise above threshold</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>    <span class="c1"># Because all elements are either +1, -1 or 0, the larger value has to be +1.</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>    <span class="c1"># np.sign(delta) = +1, while np.sign(delta_lag) = -1 means yesterday the value </span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>    <span class="c1"># is lower than threshold and today&#39;s value is higher than the threshold-&gt; rise above</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>    <span class="n">indices_rise_above</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">delta_lag</span><span class="p">))</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>    <span class="c1"># IF delta[i] &lt; delta_lag[i], then the price drop below threshold</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>    <span class="n">indices_drop_below</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">delta_lag</span><span class="p">))</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>    <span class="c1"># Produce a dic of indicies for below and above</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;rise&#39;</span><span class="p">:</span> <span class="n">indices_rise_above</span><span class="p">,</span> 
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>            <span class="s1">&#39;drop&#39;</span><span class="p">:</span> <span class="n">indices_drop_below</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.find_minute_EES" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_minute_EES</span><span class="p">(</span><span class="n">histroy_data_intraday</span><span class="p">,</span> <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> <span class="n">stop_exit</span><span class="p">,</span> <span class="n">open_hr</span><span class="o">=</span><span class="s1">&#39;0330&#39;</span><span class="p">,</span> <span class="n">close_hr</span><span class="o">=</span><span class="s1">&#39;1930&#39;</span><span class="p">,</span> <span class="n">price_proxy</span><span class="o">=</span><span class="s1">&#39;Open&#39;</span><span class="p">,</span> <span class="n">time_proxy</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">date_proxy</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;Neutral&#39;</span><span class="p">,</span> <span class="n">close_trade_hr</span><span class="o">=</span><span class="s1">&#39;1925&#39;</span><span class="p">,</span> <span class="n">dt_scale</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Find the points of crossover given a set of EES value in a time-series of 
minute intraday data.
This function is the key for crossover loops in the backtest</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>histroy_data_intraday</code></b>
                  (<code>dataframe</code>)
              –
              <div class="doc-md-description">
                <p>The histort intraday minute data. This assume the file contains the 
ohlc value of the day</p>
              </div>
            </li>
            <li>
              <b><code>target_entry</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>target entry price.</p>
              </div>
            </li>
            <li>
              <b><code>target_exit</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>target exit price.</p>
              </div>
            </li>
            <li>
              <b><code>stop_exit</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>target stop loss price.</p>
              </div>
            </li>
            <li>
              <b><code>open_hr</code></b>
                  (<code>str</code>, default:
                      <code>&#39;0330&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The opening hour of trade in military time format. 
The default is "0330".</p>
              </div>
            </li>
            <li>
              <b><code>close_hr</code></b>
                  (<code>str</code>, default:
                      <code>&#39;1930&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The closing hour of trade in military time format. 
The default is "1930".</p>
              </div>
            </li>
            <li>
              <b><code>price_proxy</code></b>
                  (<code>str</code>, default:
                      <code>&#39;Open&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The price approximator. The default uses the opening price of each 
minute as the price indicator. It calls in the 'Open' column in the 
history intradday minute dataframe
The default is 'Open'.</p>
              </div>
            </li>
            <li>
              <b><code>time_prox</code></b>
              –
              <div class="doc-md-description">
                <p>The time proxy. This function assume the input time data come fomr the 
'Time' column of the dataframe. 
The default is 'Time'.</p>
              </div>
            </li>
            <li>
              <b><code>direction</code></b>
                  (<code>str</code>, default:
                      <code>&#39;Neutral&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Trade direction. Either "Buy", "Sell", or "Neutral".
The default is 'Neutral'.</p>
              </div>
            </li>
            <li>
              <b><code>close_trade_hr</code></b>
                  (<code>str</code>, default:
                      <code>&#39;1925&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The final minute to finish off the trade in military time format. 
The default is '1925'.</p>
              </div>
            </li>
            <li>
              <b><code>dt_scale</code></b>
                  (<code>str</code>, default:
                      <code>&#39;datetime&#39;</code>
)
              –
              <div class="doc-md-description">
                
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>ValueError</code>
              –
              <div class="doc-md-description">
                <p>Direction data can only be either "Buy", "Sell", or "Neutral".</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>EES_dict</code></b>(                  <code>dict</code>
)              –
              <div class="doc-md-description">
                <p>A dictionary that cantains the possible EES points and time.
It has the following format:
    {'entry': [(entry_times,entry_pts), ...],
    'exit': [(exit_times,exit_pts), ...],
    'stop': [(stop_times,stop_pts), ...],
    'open': (open_datetime, open_pt),
    'close': (close_datetime, close_pt)}</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-944" name="__codelineno-0-944"></a><span class="k">def</span> <span class="nf">find_minute_EES</span><span class="p">(</span><span class="n">histroy_data_intraday</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>                    <span class="n">target_entry</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">stop_exit</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>                    <span class="n">open_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;0330&quot;</span><span class="p">,</span> <span class="n">close_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1930&quot;</span><span class="p">,</span> 
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>                    <span class="n">price_proxy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Open&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>                    <span class="n">time_proxy</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>                    <span class="n">date_proxy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>                    <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Neutral&#39;</span><span class="p">,</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>                    <span class="n">close_trade_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;1925&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>                    <span class="n">dt_scale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;datetime&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a><span class="sd">    Find the points of crossover given a set of EES value in a time-series of </span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a><span class="sd">    minute intraday data.</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a><span class="sd">    This function is the key for crossover loops in the backtest</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a><span class="sd">    histroy_data_intraday : dataframe</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a><span class="sd">        The histort intraday minute data. This assume the file contains the </span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a><span class="sd">        ohlc value of the day</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="sd">    target_entry : float </span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="sd">        target entry price.</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a><span class="sd">    target_exit : float</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a><span class="sd">        target exit price.</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a><span class="sd">    stop_exit : float</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a><span class="sd">        target stop loss price.</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a><span class="sd">    open_hr : str, optional</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a><span class="sd">        The opening hour of trade in military time format. </span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a><span class="sd">        The default is &quot;0330&quot;.</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a><span class="sd">    close_hr : str, optional</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a><span class="sd">        The closing hour of trade in military time format. </span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a><span class="sd">        The default is &quot;1930&quot;.</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a><span class="sd">    price_proxy : str, optional</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a><span class="sd">        The price approximator. The default uses the opening price of each </span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a><span class="sd">        minute as the price indicator. It calls in the &#39;Open&#39; column in the </span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a><span class="sd">        history intradday minute dataframe</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a><span class="sd">        The default is &#39;Open&#39;.</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a><span class="sd">    time_prox: </span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a><span class="sd">        The time proxy. This function assume the input time data come fomr the </span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a><span class="sd">        &#39;Time&#39; column of the dataframe. </span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a><span class="sd">        The default is &#39;Time&#39;.</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a><span class="sd">    direction : str, optional</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a><span class="sd">        Trade direction. Either &quot;Buy&quot;, &quot;Sell&quot;, or &quot;Neutral&quot;.</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a><span class="sd">        The default is &#39;Neutral&#39;.</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a><span class="sd">    close_trade_hr : str, optional</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a><span class="sd">        The final minute to finish off the trade in military time format. </span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a><span class="sd">        The default is &#39;1925&#39;.</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a><span class="sd">    dt_scale :</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a><span class="sd">    ------</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a><span class="sd">    ValueError</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a><span class="sd">        Direction data can only be either &quot;Buy&quot;, &quot;Sell&quot;, or &quot;Neutral&quot;.</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a><span class="sd">    -------</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a><span class="sd">    EES_dict : dict</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a><span class="sd">        A dictionary that cantains the possible EES points and time.</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a><span class="sd">        It has the following format:</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a><span class="sd">            {&#39;entry&#39;: [(entry_times,entry_pts), ...],</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a><span class="sd">            &#39;exit&#39;: [(exit_times,exit_pts), ...],</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a><span class="sd">            &#39;stop&#39;: [(stop_times,stop_pts), ...],</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a><span class="sd">            &#39;open&#39;: (open_datetime, open_pt),</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a><span class="sd">            &#39;close&#39;: (close_datetime, close_pt)}</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>    <span class="c1"># (This function can be made in one more layer of abstraction. Work on this later)</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>    <span class="c1"># define subsample. turn the pandas series into a numpy array</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>    <span class="n">price_list</span> <span class="o">=</span> <span class="n">histroy_data_intraday</span><span class="p">[</span><span class="n">price_proxy</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>    <span class="n">time_list</span> <span class="o">=</span> <span class="n">histroy_data_intraday</span><span class="p">[</span><span class="n">time_proxy</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>    <span class="c1">#print(&quot;time_list&quot;, time_list[0], type(time_list[0]))</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>    <span class="c1"># read in date list</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>    <span class="n">date_list</span> <span class="o">=</span> <span class="n">histroy_data_intraday</span><span class="p">[</span><span class="n">date_proxy</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> 
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>    <span class="c1"># Temporary solution. Can be made using two to three time layer</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>    <span class="c1"># make datetime list</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>    <span class="n">datetime_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">t</span><span class="p">)</span> \
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>                              <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">date_list</span><span class="p">,</span><span class="n">time_list</span><span class="p">)])</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>    <span class="k">if</span> <span class="n">dt_scale</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>        <span class="n">time_proxy_list</span> <span class="o">=</span> <span class="n">time_list</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>    <span class="k">elif</span> <span class="n">dt_scale</span> <span class="o">==</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>        <span class="n">time_proxy_list</span> <span class="o">=</span> <span class="n">date_list</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>    <span class="k">elif</span> <span class="n">dt_scale</span> <span class="o">==</span> <span class="s1">&#39;datetime&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>        <span class="n">time_proxy_list</span> <span class="o">=</span> <span class="n">datetime_list</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>    <span class="c1"># Find the crossover indices</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>    <span class="n">entry_pt_dict</span> <span class="o">=</span> <span class="n">find_crossover</span><span class="p">(</span><span class="n">price_list</span><span class="p">,</span> <span class="n">target_entry</span><span class="p">)</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>    <span class="n">exit_pt_dict</span> <span class="o">=</span> <span class="n">find_crossover</span><span class="p">(</span><span class="n">price_list</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">)</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>    <span class="n">stop_pt_dict</span> <span class="o">=</span> <span class="n">find_crossover</span><span class="p">(</span><span class="n">price_list</span><span class="p">,</span> <span class="n">stop_exit</span><span class="p">)</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;Neitral&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>        <span class="c1">#print(&quot;Neutral day&quot;)</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>        <span class="c1"># for &#39;Neutral&#39; action, all info are empty</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>        <span class="n">entry_pts</span><span class="p">,</span> <span class="n">entry_times</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>        <span class="n">exit_pts</span><span class="p">,</span> <span class="n">exit_times</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>        <span class="n">stop_pts</span><span class="p">,</span> <span class="n">stop_times</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>    <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;Buy&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>        <span class="c1">#print(&quot;Finding Buy points.&quot;)</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>        <span class="c1"># for &#39;Buy&#39; action EES sequence is drop,rise,drop</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>        <span class="n">entry_pts</span> <span class="o">=</span> <span class="n">price_list</span><span class="p">[</span><span class="n">entry_pt_dict</span><span class="p">[</span><span class="s1">&#39;drop&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>        <span class="n">entry_times</span> <span class="o">=</span> <span class="n">time_proxy_list</span><span class="p">[</span><span class="n">entry_pt_dict</span><span class="p">[</span><span class="s1">&#39;drop&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>        <span class="n">exit_pts</span> <span class="o">=</span> <span class="n">price_list</span><span class="p">[</span><span class="n">exit_pt_dict</span><span class="p">[</span><span class="s1">&#39;rise&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>        <span class="n">exit_times</span> <span class="o">=</span> <span class="n">time_proxy_list</span><span class="p">[</span><span class="n">exit_pt_dict</span><span class="p">[</span><span class="s1">&#39;rise&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>        <span class="n">stop_pts</span> <span class="o">=</span> <span class="n">price_list</span><span class="p">[</span><span class="n">stop_pt_dict</span><span class="p">[</span><span class="s1">&#39;drop&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>        <span class="n">stop_times</span> <span class="o">=</span> <span class="n">time_proxy_list</span><span class="p">[</span><span class="n">stop_pt_dict</span><span class="p">[</span><span class="s1">&#39;drop&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>    <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;Sell&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>        <span class="c1">#print(&quot;Finding Sell points.&quot;)</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>        <span class="c1"># for &#39;Sell&#39; action EES sequence is rise,drop,rise</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>        <span class="n">entry_pts</span> <span class="o">=</span> <span class="n">price_list</span><span class="p">[</span><span class="n">entry_pt_dict</span><span class="p">[</span><span class="s1">&#39;rise&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>        <span class="n">entry_times</span> <span class="o">=</span> <span class="n">time_proxy_list</span><span class="p">[</span><span class="n">entry_pt_dict</span><span class="p">[</span><span class="s1">&#39;rise&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>        <span class="n">exit_pts</span> <span class="o">=</span> <span class="n">price_list</span><span class="p">[</span><span class="n">exit_pt_dict</span><span class="p">[</span><span class="s1">&#39;drop&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>        <span class="n">exit_times</span> <span class="o">=</span> <span class="n">time_proxy_list</span><span class="p">[</span><span class="n">exit_pt_dict</span><span class="p">[</span><span class="s1">&#39;drop&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>        <span class="n">stop_pts</span> <span class="o">=</span> <span class="n">price_list</span><span class="p">[</span><span class="n">stop_pt_dict</span><span class="p">[</span><span class="s1">&#39;rise&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>        <span class="n">stop_times</span> <span class="o">=</span> <span class="n">time_proxy_list</span><span class="p">[</span><span class="n">stop_pt_dict</span><span class="p">[</span><span class="s1">&#39;rise&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Direction has to be either Buy, Sell, or Neutral.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>    <span class="c1"># Define the opening/closing time and closing price. </span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>    <span class="c1"># Here we choose 19:25 for final trade</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>    <span class="n">open_hr_str</span> <span class="o">=</span> <span class="n">open_hr</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H%M&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>    <span class="n">close_hr_str</span> <span class="o">=</span> <span class="n">close_hr</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H%M&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>    <span class="c1">## Find the closest price and datettime instead of having it at exactly the open time</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>    <span class="n">open_date_new</span><span class="p">,</span> <span class="n">open_pt</span> <span class="o">=</span> <span class="n">find_closest_price</span><span class="p">(</span><span class="n">histroy_data_intraday</span><span class="p">,</span> 
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>                                                  <span class="n">target_hr</span> <span class="o">=</span> <span class="n">open_hr_str</span><span class="p">,</span> 
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>                                                  <span class="n">direction</span> <span class="o">=</span> <span class="s1">&#39;forward&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>                                                  <span class="n">price_proxy</span> <span class="o">=</span> <span class="n">price_proxy</span><span class="p">,</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>                                                  <span class="n">time_proxy</span> <span class="o">=</span> <span class="n">time_proxy</span><span class="p">)</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>    <span class="n">open_date</span> <span class="o">=</span> <span class="n">date_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">time_list</span><span class="o">==</span><span class="n">open_date_new</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>    <span class="n">open_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">open_date</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> 
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>                                               <span class="n">open_date_new</span><span class="p">)</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>    <span class="c1"># Find the closest price and datettime instead of having it at exactly the close time</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>    <span class="n">close_date_new</span><span class="p">,</span> <span class="n">close_pt</span> <span class="o">=</span> <span class="n">find_closest_price</span><span class="p">(</span><span class="n">histroy_data_intraday</span><span class="p">,</span> 
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>                                                  <span class="n">target_hr</span> <span class="o">=</span> <span class="n">close_hr_str</span><span class="p">,</span> 
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>                                                  <span class="n">direction</span> <span class="o">=</span> <span class="s1">&#39;backward&#39;</span><span class="p">,</span>   
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>                                                  <span class="n">price_proxy</span> <span class="o">=</span> <span class="n">price_proxy</span><span class="p">,</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>                                                  <span class="n">time_proxy</span> <span class="o">=</span> <span class="n">time_proxy</span><span class="p">)</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>    <span class="n">close_date</span> <span class="o">=</span> <span class="n">date_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">time_list</span><span class="o">==</span><span class="n">close_date_new</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>    <span class="n">close_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">close_date</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> 
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>                                               <span class="n">close_date_new</span><span class="p">)</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>    <span class="c1"># storage</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>    <span class="n">EES_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;entry&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">entry_times</span><span class="p">,</span><span class="n">entry_pts</span><span class="p">)),</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>                <span class="s1">&#39;exit&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">exit_times</span><span class="p">,</span><span class="n">exit_pts</span><span class="p">)),</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>                <span class="s1">&#39;stop&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">stop_times</span><span class="p">,</span><span class="n">stop_pts</span><span class="p">)),</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>                <span class="s1">&#39;open&#39;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">open_datetime</span><span class="p">,</span> <span class="n">open_pt</span><span class="p">)),</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>                <span class="s1">&#39;close&#39;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">close_datetime</span><span class="p">,</span> <span class="n">close_pt</span><span class="p">))}</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>    <span class="c1">#print(&#39;EES_dict&#39;, EES_dict[&#39;close&#39;])</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>    <span class="k">return</span> <span class="n">EES_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.find_minute_EES_long" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_minute_EES_long</span><span class="p">(</span><span class="n">histroy_data</span><span class="p">,</span> <span class="n">target_entry</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">,</span> <span class="n">stop_exit</span><span class="p">,</span> <span class="n">open_hr</span><span class="o">=</span><span class="s1">&#39;0330&#39;</span><span class="p">,</span> <span class="n">close_hr</span><span class="o">=</span><span class="s1">&#39;1930&#39;</span><span class="p">,</span> <span class="n">price_proxy</span><span class="o">=</span><span class="s1">&#39;Open&#39;</span><span class="p">,</span> <span class="n">time_proxy</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">date_proxy</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;Neutral&#39;</span><span class="p">,</span> <span class="n">close_trade_hr</span><span class="o">=</span><span class="s1">&#39;1925&#39;</span><span class="p">,</span> <span class="n">dt_scale</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="n">first_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">last_date</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Set the EES value given a time-series of minute intraday data.
This function is the key for crossover loops in the backtest</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>histroy_data_intraday</code></b>
                  (<code>dataframe</code>)
              –
              <div class="doc-md-description">
                <p>The histort intraday minute data. This assume the file contains the 
ohlc value of the day</p>
              </div>
            </li>
            <li>
              <b><code>target_entry</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>target entry price.</p>
              </div>
            </li>
            <li>
              <b><code>target_exit</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>target exit price.</p>
              </div>
            </li>
            <li>
              <b><code>stop_exit</code></b>
                  (<code>float</code>)
              –
              <div class="doc-md-description">
                <p>target stop loss price.</p>
              </div>
            </li>
            <li>
              <b><code>open_hr</code></b>
                  (<code>str</code>, default:
                      <code>&#39;0330&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The opening hour of trade in military time format. 
The default is "0330".</p>
              </div>
            </li>
            <li>
              <b><code>close_hr</code></b>
                  (<code>str</code>, default:
                      <code>&#39;1930&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The closing hour of trade in military time format. 
The default is "1930".</p>
              </div>
            </li>
            <li>
              <b><code>price_approx</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The price approximator. The default uses the opening price of each 
minute as the price indicator. It calls in the 'Open' column in the 
history intradday minute dataframe
The default is 'Open'.</p>
              </div>
            </li>
            <li>
              <b><code>time_prox</code></b>
              –
              <div class="doc-md-description">
                <p>The time proxy. This function assume the input time data come fomr the 
'Time' column of the dataframe. 
The default is 'Time'.</p>
              </div>
            </li>
            <li>
              <b><code>direction</code></b>
                  (<code>str</code>, default:
                      <code>&#39;Neutral&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Trade direction. Either "Buy", "Sell", or "Neutral".
The default is 'Neutral'.</p>
              </div>
            </li>
            <li>
              <b><code>close_trade_hr</code></b>
                  (<code>str</code>, default:
                      <code>&#39;1925&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The final minute to finish off the trade in military time format. 
The default is '1925'.</p>
              </div>
            </li>
            <li>
              <b><code>dt_scale</code></b>
                  (<code>str</code>, default:
                      <code>&#39;datetime&#39;</code>
)
              –
              <div class="doc-md-description">
                
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>ValueError</code>
              –
              <div class="doc-md-description">
                <p>Direction data can only be either "Buy", "Sell", or "Neutral".</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>EES_dict</code></b>(                  <code>dict</code>
)              –
              <div class="doc-md-description">
                <p>A dictionary that cantains the possible EES points and time.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span>
<span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1618" name="__codelineno-0-1618"></a><span class="k">def</span> <span class="nf">find_minute_EES_long</span><span class="p">(</span><span class="n">histroy_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>                         <span class="n">target_entry</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">stop_exit</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>                         <span class="n">open_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;0330&quot;</span><span class="p">,</span> <span class="n">close_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1930&quot;</span><span class="p">,</span> 
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>                         <span class="n">price_proxy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Open&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>                         <span class="n">time_proxy</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>                         <span class="n">date_proxy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>                         <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Neutral&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>                         <span class="n">close_trade_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;1925&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>                         <span class="n">dt_scale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;datetime&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>                         <span class="n">first_date</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">last_date</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a><span class="sd">    Set the EES value given a time-series of minute intraday data.</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a><span class="sd">    This function is the key for crossover loops in the backtest</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a><span class="sd">    histroy_data_intraday : dataframe</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a><span class="sd">        The histort intraday minute data. This assume the file contains the </span>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a><span class="sd">        ohlc value of the day</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a><span class="sd">    target_entry : float </span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a><span class="sd">        target entry price.</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a><span class="sd">    target_exit : float</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a><span class="sd">        target exit price.</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a><span class="sd">    stop_exit : float</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a><span class="sd">        target stop loss price.</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a><span class="sd">    open_hr : str, optional</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a><span class="sd">        The opening hour of trade in military time format. </span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a><span class="sd">        The default is &quot;0330&quot;.</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a><span class="sd">    close_hr : str, optional</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a><span class="sd">        The closing hour of trade in military time format. </span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a><span class="sd">        The default is &quot;1930&quot;.</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a><span class="sd">    price_approx : str, optional</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a><span class="sd">        The price approximator. The default uses the opening price of each </span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a><span class="sd">        minute as the price indicator. It calls in the &#39;Open&#39; column in the </span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a><span class="sd">        history intradday minute dataframe</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a><span class="sd">        The default is &#39;Open&#39;.</span>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a><span class="sd">    time_prox: </span>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a><span class="sd">        The time proxy. This function assume the input time data come fomr the </span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a><span class="sd">        &#39;Time&#39; column of the dataframe. </span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a><span class="sd">        The default is &#39;Time&#39;.</span>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a><span class="sd">    direction : str, optional</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a><span class="sd">        Trade direction. Either &quot;Buy&quot;, &quot;Sell&quot;, or &quot;Neutral&quot;.</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a><span class="sd">        The default is &#39;Neutral&#39;.</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a><span class="sd">    close_trade_hr : str, optional</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a><span class="sd">        The final minute to finish off the trade in military time format. </span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a><span class="sd">        The default is &#39;1925&#39;.</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a><span class="sd">    dt_scale :</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a><span class="sd">    ------</span>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a><span class="sd">    ValueError</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a><span class="sd">        Direction data can only be either &quot;Buy&quot;, &quot;Sell&quot;, or &quot;Neutral&quot;.</span>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a><span class="sd">    EES_dict : dict</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a><span class="sd">        A dictionary that cantains the possible EES points and time.</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>    <span class="c1"># (This function can be made in one more layer of abstraction. Work on this later)</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>    <span class="k">if</span> <span class="n">first_date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>        <span class="n">first_date</span> <span class="o">=</span> <span class="n">histroy_data</span><span class="p">[</span><span class="n">date_proxy</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>    <span class="k">if</span> <span class="n">last_date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>        <span class="n">last_date</span> <span class="o">=</span> <span class="n">histroy_data</span><span class="p">[</span><span class="n">date_proxy</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;first_date, last_date&#39;</span><span class="p">,</span> <span class="n">first_date</span><span class="p">,</span> <span class="n">last_date</span><span class="p">)</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>    <span class="c1"># define subsample. turn the pandas series into a numpy array</span>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>    <span class="n">price_list</span> <span class="o">=</span> <span class="n">histroy_data</span><span class="p">[</span><span class="n">price_proxy</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>    <span class="n">time_list</span> <span class="o">=</span> <span class="n">histroy_data</span><span class="p">[</span><span class="n">time_proxy</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>    <span class="c1"># read in date list</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>    <span class="n">date_list</span> <span class="o">=</span> <span class="n">histroy_data</span><span class="p">[</span><span class="n">date_proxy</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> 
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>    <span class="c1"># Temporary solution. Can be made using two to three time layer</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>    <span class="c1"># make datetime list</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>    <span class="n">datetime_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">t</span><span class="p">)</span> \
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>                              <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">date_list</span><span class="p">,</span><span class="n">time_list</span><span class="p">)])</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a>    <span class="k">if</span> <span class="n">dt_scale</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>        <span class="n">time_proxy_list</span> <span class="o">=</span> <span class="n">time_list</span>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a>    <span class="k">elif</span> <span class="n">dt_scale</span> <span class="o">==</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a>        <span class="n">time_proxy_list</span> <span class="o">=</span> <span class="n">date_list</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a>    <span class="k">elif</span> <span class="n">dt_scale</span> <span class="o">==</span> <span class="s1">&#39;datetime&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a>        <span class="n">time_proxy_list</span> <span class="o">=</span> <span class="n">datetime_list</span>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>    <span class="c1"># Find the crossover indices</span>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a>    <span class="n">entry_pt_dict</span> <span class="o">=</span> <span class="n">find_crossover</span><span class="p">(</span><span class="n">price_list</span><span class="p">,</span> <span class="n">target_entry</span><span class="p">)</span>
<a id="__codelineno-0-1705" name="__codelineno-0-1705"></a>    <span class="n">exit_pt_dict</span> <span class="o">=</span> <span class="n">find_crossover</span><span class="p">(</span><span class="n">price_list</span><span class="p">,</span> <span class="n">target_exit</span><span class="p">)</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706"></a>    <span class="n">stop_pt_dict</span> <span class="o">=</span> <span class="n">find_crossover</span><span class="p">(</span><span class="n">price_list</span><span class="p">,</span> <span class="n">stop_exit</span><span class="p">)</span>
<a id="__codelineno-0-1707" name="__codelineno-0-1707"></a>
<a id="__codelineno-0-1708" name="__codelineno-0-1708"></a>    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;Neitral&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709"></a>        <span class="c1">#print(&quot;Neutral day&quot;)</span>
<a id="__codelineno-0-1710" name="__codelineno-0-1710"></a>        <span class="c1"># for &#39;Neutral&#39; action, all info are empty</span>
<a id="__codelineno-0-1711" name="__codelineno-0-1711"></a>        <span class="n">entry_pts</span><span class="p">,</span> <span class="n">entry_times</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-1712" name="__codelineno-0-1712"></a>        <span class="n">exit_pts</span><span class="p">,</span> <span class="n">exit_times</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-1713" name="__codelineno-0-1713"></a>        <span class="n">stop_pts</span><span class="p">,</span> <span class="n">stop_times</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>
<a id="__codelineno-0-1715" name="__codelineno-0-1715"></a>    <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;Buy&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1716" name="__codelineno-0-1716"></a>        <span class="c1">#print(&quot;Finding Buy points.&quot;)</span>
<a id="__codelineno-0-1717" name="__codelineno-0-1717"></a>        <span class="c1"># for &#39;Buy&#39; action EES sequence is drop,rise,drop</span>
<a id="__codelineno-0-1718" name="__codelineno-0-1718"></a>        <span class="n">entry_pts</span> <span class="o">=</span> <span class="n">price_list</span><span class="p">[</span><span class="n">entry_pt_dict</span><span class="p">[</span><span class="s1">&#39;drop&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1719" name="__codelineno-0-1719"></a>        <span class="n">entry_times</span> <span class="o">=</span> <span class="n">time_proxy_list</span><span class="p">[</span><span class="n">entry_pt_dict</span><span class="p">[</span><span class="s1">&#39;drop&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1720" name="__codelineno-0-1720"></a>
<a id="__codelineno-0-1721" name="__codelineno-0-1721"></a>        <span class="n">exit_pts</span> <span class="o">=</span> <span class="n">price_list</span><span class="p">[</span><span class="n">exit_pt_dict</span><span class="p">[</span><span class="s1">&#39;rise&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1722" name="__codelineno-0-1722"></a>        <span class="n">exit_times</span> <span class="o">=</span> <span class="n">time_proxy_list</span><span class="p">[</span><span class="n">exit_pt_dict</span><span class="p">[</span><span class="s1">&#39;rise&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>
<a id="__codelineno-0-1724" name="__codelineno-0-1724"></a>        <span class="n">stop_pts</span> <span class="o">=</span> <span class="n">price_list</span><span class="p">[</span><span class="n">stop_pt_dict</span><span class="p">[</span><span class="s1">&#39;drop&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1725" name="__codelineno-0-1725"></a>        <span class="n">stop_times</span> <span class="o">=</span> <span class="n">time_proxy_list</span><span class="p">[</span><span class="n">stop_pt_dict</span><span class="p">[</span><span class="s1">&#39;drop&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1726" name="__codelineno-0-1726"></a>
<a id="__codelineno-0-1727" name="__codelineno-0-1727"></a>    <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;Sell&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>        <span class="c1">#print(&quot;Finding Sell points.&quot;)</span>
<a id="__codelineno-0-1729" name="__codelineno-0-1729"></a>        <span class="c1"># for &#39;Sell&#39; action EES sequence is rise,drop,rise</span>
<a id="__codelineno-0-1730" name="__codelineno-0-1730"></a>        <span class="n">entry_pts</span> <span class="o">=</span> <span class="n">price_list</span><span class="p">[</span><span class="n">entry_pt_dict</span><span class="p">[</span><span class="s1">&#39;rise&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1731" name="__codelineno-0-1731"></a>        <span class="n">entry_times</span> <span class="o">=</span> <span class="n">time_proxy_list</span><span class="p">[</span><span class="n">entry_pt_dict</span><span class="p">[</span><span class="s1">&#39;rise&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1732" name="__codelineno-0-1732"></a>
<a id="__codelineno-0-1733" name="__codelineno-0-1733"></a>        <span class="n">exit_pts</span> <span class="o">=</span> <span class="n">price_list</span><span class="p">[</span><span class="n">exit_pt_dict</span><span class="p">[</span><span class="s1">&#39;drop&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>        <span class="n">exit_times</span> <span class="o">=</span> <span class="n">time_proxy_list</span><span class="p">[</span><span class="n">exit_pt_dict</span><span class="p">[</span><span class="s1">&#39;drop&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>
<a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>        <span class="n">stop_pts</span> <span class="o">=</span> <span class="n">price_list</span><span class="p">[</span><span class="n">stop_pt_dict</span><span class="p">[</span><span class="s1">&#39;rise&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>        <span class="n">stop_times</span> <span class="o">=</span> <span class="n">time_proxy_list</span><span class="p">[</span><span class="n">stop_pt_dict</span><span class="p">[</span><span class="s1">&#39;rise&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Direction has to be either Buy, Sell, or Neutral.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>
<a id="__codelineno-0-1741" name="__codelineno-0-1741"></a>    <span class="c1"># Define the opening/closing time and closing price. </span>
<a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>    <span class="n">first_date_str</span> <span class="o">=</span> <span class="n">first_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1743" name="__codelineno-0-1743"></a>    <span class="n">last_date_str</span> <span class="o">=</span> <span class="n">last_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1744" name="__codelineno-0-1744"></a>    <span class="c1"># Here we choose 19:25 for final trade</span>
<a id="__codelineno-0-1745" name="__codelineno-0-1745"></a>    <span class="n">open_hr_str</span> <span class="o">=</span> <span class="n">open_hr</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H%M&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1746" name="__codelineno-0-1746"></a>    <span class="n">close_hr_str</span> <span class="o">=</span> <span class="n">close_hr</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H%M&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1747" name="__codelineno-0-1747"></a>
<a id="__codelineno-0-1748" name="__codelineno-0-1748"></a>    <span class="c1">## Find the closest price and datettime instead of having it at exactly the open time</span>
<a id="__codelineno-0-1749" name="__codelineno-0-1749"></a>    <span class="n">open_date_new</span><span class="p">,</span> <span class="n">open_pt</span> <span class="o">=</span> <span class="n">find_closest_price_datetime</span><span class="p">(</span><span class="n">histroy_data</span><span class="p">,</span> 
<a id="__codelineno-0-1750" name="__codelineno-0-1750"></a>                                                  <span class="n">target_date</span> <span class="o">=</span> <span class="n">first_date</span><span class="p">,</span> 
<a id="__codelineno-0-1751" name="__codelineno-0-1751"></a>                                                  <span class="n">target_hr</span> <span class="o">=</span> <span class="n">open_hr_str</span><span class="p">,</span>
<a id="__codelineno-0-1752" name="__codelineno-0-1752"></a>                                                  <span class="n">price_proxy</span><span class="o">=</span><span class="n">price_proxy</span><span class="p">,</span>
<a id="__codelineno-0-1753" name="__codelineno-0-1753"></a>                                                  <span class="n">direction</span> <span class="o">=</span> <span class="s1">&#39;forward&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1754" name="__codelineno-0-1754"></a>
<a id="__codelineno-0-1755" name="__codelineno-0-1755"></a>    <span class="c1">#open_date = date_list[np.where(time_list==open_date_new)[0]][0]</span>
<a id="__codelineno-0-1756" name="__codelineno-0-1756"></a>    <span class="n">open_date</span> <span class="o">=</span> <span class="n">datetime_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1757" name="__codelineno-0-1757"></a>    <span class="n">open_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">open_date</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> 
<a id="__codelineno-0-1758" name="__codelineno-0-1758"></a>                                               <span class="n">open_date_new</span><span class="p">)</span>
<a id="__codelineno-0-1759" name="__codelineno-0-1759"></a>
<a id="__codelineno-0-1760" name="__codelineno-0-1760"></a>    <span class="c1"># Find the closest price and datettime instead of having it at exactly the close time</span>
<a id="__codelineno-0-1761" name="__codelineno-0-1761"></a>    <span class="n">close_date_new</span><span class="p">,</span> <span class="n">close_pt</span> <span class="o">=</span> <span class="n">find_closest_price_datetime</span><span class="p">(</span><span class="n">histroy_data</span><span class="p">,</span> 
<a id="__codelineno-0-1762" name="__codelineno-0-1762"></a>                                                  <span class="n">target_date</span> <span class="o">=</span> <span class="n">last_date</span><span class="p">,</span>
<a id="__codelineno-0-1763" name="__codelineno-0-1763"></a>                                                  <span class="n">target_hr</span> <span class="o">=</span> <span class="n">close_hr_str</span><span class="p">,</span>
<a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>                                                  <span class="n">price_proxy</span><span class="o">=</span><span class="n">price_proxy</span><span class="p">,</span>
<a id="__codelineno-0-1765" name="__codelineno-0-1765"></a>                                                  <span class="n">direction</span> <span class="o">=</span> <span class="s1">&#39;backward&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1766" name="__codelineno-0-1766"></a>    <span class="c1">#close_date = date_list[np.where(time_list==close_date_new)[0]][0]</span>
<a id="__codelineno-0-1767" name="__codelineno-0-1767"></a>    <span class="n">close_date</span> <span class="o">=</span> <span class="n">datetime_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1768" name="__codelineno-0-1768"></a>    <span class="n">close_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">close_date</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> 
<a id="__codelineno-0-1769" name="__codelineno-0-1769"></a>                                               <span class="n">close_date_new</span><span class="p">)</span>
<a id="__codelineno-0-1770" name="__codelineno-0-1770"></a>
<a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>    <span class="c1"># storage</span>
<a id="__codelineno-0-1772" name="__codelineno-0-1772"></a>    <span class="n">EES_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;entry&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">entry_times</span><span class="p">,</span><span class="n">entry_pts</span><span class="p">)),</span>
<a id="__codelineno-0-1773" name="__codelineno-0-1773"></a>                <span class="s1">&#39;exit&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">exit_times</span><span class="p">,</span><span class="n">exit_pts</span><span class="p">)),</span>
<a id="__codelineno-0-1774" name="__codelineno-0-1774"></a>                <span class="s1">&#39;stop&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">stop_times</span><span class="p">,</span><span class="n">stop_pts</span><span class="p">)),</span>
<a id="__codelineno-0-1775" name="__codelineno-0-1775"></a>                <span class="s1">&#39;open&#39;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">open_datetime</span><span class="p">,</span> <span class="n">open_pt</span><span class="p">)),</span>
<a id="__codelineno-0-1776" name="__codelineno-0-1776"></a>                <span class="s1">&#39;close&#39;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">close_datetime</span><span class="p">,</span> <span class="n">close_pt</span><span class="p">))}</span>
<a id="__codelineno-0-1777" name="__codelineno-0-1777"></a>
<a id="__codelineno-0-1778" name="__codelineno-0-1778"></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;EES_dict&#39;</span><span class="p">,</span> <span class="n">EES_dict</span><span class="p">)</span>
<a id="__codelineno-0-1779" name="__codelineno-0-1779"></a>    <span class="k">return</span> <span class="n">EES_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.find_minute_EES_range" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_minute_EES_range</span><span class="p">(</span><span class="n">histroy_data_intraday</span><span class="p">,</span> <span class="n">target_entry_range</span><span class="p">,</span> <span class="n">target_exit_range</span><span class="p">,</span> <span class="n">stop_exit</span><span class="p">,</span> <span class="n">open_hr</span><span class="o">=</span><span class="s1">&#39;0330&#39;</span><span class="p">,</span> <span class="n">close_hr</span><span class="o">=</span><span class="s1">&#39;1930&#39;</span><span class="p">,</span> <span class="n">price_proxy</span><span class="o">=</span><span class="s1">&#39;Open&#39;</span><span class="p">,</span> <span class="n">date_proxy</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">time_proxy</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;Neutral&#39;</span><span class="p">,</span> <span class="n">dt_scale</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Find the points within a range of EES value in a time-series of minute 
intrday data.
This function is the key for range loop in backtesting.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>histroy_data_intraday</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>The historical data.</p>
              </div>
            </li>
            <li>
              <b><code>target_entry_range</code></b>
                  (<code>list[float | int] | tuple[float | int]</code>)
              –
              <div class="doc-md-description">
                <p>A range of entry price in the format of 
[lower_bound_price, upper_bound_price].</p>
              </div>
            </li>
            <li>
              <b><code>target_exit_range</code></b>
                  (<code>list[float | int] | tuple[float | int]</code>)
              –
              <div class="doc-md-description">
                <p>A range of exit price in the format of 
[lower_bound_price, upper_bound_price].</p>
              </div>
            </li>
            <li>
              <b><code>stop_exit</code></b>
                  (<code>float | int</code>)
              –
              <div class="doc-md-description">
                <p>The stop loss value.</p>
              </div>
            </li>
            <li>
              <b><code>open_hr</code></b>
                  (<code>str</code>, default:
                      <code>&#39;0330&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The opening hour. The default is "0330".</p>
              </div>
            </li>
            <li>
              <b><code>close_hr</code></b>
                  (<code>str</code>, default:
                      <code>&#39;1930&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The closing hour. The default is "1930".</p>
              </div>
            </li>
            <li>
              <b><code>price_proxy</code></b>
                  (<code>str</code>, default:
                      <code>&#39;Open&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The column name for the price. The default is 'Open'.</p>
              </div>
            </li>
            <li>
              <b><code>time_proxy</code></b>
                  (<code>str</code>, default:
                      <code>&#39;Time&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The column name for the time. The default is 'Time'.</p>
              </div>
            </li>
            <li>
              <b><code>direction</code></b>
                  (<code>str</code>, default:
                      <code>&#39;Neutral&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The direction of the trade. The default is 'Neutral'.</p>
              </div>
            </li>
            <li>
              <b><code>dt_scale</code></b>
                  (<code>str</code>, default:
                      <code>&#39;datetime&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>datetime scale. It could be either 'time', 'date', or 'datetime'.
It choose from either the time or date columns, or 
combine the two into datetime.
The default is 'datetime'.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>range_dict</code></b>(                  <code>TYPE</code>
)              –
              <div class="doc-md-description">
                <p>A dictionary contianing the points in a day that falls within the 
entry and exit range, as well as points that crossover to the stoploss,
along with the open and close points of the day.
It has the following format:
    {'entry': [(entry_times,entry_pts), ...],
    'exit': [(exit_times,exit_pts), ...],
    'stop': [(stop_times,stop_pts), ...],
    'open': (open_datetime, open_pt),
    'close': (close_datetime, close_pt)}</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1108" name="__codelineno-0-1108"></a><span class="k">def</span> <span class="nf">find_minute_EES_range</span><span class="p">(</span><span class="n">histroy_data_intraday</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>                          <span class="n">target_entry_range</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="o">|</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="o">|</span><span class="nb">int</span><span class="p">],</span> 
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>                          <span class="n">target_exit_range</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="o">|</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="o">|</span><span class="nb">int</span><span class="p">],</span> 
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>                          <span class="n">stop_exit</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>                          <span class="n">open_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;0330&quot;</span><span class="p">,</span> <span class="n">close_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1930&quot;</span><span class="p">,</span> 
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>                          <span class="n">price_proxy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Open&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>                          <span class="n">date_proxy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>                          <span class="n">time_proxy</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>                          <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Neutral&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>                          <span class="n">dt_scale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;datetime&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">list</span><span class="o">|</span><span class="nb">tuple</span><span class="p">]:</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a><span class="sd">    Find the points within a range of EES value in a time-series of minute </span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a><span class="sd">    intrday data.</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a><span class="sd">    This function is the key for range loop in backtesting.</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a><span class="sd">    histroy_data_intraday : pd.DataFrame</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a><span class="sd">        The historical data.</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a><span class="sd">    target_entry_range : list[float|int] | tuple[float|int]</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a><span class="sd">        A range of entry price in the format of </span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a><span class="sd">        [lower_bound_price, upper_bound_price].</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a><span class="sd">    target_exit_range : list[float|int] | tuple[float|int]</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a><span class="sd">        A range of exit price in the format of </span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a><span class="sd">        [lower_bound_price, upper_bound_price].</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a><span class="sd">    stop_exit : float | int</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a><span class="sd">        The stop loss value.</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a><span class="sd">    open_hr : str, optional</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a><span class="sd">        The opening hour. The default is &quot;0330&quot;.</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a><span class="sd">    close_hr : str, optional</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a><span class="sd">        The closing hour. The default is &quot;1930&quot;.</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a><span class="sd">    price_proxy : str, optional</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a><span class="sd">        The column name for the price. The default is &#39;Open&#39;.</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a><span class="sd">    time_proxy : str, optional</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a><span class="sd">        The column name for the time. The default is &#39;Time&#39;.</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a><span class="sd">    direction : str, optional</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a><span class="sd">        The direction of the trade. The default is &#39;Neutral&#39;.</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a><span class="sd">    dt_scale : str, optional</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a><span class="sd">        datetime scale. It could be either &#39;time&#39;, &#39;date&#39;, or &#39;datetime&#39;.</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a><span class="sd">        It choose from either the time or date columns, or </span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a><span class="sd">        combine the two into datetime.</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a><span class="sd">        The default is &#39;datetime&#39;.</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a><span class="sd">    range_dict : TYPE</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a><span class="sd">        A dictionary contianing the points in a day that falls within the </span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a><span class="sd">        entry and exit range, as well as points that crossover to the stoploss,</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a><span class="sd">        along with the open and close points of the day.</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a><span class="sd">        It has the following format:</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a><span class="sd">            {&#39;entry&#39;: [(entry_times,entry_pts), ...],</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a><span class="sd">            &#39;exit&#39;: [(exit_times,exit_pts), ...],</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a><span class="sd">            &#39;stop&#39;: [(stop_times,stop_pts), ...],</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a><span class="sd">            &#39;open&#39;: (open_datetime, open_pt),</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a><span class="sd">            &#39;close&#39;: (close_datetime, close_pt)}</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>    <span class="c1"># define subsample. turn the pandas series into a numpy array</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>    <span class="n">price_array</span> <span class="o">=</span> <span class="n">histroy_data_intraday</span><span class="p">[</span><span class="n">price_proxy</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>    <span class="n">time_array</span> <span class="o">=</span> <span class="n">histroy_data_intraday</span><span class="p">[</span><span class="n">time_proxy</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>    <span class="c1"># read in date list</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>    <span class="n">date_array</span> <span class="o">=</span> <span class="n">histroy_data_intraday</span><span class="p">[</span><span class="n">date_proxy</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> 
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>    <span class="c1"># Temporary solution. Can be made using two to three time layer</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>    <span class="c1"># make datetime list</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>    <span class="n">datetime_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">t</span><span class="p">)</span> \
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>                              <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">date_array</span><span class="p">,</span><span class="n">time_array</span><span class="p">)])</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>    <span class="k">if</span> <span class="n">dt_scale</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>        <span class="n">time_proxy_array</span> <span class="o">=</span> <span class="n">time_array</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>    <span class="k">elif</span> <span class="n">dt_scale</span> <span class="o">==</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>        <span class="n">time_proxy_array</span> <span class="o">=</span> <span class="n">date_array</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>    <span class="k">elif</span> <span class="n">dt_scale</span> <span class="o">==</span> <span class="s1">&#39;datetime&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>        <span class="n">time_proxy_array</span> <span class="o">=</span> <span class="n">datetime_array</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>    <span class="c1"># Find the crossover indices</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>    <span class="n">entry_region_dict</span> <span class="o">=</span> <span class="n">find_range</span><span class="p">(</span><span class="n">price_array</span><span class="p">,</span> <span class="n">target_entry_range</span><span class="p">)</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>    <span class="n">exit_region_dict</span> <span class="o">=</span> <span class="n">find_range</span><span class="p">(</span><span class="n">price_array</span><span class="p">,</span> <span class="n">target_exit_range</span><span class="p">)</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>    <span class="c1"># Stop loss find crossover</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>    <span class="n">stop_pt_dict</span> <span class="o">=</span> <span class="n">find_crossover</span><span class="p">(</span><span class="n">price_array</span><span class="p">,</span> <span class="n">stop_exit</span><span class="p">)</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;Neitral&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>        <span class="c1"># for &#39;Neutral&#39; action, all info are empty</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>        <span class="n">entry_pts</span><span class="p">,</span> <span class="n">entry_times</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>        <span class="n">exit_pts</span><span class="p">,</span> <span class="n">exit_times</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>        <span class="n">stop_pts</span><span class="p">,</span> <span class="n">stop_times</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>    <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;Buy&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>        <span class="c1">#print(&quot;Finding Buy points.&quot;)</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>        <span class="c1"># for &#39;Buy&#39; action EES sequence is drop,rise,drop</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>        <span class="n">entry_pts</span> <span class="o">=</span> <span class="n">price_array</span><span class="p">[</span><span class="n">entry_region_dict</span><span class="p">[</span><span class="s1">&#39;range_indices&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>        <span class="n">entry_times</span> <span class="o">=</span> <span class="n">time_proxy_array</span><span class="p">[</span><span class="n">entry_region_dict</span><span class="p">[</span><span class="s1">&#39;range_indices&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>        <span class="n">exit_pts</span> <span class="o">=</span> <span class="n">price_array</span><span class="p">[</span><span class="n">exit_region_dict</span><span class="p">[</span><span class="s1">&#39;range_indices&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>        <span class="n">exit_times</span> <span class="o">=</span> <span class="n">time_proxy_array</span><span class="p">[</span><span class="n">exit_region_dict</span><span class="p">[</span><span class="s1">&#39;range_indices&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>        <span class="n">stop_pts</span> <span class="o">=</span> <span class="n">price_array</span><span class="p">[</span><span class="n">stop_pt_dict</span><span class="p">[</span><span class="s1">&#39;drop&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>        <span class="n">stop_times</span> <span class="o">=</span> <span class="n">time_proxy_array</span><span class="p">[</span><span class="n">stop_pt_dict</span><span class="p">[</span><span class="s1">&#39;drop&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>    <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;Sell&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>        <span class="c1">#print(&quot;Finding Sell points.&quot;)</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>        <span class="c1"># for &#39;Sell&#39; action EES sequence is rise,drop,rise</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>        <span class="n">entry_pts</span> <span class="o">=</span> <span class="n">price_array</span><span class="p">[</span><span class="n">entry_region_dict</span><span class="p">[</span><span class="s1">&#39;range_indices&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>        <span class="n">entry_times</span> <span class="o">=</span> <span class="n">time_proxy_array</span><span class="p">[</span><span class="n">entry_region_dict</span><span class="p">[</span><span class="s1">&#39;range_indices&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a>        <span class="n">exit_pts</span> <span class="o">=</span> <span class="n">price_array</span><span class="p">[</span><span class="n">exit_region_dict</span><span class="p">[</span><span class="s1">&#39;range_indices&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>        <span class="n">exit_times</span> <span class="o">=</span> <span class="n">time_proxy_array</span><span class="p">[</span><span class="n">exit_region_dict</span><span class="p">[</span><span class="s1">&#39;range_indices&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>        <span class="n">stop_pts</span> <span class="o">=</span> <span class="n">price_array</span><span class="p">[</span><span class="n">stop_pt_dict</span><span class="p">[</span><span class="s1">&#39;rise&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>        <span class="n">stop_times</span> <span class="o">=</span> <span class="n">time_proxy_array</span><span class="p">[</span><span class="n">stop_pt_dict</span><span class="p">[</span><span class="s1">&#39;rise&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>    <span class="c1"># Define the closing time and closing price. Here we choose 19:25 for final trade</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a>    <span class="n">open_hr_str</span> <span class="o">=</span> <span class="n">open_hr</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H%M&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>    <span class="n">close_hr_str</span> <span class="o">=</span> <span class="n">close_hr</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H%M&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a>    <span class="c1">## Find the closest price and datettime instead of having it at exactly the open time</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>    <span class="n">open_date_new</span><span class="p">,</span> <span class="n">open_pt</span> <span class="o">=</span> <span class="n">find_closest_price</span><span class="p">(</span><span class="n">histroy_data_intraday</span><span class="p">,</span> 
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>                                                  <span class="n">target_hr</span> <span class="o">=</span> <span class="n">open_hr_str</span><span class="p">,</span> 
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>                                                  <span class="n">direction</span> <span class="o">=</span> <span class="s1">&#39;forward&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a>    <span class="n">open_date</span> <span class="o">=</span> <span class="n">date_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">time_array</span><span class="o">==</span><span class="n">open_date_new</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>    <span class="n">open_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">open_date</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> 
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>                                               <span class="n">open_date_new</span><span class="p">)</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a>    <span class="c1">## Find the closest price and datettime instead of having it at exactly the close time</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>    <span class="n">close_date_new</span><span class="p">,</span> <span class="n">close_pt</span> <span class="o">=</span> <span class="n">find_closest_price</span><span class="p">(</span><span class="n">histroy_data_intraday</span><span class="p">,</span> 
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>                                                  <span class="n">target_hr</span><span class="o">=</span><span class="n">close_hr_str</span><span class="p">,</span> 
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>                                                  <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>    <span class="n">close_date</span> <span class="o">=</span> <span class="n">date_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">time_array</span><span class="o">==</span><span class="n">close_date_new</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>    <span class="n">close_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">close_date</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> 
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>                                               <span class="n">close_date_new</span><span class="p">)</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>    <span class="n">range_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;entry&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">entry_times</span><span class="p">,</span><span class="n">entry_pts</span><span class="p">)),</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>                  <span class="s1">&#39;exit&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">exit_times</span><span class="p">,</span><span class="n">exit_pts</span><span class="p">)),</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>                  <span class="s1">&#39;stop&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">stop_times</span><span class="p">,</span><span class="n">stop_pts</span><span class="p">)),</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>                  <span class="s1">&#39;open&#39;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">open_datetime</span><span class="p">,</span> <span class="n">open_pt</span><span class="p">)),</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>                  <span class="s1">&#39;close&#39;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">close_datetime</span><span class="p">,</span> <span class="n">close_pt</span><span class="p">))}</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>    <span class="c1">#print(range_dict)</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>    <span class="k">return</span> <span class="n">range_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.find_price_by_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_price_by_time</span><span class="p">(</span><span class="n">history_data_daily</span><span class="p">,</span> <span class="n">history_data_minute</span><span class="p">,</span> <span class="n">open_hr</span><span class="o">=</span><span class="s1">&#39;0330&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>A function to search for the opening price of the day.
If at the opening hour, there are no bid or price information, the script 
loop through the next 30 minutes to find the opening price.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>history_data_daily</code></b>
                  (<code>dataframe</code>)
              –
              <div class="doc-md-description">
                <p>The historical daily data.</p>
              </div>
            </li>
            <li>
              <b><code>history_data_minute</code></b>
                  (<code>dataframe</code>)
              –
              <div class="doc-md-description">
                <p>The historical minute data.</p>
              </div>
            </li>
            <li>
              <b><code>open_hr</code></b>
                  (<code>str</code>, default:
                      <code>&#39;0330&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Defining the opening hour. The default is '0330'.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>open_price_data</code></b>(                  <code>dataframe</code>
)              –
              <div class="doc-md-description">
                <p>A table consist of three columns: 'Date', 'Time', and 'Open Price'.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="k">def</span> <span class="nf">find_price_by_time</span><span class="p">(</span><span class="n">history_data_daily</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>                       <span class="n">history_data_minute</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>                       <span class="n">open_hr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;0330&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span> <span class="c1">#tested</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a><span class="sd">    A function to search for the opening price of the day.</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a><span class="sd">    If at the opening hour, there are no bid or price information, the script </span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a><span class="sd">    loop through the next 30 minutes to find the opening price.</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a><span class="sd">    history_data_daily : dataframe</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a><span class="sd">        The historical daily data.</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a><span class="sd">    history_data_minute : dataframe</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a><span class="sd">        The historical minute data.</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a><span class="sd">    open_hr : str, optional</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a><span class="sd">        Defining the opening hour. The default is &#39;0330&#39;.</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a><span class="sd">    -------</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">    open_price_data: dataframe</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="sd">        A table consist of three columns: &#39;Date&#39;, &#39;Time&#39;, and &#39;Open Price&#39;.</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>    <span class="n">date_list</span> <span class="o">=</span> <span class="n">history_data_daily</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>    <span class="n">open_price_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>    <span class="c1">#loop through daily data to get the date</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">date_list</span><span class="p">:</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>        <span class="n">day_data</span> <span class="o">=</span> <span class="n">history_data_minute</span><span class="p">[</span><span class="n">history_data_minute</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">date</span><span class="p">]</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>        <span class="c1"># Find the closest hour and price</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>        <span class="n">open_hr_dt</span><span class="p">,</span> <span class="n">open_price</span> <span class="o">=</span> <span class="n">find_closest_price</span><span class="p">(</span><span class="n">day_data</span><span class="p">,</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>                                                            <span class="n">target_hr</span><span class="o">=</span><span class="s1">&#39;0330&#39;</span><span class="p">)</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>        <span class="c1">#print(&#39;open_price&#39;,open_price)</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">open_price</span><span class="p">)</span> <span class="o">==</span>  <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>            <span class="k">pass</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">open_price</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">open_price</span><span class="p">)</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>        <span class="c1">#storage</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>        <span class="c1">#open_price_data.append((date.to_pydatetime(), open_hr_dt , </span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>        <span class="c1">#                        open_price.item()))</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>        <span class="n">open_price_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">date</span><span class="o">.</span><span class="n">to_pydatetime</span><span class="p">(),</span> <span class="n">open_hr_dt</span> <span class="p">,</span> 
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>                                <span class="n">open_price</span><span class="p">))</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>    <span class="n">open_price_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">open_price_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Open Price&#39;</span><span class="p">])</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>    <span class="k">return</span> <span class="n">open_price_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.find_range" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_range</span><span class="p">(</span><span class="n">input_array</span><span class="p">,</span> <span class="n">target_range</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>A function that find the points' indicies given a target range. 
It finds the points within that range .</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>input_array</code></b>
                  (<code><span title="numpy.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>A 1D numpy array with only numbers.</p>
              </div>
            </li>
            <li>
              <b><code>target_range</code></b>
                  (<code>tuple[float | int] | list[float | int] | <span title="numpy.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>A tuple, list, or array of target range. e.g. [0,1], (0,1),...
The first element is the lower bound and the second the upper bound.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>Exception</code>
              –
              <div class="doc-md-description">
                <p>When the target_range input does not contain exactly two values.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>dict</code>
              –
              <div class="doc-md-description">
                <p>range_dict contains the indices of the element of the input_array that
is within the target_range, outside the target_range, and the boundaries
of the range.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-835" name="__codelineno-0-835"></a><span class="k">def</span> <span class="nf">find_range</span><span class="p">(</span><span class="n">input_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>               <span class="n">target_range</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="o">|</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="o">|</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>\
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>               <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a><span class="sd">    A function that find the points&#39; indicies given a target range. </span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a><span class="sd">    It finds the points within that range .</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a><span class="sd">    input_array : np.ndarray</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a><span class="sd">        A 1D numpy array with only numbers.</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a><span class="sd">    target_range : tuple[float|int] | list[float|int] | np.ndarray</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a><span class="sd">        A tuple, list, or array of target range. e.g. [0,1], (0,1),...</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a><span class="sd">        The first element is the lower bound and the second the upper bound.</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a><span class="sd">    ------</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a><span class="sd">    Exception</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a><span class="sd">        When the target_range input does not contain exactly two values.</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a><span class="sd">    -------</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a><span class="sd">    dict</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a><span class="sd">        range_dict contains the indices of the element of the input_array that</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a><span class="sd">        is within the target_range, outside the target_range, and the boundaries</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a><span class="sd">        of the range.</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_range</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Target Range input must contains exactly two values.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">target_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">target_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Second element is not larger than the first.</span><span class="se">\</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a><span class="s2">                        Target Range input must in the form of [lower_bound, </span><span class="se">\</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a><span class="s2">                                                                upper_bound].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>    <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">target_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_array</span><span class="p">))</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>    <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">target_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_array</span><span class="p">))</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>    <span class="n">delta_lower</span> <span class="o">=</span> <span class="n">input_array</span> <span class="o">-</span> <span class="n">lower_bound</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>    <span class="n">delta_upper</span> <span class="o">=</span> <span class="n">upper_bound</span> <span class="o">-</span> <span class="n">input_array</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>    <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">delta_upper</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">delta_lower</span><span class="p">)</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>    <span class="c1">#print(np.sign(delta_lower), np.sign(delta_upper), delta)</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>    <span class="c1">#print(delta_lower, delta_upper, delta)</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>    <span class="n">range_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>    <span class="n">bound_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta</span> <span class="o">==</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>    <span class="n">outbound_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;range_indices&#39;</span><span class="p">:</span> <span class="n">range_indices</span><span class="p">,</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>            <span class="s1">&#39;outbound_indices&#39;</span><span class="p">:</span> <span class="n">outbound_indices</span><span class="p">,</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>            <span class="s1">&#39;bound_indices&#39;</span><span class="p">:</span> <span class="n">bound_indices</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.get_apc_from_server" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_apc_from_server</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">categories</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Use the ArgusPossibilityCurve.py script to extract the APCin the wide format from the server.
Note that the latest version is 1.1.0 (21 March 2024).</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>username</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The username of your argus account.</p>
              </div>
            </li>
            <li>
              <b><code>password</code></b>
                  (<code>srt</code>)
              –
              <div class="doc-md-description">
                <p>The password of your argus account.</p>
              </div>
            </li>
            <li>
              <b><code>start_date</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The desired start date of the apc, it should be in tcategorieshe format of this:
    "2020-01-20"</p>
              </div>
            </li>
            <li>
              <b><code>end_date</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The end date of the apc. Similar to the above.</p>
              </div>
            </li>
            <li>
              <b><code>categories</code></b>
                  (<code>str or list</code>)
              –
              <div class="doc-md-description">
                <p>The asset name. It could be either 
1) A string such as "Argus Nymex WTI month 1, Daily", or 
2) A list that contain the list of asset names, like this:
    ['Argus Nymex WTI month 1, Daily', 
     'Argus Nymex Heating oil month 1, Daily', ...]</p>
              </div>
            </li>
            <li>
              <b><code>keywords</code></b>
                  (<code><span title="typing.Union">Union</span>[str, list]</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Keywords in the categories to look for. Same dimension as the categories input.</p>
              </div>
            </li>
            <li>
              <b><code>symbol</code></b>
                  (<code><span title="typing.Union">Union</span>[str, list]</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Symbols to write in the new column. Same dimension as the categories input.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>apc_data</code></b>(                  <code>list</code>
)              –
              <div class="doc-md-description">
                <p>A list that contain the spread of APC with the following collumns:
    Index(['Forecast Period', 'CATEGORY', '0.0025', '0.005', '0.0075', 
           '0.01', '0.0125', '0.015', '0.0175', '0.02',
           ...
           '0.9775', '0.98', '0.9825', '0.985', '0.9875', '0.99', 
           '0.9925', '0.995', '0.9975', 'symbol'], dtype='object', 
          length=402)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="k">def</span> <span class="nf">get_apc_from_server</span><span class="p">(</span><span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>                        <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>                        <span class="n">categories</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>                        <span class="n">keywords</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>                        <span class="n">symbol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    Use the ArgusPossibilityCurve.py script to extract the APCin the wide format from the server.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    Note that the latest version is 1.1.0 (21 March 2024).</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    username : str</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        The username of your argus account.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    password : srt</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        The password of your argus account.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    start_date : str</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        The desired start date of the apc, it should be in tcategorieshe format of this:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">            &quot;2020-01-20&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    end_date : str</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        The end date of the apc. Similar to the above.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    categories : str or list</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        The asset name. It could be either </span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        1) A string such as &quot;Argus Nymex WTI month 1, Daily&quot;, or </span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        2) A list that contain the list of asset names, like this:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">            [&#39;Argus Nymex WTI month 1, Daily&#39;, </span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">             &#39;Argus Nymex Heating oil month 1, Daily&#39;, ...]</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    keywords: str or list</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        Keywords in the categories to look for. Same dimension as the categories input.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    symbol: str or list</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        Symbols to write in the new column. Same dimension as the categories input.</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    -------</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    apc_data : list</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        A list that contain the spread of APC with the following collumns:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">            Index([&#39;Forecast Period&#39;, &#39;CATEGORY&#39;, &#39;0.0025&#39;, &#39;0.005&#39;, &#39;0.0075&#39;, </span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">                   &#39;0.01&#39;, &#39;0.0125&#39;, &#39;0.015&#39;, &#39;0.0175&#39;, &#39;0.02&#39;,</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">                   ...</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">                   &#39;0.9775&#39;, &#39;0.98&#39;, &#39;0.9825&#39;, &#39;0.985&#39;, &#39;0.9875&#39;, &#39;0.99&#39;, </span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">                   &#39;0.9925&#39;, &#39;0.995&#39;, &#39;0.9975&#39;, &#39;symbol&#39;], dtype=&#39;object&#39;, </span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">                  length=402)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;symbol&#39;</span><span class="p">,</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="c1"># Check if categories and keywords varaible matches in dimension</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="c1"># Login and Authentication</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">apc</span> <span class="o">=</span> <span class="n">ArgusPossibilityCurves</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="n">apc</span><span class="o">.</span><span class="n">authenticate</span><span class="p">()</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="n">apc</span><span class="o">.</span><span class="n">getMetadataCSV</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="s2">&quot;argus_latest_meta.csv&quot;</span><span class="p">)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="c1"># Make the start and end date in the datetime.date format</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">start_date</span><span class="p">[:</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_date</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_date</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">]))</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">end_date</span><span class="p">[:</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">end_date</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">end_date</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">]))</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span> <span class="c1"># if the asset name input is a string, pull only one </span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="c1"># This retrieve the apc from the server</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="n">apc_data</span> <span class="o">=</span> <span class="n">apc</span><span class="o">.</span><span class="n">getPossibilityCurves</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> 
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>                                            <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> 
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>                                            <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="n">categories</span><span class="p">])</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="c1"># Delete irrelavant columns</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="c1">#apc_data = apc_data.drop(columns=[&#39;PUBLICATION_DATE&#39;, </span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="c1">#                                  &#39;CONTINUOUS_FORWARD&#39;, </span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="c1">#                                  &#39;PRICE_UNIT&#39;, &#39;TIMESTAMP&#39;])</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="c1">#apc_data.columns = [&#39;Forecast_Period&#39;] + [i for i in apc_data.columns[1:]] # Add the term &quot;APC&quot; in each column</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="c1"># If no specific symbol input, use the name of the categories</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="k">if</span> <span class="n">symbol</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="n">symbol</span> <span class="o">=</span> <span class="n">categories</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="k">pass</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="c1"># make a new column with nothing in it. Then write the short symbol</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="n">apc_data</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">apc_data</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">apc_data</span><span class="p">[</span><span class="s1">&#39;CATEGORY&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">keywords</span> <span class="ow">in</span> <span class="n">x</span><span class="p">),</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">apc_data</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">])</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span> <span class="c1"># if the asset name input is a list, pull a list of APC</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">apc_data</span> <span class="o">=</span> <span class="n">apc</span><span class="o">.</span><span class="n">getPossibilityCurves</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> 
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>                                            <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> 
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>                                            <span class="n">categories</span><span class="o">=</span><span class="n">categories</span><span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="c1">#apc_data = apc_data.drop(columns=[&#39;PUBLICATION_DATE&#39;, </span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="c1">#                                  &#39;CONTINUOUS_FORWARD&#39;, </span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="c1">#                                  &#39;PRICE_UNIT&#39;, &#39;TIMESTAMP&#39;])</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="c1">#apc_data.columns = [&#39;Forecast_Period&#39;] + [i for i in apc_data.columns[1:]]</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="n">apc_data</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> 
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="c1"># add new column with symbols corresponding to the keywords.</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span><span class="n">symbol</span><span class="p">):</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="n">apc_data</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">apc_data</span><span class="p">[</span><span class="s1">&#39;CATEGORY&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">),</span> <span class="n">c</span><span class="p">,</span> <span class="n">apc_data</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">])</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="c1"># Drop the Category column</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="c1">#apc_data = apc_data.drop(columns=[&#39;CATEGORY&#39;])</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="k">return</span> <span class="n">apc_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.group_trade" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">group_trade</span><span class="p">(</span><span class="n">position_pool</span><span class="p">,</span> <span class="n">select_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>A function to group positions by trade id along with some given conditions.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>position_pool</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>The position_pool list inside a portfolio object.</p>
              </div>
            </li>
            <li>
              <b><code>select_func</code></b>
                  (<code>Callable function</code>, default:
                      <code>lambda x: True</code>
)
              –
              <div class="doc-md-description">
                <p>Additional functions for unique condition for grouping trade.
The default is a lambda function that return True 
(It will return true no matter what).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>list</code>
              –
              <div class="doc-md-description">
                <p>A new list with each traded grouped as a list element in a bucket</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1423" name="__codelineno-0-1423"></a><span class="k">def</span> <span class="nf">group_trade</span><span class="p">(</span><span class="n">position_pool</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> 
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>                <span class="n">select_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span> <span class="c1">#</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a><span class="sd">    A function to group positions by trade id along with some given conditions.</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a><span class="sd">    position_pool : list</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a><span class="sd">        The position_pool list inside a portfolio object.</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a><span class="sd">    select_func : Callable function, optional</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a><span class="sd">        Additional functions for unique condition for grouping trade.</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a><span class="sd">        The default is a lambda function that return True </span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a><span class="sd">        (It will return true no matter what).</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a><span class="sd">    list</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a><span class="sd">        A new list with each traded grouped as a list element in a bucket</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>    <span class="c1"># A function that matches the trade_id and group them in a list</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>    <span class="c1"># First sort the pool by trade_id.</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>    <span class="n">pos_pool</span> <span class="o">=</span> <span class="n">position_pool</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>    <span class="n">pos_pool</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">pos_id</span><span class="p">)</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>    <span class="n">bucket</span><span class="p">,</span> <span class="n">temp</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>    <span class="n">trade_id_now</span> <span class="o">=</span> <span class="n">pos_pool</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pos_id</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>    <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos_pool</span><span class="p">):</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>        <span class="c1"># loop through each position, if the pos_id == trade_id_now, save in </span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>        <span class="c1"># a temp list</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>        <span class="k">if</span>  <span class="n">pos_pool</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pos_id</span> <span class="o">==</span> <span class="n">trade_id_now</span><span class="p">:</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>            <span class="k">if</span> <span class="n">select_func</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>                <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos_pool</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>        <span class="k">elif</span> <span class="n">pos_pool</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pos_id</span> <span class="o">!=</span> <span class="n">trade_id_now</span><span class="p">:</span> 
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a>            <span class="c1"># Otherwise, put the temp list into the overall bucket, restart </span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>            <span class="c1"># the counter and make a new temp list to repeat the process</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>            <span class="c1">#print(&#39;switch&#39;)</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>            <span class="c1">#print(i, pos_pool[i].pos_id)</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>            <span class="n">bucket</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>            <span class="n">trade_id_now</span> <span class="o">=</span> <span class="n">pos_pool</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pos_id</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>            <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>            <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos_pool</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a>    <span class="k">return</span> <span class="n">bucket</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.merge_portara_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge_portara_data</span><span class="p">(</span><span class="n">table1</span><span class="p">,</span> <span class="n">table2</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Merging the Portara Daily and Minute table. The merger is operated on the 
two columns: 'Date only' and 'Price Code'.</p>
<p>LEGACY function from Abbe. Not in use at the moment.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>table1</code></b>
                  (<code>dataframe</code>)
              –
              <div class="doc-md-description">
                <p>The pandas dataframe Daily pricing data.</p>
              </div>
            </li>
            <li>
              <b><code>table2</code></b>
                  (<code>dataframe</code>)
              –
              <div class="doc-md-description">
                <p>The Portara Minute pricing data.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>new_table</code></b>(                  <code>pandas dataframe</code>
)              –
              <div class="doc-md-description">
                <p>The new merged table.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="k">def</span> <span class="nf">merge_portara_data</span><span class="p">(</span><span class="n">table1</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>                       <span class="n">table2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">    Merging the Portara Daily and Minute table. The merger is operated on the </span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">    two columns: &#39;Date only&#39; and &#39;Price Code&#39;.</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">    LEGACY function from Abbe. Not in use at the moment.</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">    table1 : dataframe</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">        The pandas dataframe Daily pricing data.</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">    table2 : dataframe</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">        The Portara Minute pricing data.</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">    -------</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">    new_table : pandas dataframe</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">        The new merged table.</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span class="c1"># A function that merges </span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="c1"># construct a master table of price across all minutes</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>    <span class="c1"># merge the minute and daily data based on Date only and Price code</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>    <span class="n">new_table</span> <span class="o">=</span> <span class="n">table1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">table2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date only&#39;</span><span class="p">,</span> <span class="s1">&#39;Price Code&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="c1"># add c1 to the price code</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>    <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>    <span class="n">table2</span><span class="p">[</span><span class="s1">&#39;Price Code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table2</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;c&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="n">new_table</span> <span class="o">=</span> <span class="n">table1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">table2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date only&#39;</span><span class="p">,</span> <span class="s1">&#39;Price Code&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="k">del</span> <span class="n">table1</span><span class="p">,</span> <span class="n">table2</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>    <span class="c1"># drop contract columns</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="n">new_table</span> <span class="o">=</span> <span class="n">new_table</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Contract&#39;</span><span class="p">)</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>    <span class="k">return</span> <span class="n">new_table</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.merge_raw_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge_raw_data</span><span class="p">(</span><span class="n">filename_list</span><span class="p">,</span> <span class="n">save_filename</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s1">&#39;PERIOD&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>A function that merges a list of CSV files into one CSV file.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>filename_list</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>A list of filename if CSV to be Concatenated.</p>
              </div>
            </li>
            <li>
              <b><code>save_filename</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The filename for saving.</p>
              </div>
            </li>
            <li>
              <b><code>sort_by</code></b>
                  (<code>str</code>, default:
                      <code>&#39;PERIOD&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The column name used in the sorting. The default is "PERIOD".</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>merged_data</code></b>(                  <code>dataframe</code>
)              –
              <div class="doc-md-description">
                <p>The merged data.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1301" name="__codelineno-0-1301"></a><span class="k">def</span> <span class="nf">merge_raw_data</span><span class="p">(</span><span class="n">filename_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>                   <span class="n">save_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>                   <span class="n">sort_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;PERIOD&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a><span class="sd">    A function that merges a list of CSV files into one CSV file.</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a><span class="sd">    filename_list : list</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a><span class="sd">        A list of filename if CSV to be Concatenated.</span>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a><span class="sd">    save_filename : str</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a><span class="sd">        The filename for saving.</span>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a><span class="sd">    sort_by : str, optional</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a><span class="sd">        The column name used in the sorting. The default is &quot;PERIOD&quot;.</span>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a><span class="sd">    merged_data : dataframe</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a><span class="sd">         The merged data.</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>    <span class="n">merged_data</span> <span class="o">=</span> <span class="n">concat_CSVtable</span><span class="p">(</span><span class="n">filename_list</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span> <span class="n">sort_by</span><span class="p">)</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>    <span class="n">merged_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">save_filename</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>    <span class="k">return</span> <span class="n">merged_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.open_portfolio" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">open_portfolio</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>A handy function to open a portfolio. Nothing special but easy to remember.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>filename</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The filename of the Portfolio object in pickle format  .</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>portfo</code></b>(                  <code>Portfolio</code>
)              –
              <div class="doc-md-description">
                
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1251" name="__codelineno-0-1251"></a><span class="k">def</span> <span class="nf">open_portfolio</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a><span class="sd">    A handy function to open a portfolio. Nothing special but easy to remember.</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a><span class="sd">    filename : str</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a><span class="sd">        The filename of the Portfolio object in pickle format  .</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a><span class="sd">    portfo : Portfolio</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>    <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>    <span class="n">portfo</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>    <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>    <span class="k">return</span> <span class="n">portfo</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.portara_data_handling" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">portara_data_handling</span><span class="p">(</span><span class="n">portara_dat</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>A function that handle Portara's data.</p>
<p>LEGACY function from Abbe. Not in Use at the moment.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>portara_dat</code></b>
                  (<code>pandas dataframe </code>)
              –
              <div class="doc-md-description">
                <p>Input Portara data.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>portara_dat</code></b>(                  <code>pandas dataframe</code>
)              –
              <div class="doc-md-description">
                <p>Output post-processed Portara data.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="k">def</span> <span class="nf">portara_data_handling</span><span class="p">(</span><span class="n">portara_dat</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">    A function that handle Portara&#39;s data.</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">    LEGACY function from Abbe. Not in Use at the moment.</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">    portara_dat : pandas dataframe </span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">        Input Portara data.</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">    -------</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">    portara_dat : pandas dataframe</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="sd">        Output post-processed Portara data.</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="c1"># now tidy up the data </span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="n">minutes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span> 
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">160</span><span class="p">),</span> 
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">260</span><span class="p">),</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">331</span><span class="p">)))</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="n">minutes_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span>  <span class="c1"># half past to 1 </span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">160</span><span class="p">),</span>  <span class="c1"># 1 to 2 </span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">231</span><span class="p">)))</span> <span class="c1"># 2 to 3 </span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">minutes</span><span class="p">):</span> <span class="c1"># if there are no trades Portara doesn&#39;t create a bar so we have to go backwards to the last bar where a trade</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>    <span class="c1"># happened to get the price iff there is no bar for 330 - otherwise the price is &#39;nan&#39;</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="n">price_330</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Close 330&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()),</span> <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Close &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Close 330&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Close 330&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price_330</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">minutes_2</span><span class="p">):</span> <span class="c1"># if there are no trades Portara doesn&#39;t create a bar so we have to go backwards to the last bar where a trade</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>    <span class="c1"># happened to get the price iff there is no bar for 330 (getting 230 prices for when daylight savings moving UK to BST (1 hour forward) from UTC/GMT</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="n">price_230</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Close 230&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()),</span> <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Close &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Close 230&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Close 230&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price_230</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>    <span class="n">portara_dat</span> <span class="o">=</span> <span class="n">portara_dat</span><span class="p">[[</span><span class="s1">&#39;Date only&#39;</span><span class="p">,</span> <span class="s1">&#39;Close 330&#39;</span><span class="p">,</span> <span class="s1">&#39;Settle&#39;</span><span class="p">,</span> <span class="s1">&#39;Price Code&#39;</span><span class="p">,</span> <span class="s1">&#39;Contract Symbol&#39;</span><span class="p">,</span> <span class="s1">&#39;Close 230&#39;</span><span class="p">]]</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>    <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;daylight saving forward date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Date only&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;-03-31&#39;</span><span class="p">))</span> <span class="c1"># date for daylight savings start </span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>    <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;daylight saving back date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Date only&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-10-27&#39;</span><span class="p">))</span> <span class="c1"># date for daylight savings end </span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>    <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Close 330&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Date only&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;daylight saving forward date&#39;</span><span class="p">],</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                        <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Date only&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;daylight saving back date&#39;</span><span class="p">]),</span>  
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>            <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Close 230&#39;</span><span class="p">],</span> 
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>            <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Close 330&#39;</span><span class="p">]</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>        <span class="p">)</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>    <span class="n">portara_dat</span> <span class="o">=</span> <span class="n">portara_dat</span><span class="p">[[</span><span class="s1">&#39;Date only&#39;</span><span class="p">,</span> <span class="s1">&#39;Close 330&#39;</span><span class="p">,</span> <span class="s1">&#39;Settle&#39;</span><span class="p">,</span> <span class="s1">&#39;Price Code&#39;</span><span class="p">,</span> <span class="s1">&#39;Contract Symbol&#39;</span><span class="p">]]</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>    <span class="n">portara_dat</span> <span class="o">=</span> <span class="n">portara_dat</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Date only&#39;</span><span class="p">)</span> <span class="c1"># dates in ascending order </span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>    <span class="k">return</span> <span class="n">portara_dat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.read_apc_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_apc_data</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Nothing Special. Just a shorthand function to read the apc</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>filename</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>APC CSVfilename.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>data</code></b>(                  <code>Data Frame</code>
)              –
              <div class="doc-md-description">
                <p>APC in dataframe.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="k">def</span> <span class="nf">read_apc_data</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">    Nothing Special. Just a shorthand function to read the apc</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">    filename : str</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">        APC CSVfilename.</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">    -------</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    data : Data Frame</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        APC in dataframe.</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="c1"># This function should be used in conjuction with get_apc_from_server(). </span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>    <span class="c1"># The data should be pulled from the server using that function</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="k">return</span> <span class="n">data</span>    
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.read_portara_daily_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_portara_daily_data</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">column_select</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Settle&#39;</span><span class="p">,</span> <span class="s1">&#39;Price Code&#39;</span><span class="p">,</span> <span class="s1">&#39;Contract Symbol&#39;</span><span class="p">,</span> <span class="s1">&#39;Date only&#39;</span><span class="p">])</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>A generic function that read the Portara Data in a suitable form. 
The function itself only read a single csv file at a time.</p>
<p>LEGACY function from Abbe. 
Use the function 'read_reformat_Portara_daily_data' instead.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>filename</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The filename in the correct address.</p>
              </div>
            </li>
            <li>
              <b><code>symbol</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>A short symbol for the asset.</p>
              </div>
            </li>
            <li>
              <b><code>start_date</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The start date of the query. e.g, "2024-01-13".</p>
              </div>
            </li>
            <li>
              <b><code>end_date</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The end date of the query. e.g, "2024-01-18".</p>
              </div>
            </li>
            <li>
              <b><code>column_select</code></b>
                  (<code>list[str]</code>, default:
                      <code>[&#39;Settle&#39;, &#39;Price Code&#39;, &#39;Contract Symbol&#39;, &#39;Date only&#39;]</code>
)
              –
              <div class="doc-md-description">
                <p>A list of columns name to select for in the master file. The default is 
['Settle', 'Price Code', 'Contract Symbol', 'Date only']</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>portara_dat</code></b>(                  <code>2D pandas dataframe</code>
)              –
              <div class="doc-md-description">
                <p>The Portara daily data</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="k">def</span> <span class="nf">read_portara_daily_data</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                            <span class="n">start_date</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                            <span class="n">column_select</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> 
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                                        <span class="p">[</span><span class="s1">&#39;Settle&#39;</span><span class="p">,</span> <span class="s1">&#39;Price Code&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                                         <span class="s1">&#39;Contract Symbol&#39;</span><span class="p">,</span> <span class="s1">&#39;Date only&#39;</span><span class="p">])</span> <span class="o">-&gt;</span> \
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">    A generic function that read the Portara Data in a suitable form. </span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    The function itself only read a single csv file at a time.</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">    LEGACY function from Abbe. </span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">    Use the function &#39;read_reformat_Portara_daily_data&#39; instead.</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">    filename : str</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">        The filename in the correct address.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">    symbol : str</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        A short symbol for the asset.</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">    start_date: str</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">        The start date of the query. e.g, &quot;2024-01-13&quot;.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">    end_date: str</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">        The end date of the query. e.g, &quot;2024-01-18&quot;.</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    column_select: 1D list</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        A list of columns name to select for in the master file. The default is </span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">        [&#39;Settle&#39;, &#39;Price Code&#39;, &#39;Contract Symbol&#39;, &#39;Date only&#39;]</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">    -------</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">    portara_dat: 2D pandas dataframe</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        The Portara daily data</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="c1"># Read downloaded data using panda</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="n">portara_dat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="c1"># A list of symbol</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">symbol</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="c1"># Transform the date format from 20160104 to 2016-01-04 00:00:00 (panda timestamp)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">6</span><span class="p">:])</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Date only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="c1">#2016-01-04 00:00:00 format</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="c1"># Datetime beyond 2020-12-14 is accepted beyond 2020-12-14</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="c1"># Select datetime between start_date and end_date</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="n">bools</span> <span class="o">=</span> <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span> 
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>                                      <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">end_date</span><span class="p">))</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="c1"># Select for the data that fits the bool condition (date after 2020-12-14)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="n">portara_dat</span> <span class="o">=</span> <span class="n">portara_dat</span><span class="p">[</span><span class="n">bools</span><span class="p">]</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="c1"># add c1 to the back of CL</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Price Code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;c&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="n">contract_year</span> <span class="o">=</span> <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Contract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># Get contract year 2021-&gt;21</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="n">contract_month</span> <span class="o">=</span> <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Contract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># Get contract month</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>    <span class="c1"># make a new column with CL21F from CLA2021F</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;Contract Symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">portara_dat</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">contract_year</span> <span class="o">+</span> <span class="n">contract_month</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="c1"># Select for only the following 4 columns because the others are not relevant to us</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="n">portara_dat</span> <span class="o">=</span> <span class="n">portara_dat</span><span class="p">[</span><span class="n">column_select</span><span class="p">]</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="k">return</span> <span class="n">portara_dat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.read_portara_minute_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_portara_minute_data</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">start_filter_hour</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">end_filter_hour</span><span class="o">=</span><span class="mi">331</span><span class="p">,</span> <span class="n">column_select</span><span class="o">=</span><span class="p">[])</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>A modified version of the generic Portara reading function specifically for 
the 1 minute data.</p>
<p>LEGACY function from Abbe. 
Use the function 'read_reformat_Portara_minute_data' instead.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>filename</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The filename in the correct address.</p>
              </div>
            </li>
            <li>
              <b><code>symbol</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>A short symbol for the asset.</p>
              </div>
            </li>
            <li>
              <b><code>start_date</code></b>
              –
              <div class="doc-md-description">
                <p>The start date of the query. e.g, "2024-01-13".</p>
              </div>
            </li>
            <li>
              <b><code>end_date</code></b>
              –
              <div class="doc-md-description">
                <p>The end date of the query. e.g, "2024-01-18".</p>
              </div>
            </li>
            <li>
              <b><code>start_filter_hour</code></b>
                  (<code>int</code>, default:
                      <code>30</code>
)
              –
              <div class="doc-md-description">
                <p>The start time for filtering by hours. The default is 30 because of the london trading hours</p>
              </div>
            </li>
            <li>
              <b><code>end_filter_hour</code></b>
                  (<code>int</code>, default:
                      <code>331</code>
)
              –
              <div class="doc-md-description">
                <p>The end time for filtering by hours. The default is 331.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>portara_dat_2</code></b>(                  <code>2D panda dataframe</code>
)              –
              <div class="doc-md-description">
                <p>The Portara minute data.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="k">def</span> <span class="nf">read_portara_minute_data</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>                             <span class="n">start_filter_hour</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">end_filter_hour</span><span class="o">=</span><span class="mi">331</span><span class="p">,</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                             <span class="n">column_select</span><span class="o">=</span><span class="p">[]):</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">    A modified version of the generic Portara reading function specifically for </span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    the 1 minute data.</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">    LEGACY function from Abbe. </span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    Use the function &#39;read_reformat_Portara_minute_data&#39; instead.</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    filename : str</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        The filename in the correct address.</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">    symbol : str</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">        A short symbol for the asset.</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">    start_date: str</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        The start date of the query. e.g, &quot;2024-01-13&quot;.</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">    end_date: str</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">        The end date of the query. e.g, &quot;2024-01-18&quot;.</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">    start_filter_hour : int, optional</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">        The start time for filtering by hours. The default is 30 because of the london trading hours</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">    end_filter_hour : int, optional</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">        The end time for filtering by hours. The default is 331.</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">    -------</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">    portara_dat_2 : 2D panda dataframe</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">        The Portara minute data.</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="c1"># Maybe first select for date then select for time?</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="c1"># Reading only these column</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="n">portara_dat_2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Low&#39;</span><span class="p">,</span> <span class="s1">&#39;High&#39;</span><span class="p">,</span> <span class="s1">&#39;Open&#39;</span><span class="p">,</span> <span class="s1">&#39;Close&#39;</span><span class="p">,</span> <span class="s1">&#39;Trade Volume&#39;</span><span class="p">,</span> <span class="s1">&#39;Contract&#39;</span><span class="p">])</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="c1"># Add a column of symbol</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>    <span class="n">portara_dat_2</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">symbol</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="c1">#print(portara_dat_2,&#39;9&#39;)</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="c1"># Transform the date format from 20160104 to 2016-01-04 00:00:00 (panda timestamp)</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="n">portara_dat_2</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">portara_dat_2</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">6</span><span class="p">:])</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="n">portara_dat_2</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">portara_dat_2</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>    <span class="n">portara_dat_2</span><span class="p">[</span><span class="s1">&#39;Date only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">portara_dat_2</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>    <span class="c1"># only select time within the range of starting price and ending price</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>    <span class="n">bools</span> <span class="o">=</span> <span class="n">portara_dat_2</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start_filter_hour</span><span class="p">,</span> <span class="n">end_filter_hour</span><span class="p">))</span> <span class="c1"># for the moment need only price at 330 so filtering for prices at 330 and few hours before </span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="n">portara_dat_2</span> <span class="o">=</span> <span class="n">portara_dat_2</span><span class="p">[</span><span class="n">bools</span><span class="p">]</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="c1"># Select for only these five columns</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>    <span class="n">portara_dat_2</span> <span class="o">=</span> <span class="n">portara_dat_2</span><span class="p">[[</span><span class="s1">&#39;Date only&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Close&#39;</span><span class="p">,</span> <span class="s1">&#39;Contract&#39;</span><span class="p">,</span> <span class="s1">&#39;symbol&#39;</span><span class="p">]]</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="c1">#print(portara_dat_2,&#39;5&#39;)</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>    <span class="c1"># Pivot: Return reshaped DataFrame organized by given index / column values.</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>    <span class="c1"># Make the main columns time basedm and indexed</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>    <span class="n">portara_dat_2</span> <span class="o">=</span> <span class="n">portara_dat_2</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date only&#39;</span><span class="p">,</span> <span class="s1">&#39;Contract&#39;</span><span class="p">,</span> <span class="s1">&#39;symbol&#39;</span><span class="p">],</span> 
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>                                        <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Close&#39;</span><span class="p">)</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>    <span class="c1"># make new column order by  [&#39;Date only&#39;, &#39;Contract&#39;, &#39;symbol&#39;] and reset index to numbers</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="n">portara_dat_2</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>    <span class="c1">#print(portara_dat_2,&#39;pivot&#39;)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>    <span class="c1"># add multiple columns </span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>    <span class="n">list_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Close &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">portara_dat_2</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span> <span class="c1"># rename the columns with times </span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="n">portara_dat_2</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Date only&#39;</span><span class="p">,</span> <span class="s1">&#39;Contract&#39;</span><span class="p">,</span> <span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">list_names</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>    <span class="c1"># Select for data after first date and end date</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>    <span class="n">bools</span> <span class="o">=</span> <span class="n">portara_dat_2</span><span class="p">[</span><span class="s1">&#39;Date only&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span> 
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>                                             <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">end_date</span><span class="p">))</span> <span class="c1"># filter for data after given date </span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="n">portara_dat_2</span> <span class="o">=</span> <span class="n">portara_dat_2</span><span class="p">[</span><span class="n">bools</span><span class="p">]</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>    <span class="c1"># add c1 for front month contract</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>    <span class="n">portara_dat_2</span><span class="p">[</span><span class="s1">&#39;Price Code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">portara_dat_2</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;c&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>    <span class="k">return</span> <span class="n">portara_dat_2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.read_reformat_APC_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_reformat_APC_data</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">time_proxies</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PUBLICATION_DATE&#39;</span><span class="p">,</span> <span class="s1">&#39;PERIOD&#39;</span><span class="p">])</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Read and reformat APC data</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>filename</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>APC filename.</p>
              </div>
            </li>
            <li>
              <b><code>time_proxies</code></b>
                  (<code>list[str]</code>, default:
                      <code>[&#39;PUBLICATION_DATE&#39;, &#39;PERIOD&#39;]</code>
)
              –
              <div class="doc-md-description">
                <p>A list of time (or Date) proxy. These are the column name in the
DataFrame.
The default is ['PUBLICATION_DATE', 'PERIOD'].</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>DataFrame</code>
              –
              <div class="doc-md-description">
                
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="k">def</span> <span class="nf">read_reformat_APC_data</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>                           <span class="n">time_proxies</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> 
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>                           <span class="p">[</span><span class="s1">&#39;PUBLICATION_DATE&#39;</span><span class="p">,</span> <span class="s1">&#39;PERIOD&#39;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">    Read and reformat APC data</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">    filename : str</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="sd">        APC filename.</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="sd">    time_proxies : list[str], optional</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="sd">        A list of time (or Date) proxy. These are the column name in the</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">        DataFrame.</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">        The default is [&#39;PUBLICATION_DATE&#39;, &#39;PERIOD&#39;].</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">    -------</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>    <span class="n">signal_data</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">time_proxies</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>        <span class="n">time_proxies</span> <span class="o">=</span> <span class="p">[</span><span class="n">time_proxies</span><span class="p">]</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>    <span class="k">for</span> <span class="n">time_proxy</span> <span class="ow">in</span> <span class="n">time_proxies</span><span class="p">:</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>        <span class="n">signal_data</span><span class="p">[</span><span class="n">time_proxy</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>                                   <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">signal_data</span><span class="p">[</span><span class="n">time_proxy</span><span class="p">]]</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>    <span class="c1">#signal_data[time_proxy_2] = [datetime.datetime.strptime(x, &#39;%Y-%m-%d&#39;)</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>    <span class="c1">#                            for x in signal_data[time_proxy_2]]</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>    <span class="c1">#signal_data_reindex = signal_data.set_index(&#39;Forecast Period&#39;,drop=False)</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>    <span class="n">signal_data_reindex</span> <span class="o">=</span> <span class="n">signal_data</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>    <span class="k">return</span> <span class="n">signal_data</span> <span class="c1">#signal_data_reindex</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.read_reformat_Portara_daily_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_reformat_Portara_daily_data</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">add_col_data</span><span class="o">=</span><span class="p">{})</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reformat the Portara minute data in a format readable by the scripts.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>filename</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The filename of the Portara minute data.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>history_data</code></b>(                  <code>pandas dataframe</code>
)              –
              <div class="doc-md-description">
                <p>The reformatted table.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="k">def</span> <span class="nf">read_reformat_Portara_daily_data</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>                                     <span class="n">add_col_data</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span> \
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>                                     <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">    Reformat the Portara minute data in a format readable by the scripts.</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">    filename : str</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">        The filename of the Portara minute data.</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">    -------</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">    history_data : pandas dataframe</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">        The reformatted table.</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>    <span class="n">history_data</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>    <span class="n">history_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Open&#39;</span><span class="p">,</span> <span class="s1">&#39;High&#39;</span><span class="p">,</span> <span class="s1">&#39;Low&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>                            <span class="s1">&#39;Settle&#39;</span><span class="p">,</span> <span class="s1">&#39;Volume&#39;</span><span class="p">,</span> <span class="s1">&#39;OpenInterest&#39;</span><span class="p">,</span> <span class="s1">&#39;Contract Code&#39;</span><span class="p">]</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>    <span class="c1"># change the date from 20220222 (int) to &#39;2022-02-22&#39; (str)</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>    <span class="n">history_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">6</span><span class="p">:],</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>                            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">history_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]]</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>    <span class="c1">#history_data_reindex = history_data.set_index(&#39;Date&#39;,drop=False)</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>    <span class="n">history_data_reindex</span> <span class="o">=</span> <span class="n">history_data</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>    <span class="k">match</span> <span class="n">add_col_data</span><span class="p">:</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>        <span class="k">case</span> <span class="p">{}</span> <span class="o">|</span> <span class="p">[]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>            <span class="k">pass</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">add_col_data</span><span class="p">:</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>                <span class="n">history_data_reindex</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_col_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> 
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>    <span class="k">return</span> <span class="n">history_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.read_reformat_Portara_minute_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_reformat_Portara_minute_data</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">add_col_data</span><span class="o">=</span><span class="p">{},</span> <span class="n">time_to_datetime</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reformat the Portara minute data in a format readable by the scripts.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>filename</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The filename of the Portara minute data.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>history_data</code></b>(                  <code>pandas dataframe</code>
)              –
              <div class="doc-md-description">
                <p>The reformatted table.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="k">def</span> <span class="nf">read_reformat_Portara_minute_data</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>  
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>                                      <span class="n">add_col_data</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>                                      <span class="n">time_to_datetime</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> \
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>                                      <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">    Reformat the Portara minute data in a format readable by the scripts.</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a><span class="sd">    filename : str</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">        The filename of the Portara minute data.</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="sd">    -------</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">    history_data : pandas dataframe</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">        The reformatted table.</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>    <span class="n">history_data</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>    <span class="n">history_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Open&#39;</span><span class="p">,</span> <span class="s1">&#39;High&#39;</span><span class="p">,</span> <span class="s1">&#39;Low&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>                            <span class="s1">&#39;Settle&#39;</span><span class="p">,</span> <span class="s1">&#39;Volume&#39;</span><span class="p">,</span> <span class="s1">&#39;Contract Code&#39;</span><span class="p">]</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="c1"># include a function that let user to choose the reformat?</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="c1"># change the date from 20220222 (int) to &#39;2022-02-22&#39; (str)</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>    <span class="n">history_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>\
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>                                                       <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">6</span><span class="p">:],</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>                                                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">history_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]]</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>    <span class="c1"># convert the format 1330 (int) to 13:30 (datetime.time) obejct</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>    <span class="n">intmin</span> <span class="o">=</span> <span class="n">history_data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>    <span class="n">bucket</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">convert_intmin_to_time</span><span class="p">(</span><span class="n">intmin</span><span class="p">)</span> <span class="c1">#, label=&#39;Time&#39;)</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>    <span class="n">history_data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bucket</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="c1"># =============================================================================</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="c1">#     if time_to_datetime:</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="c1">#         history_data[&#39;Time&#39;] = [datetime.datetime.strptime(t, &#39;%H%M&#39;) </span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="c1">#                                 for t in history_data[&#39;Time&#39;]]</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="c1">#     </span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="c1"># =============================================================================</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>    <span class="c1">#history_data_reindex = history_data.set_index(&#39;Date&#39;,drop=False)</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>    <span class="n">history_data_reindex</span> <span class="o">=</span> <span class="n">history_data</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="k">match</span> <span class="n">add_col_data</span><span class="p">:</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="k">case</span> <span class="p">{}</span> <span class="o">|</span> <span class="p">[]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>            <span class="k">pass</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">add_col_data</span><span class="p">:</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>                <span class="n">history_data_reindex</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_col_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> 
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>    <span class="k">return</span> <span class="n">history_data</span><span class="c1">#history_data_reindex</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.read_reformat_dateNtime" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_reformat_dateNtime</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">time_proxies</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">str_formats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">])</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Utility function that read and reformat data with multiple columns of 
time elements, e.g. 'Date' and 'Time'.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>filename</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>CSV filename.</p>
              </div>
            </li>
            <li>
              <b><code>time_proxies</code></b>
                  (<code>list[str]</code>, default:
                      <code>[&#39;Date&#39;, &#39;Time&#39;]</code>
)
              –
              <div class="doc-md-description">
                <p>A list. The default is ['Date', 'Time'].</p>
              </div>
            </li>
            <li>
              <b><code>str_formats</code></b>
                  (<code>list[str]</code>, default:
                      <code>[&#39;%Y-%m-%d&#39;, &#39;%H:%M:%S&#39;]</code>
)
              –
              <div class="doc-md-description">
                <p>A list of str arg passing to datetime.strptime function. 
The default is ['%Y-%m-%d', '%H:%M:%S'].</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>data</code></b>(                  <code>Data Frame</code>
)              –
              <div class="doc-md-description">
                
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="k">def</span> <span class="nf">read_reformat_dateNtime</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>                            <span class="n">time_proxies</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">],</span> 
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>                            <span class="n">str_formats</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">])</span> \
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>                            <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">    Utility function that read and reformat data with multiple columns of </span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">    time elements, e.g. &#39;Date&#39; and &#39;Time&#39;.</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">    filename : str</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">        CSV filename.</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">    time_proxies : list[str], optional</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">        A list. The default is [&#39;Date&#39;, &#39;Time&#39;].</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">    str_formats : list[str], optional</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">        A list of str arg passing to datetime.strptime function. </span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">        The default is [&#39;%Y-%m-%d&#39;, &#39;%H:%M:%S&#39;].</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">    -------</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">    data : Data Frame</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>    <span class="n">bucket_1</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">str_formats</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>                               <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">time_proxies</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>    <span class="n">bucket_2</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">str_formats</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>                               <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">time_proxies</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>    <span class="n">data</span><span class="p">[</span><span class="n">time_proxies</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">bucket_1</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>    <span class="n">data</span><span class="p">[</span><span class="n">time_proxies</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">bucket_2</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">time_proxies</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">data</span><span class="p">[</span><span class="n">time_proxies</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.read_reformat_openprice_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_reformat_openprice_data</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>A function that read and reformat the openprice data.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>filename</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>CSV filename.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>DataFrame</code>
              –
              <div class="doc-md-description">
                
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="k">def</span> <span class="nf">read_reformat_openprice_data</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span>  <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">    A function that read and reformat the openprice data.</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">    filename : str</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">        CSV filename.</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="sd">    -------</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>    <span class="n">openprice_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>    <span class="n">openprice_data</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]),</span> 
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>                                              <span class="n">month</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">]),</span> 
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>                                              <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">8</span><span class="p">:]))</span> 
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>                            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">openprice_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]]</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>    <span class="c1"># convert the format 1330 (int) to 13:30 (datetime.time) obejct</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>    <span class="n">intmin</span> <span class="o">=</span> <span class="n">openprice_data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>    <span class="n">bucket</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">intmin</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> 
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>              <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intmin</span><span class="p">))]</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>    <span class="n">openprice_data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bucket</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>    <span class="c1">#openprice_data_reindex = openprice_data.set_index(&#39;Date&#39;,drop=False)</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>    <span class="n">openprice_data_reindex</span> <span class="o">=</span> <span class="n">openprice_data</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>    <span class="c1">#print(openprice_data_reindex)</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>    <span class="k">return</span> <span class="n">openprice_data</span> <span class="c1">#openprice_data_reindex</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="EC_tools.read.render_PNL_xlsx" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">render_PNL_xlsx</span><span class="p">(</span><span class="n">listfiles</span><span class="p">,</span> <span class="n">number_contracts_list</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;_.xlsx&#39;</span><span class="p">,</span> <span class="n">symbol_proxy</span><span class="o">=</span><span class="s1">&#39;Price_Code&#39;</span><span class="p">,</span> <span class="n">entry_price_proxy</span><span class="o">=</span><span class="s1">&#39;Entry_Price&#39;</span><span class="p">,</span> <span class="n">entry_date_proxy</span><span class="o">=</span><span class="s1">&#39;Entry_Date&#39;</span><span class="p">,</span> <span class="n">exit_price_proxy</span><span class="o">=</span><span class="s1">&#39;Exit_Price&#39;</span><span class="p">,</span> <span class="n">return_proxy</span><span class="o">=</span><span class="s1">&#39;Return_Trades&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>A function that read in the back-test result to generate an xlsx PNL file </p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>listfiles</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>A list of filenames that to be included in the PNL report</p>
              </div>
            </li>
            <li>
              <b><code>number_contracts_list</code></b>
                  (<code>list</code>, default:
                      <code>[5, 10, 15, 20, 25, 50]</code>
)
              –
              <div class="doc-md-description">
                <p>A list of numbers of contracts to be calculated in the return and 
cumulative return</p>
              </div>
            </li>
            <li>
              <b><code>suffix</code></b>
                  (<code>str</code>, default:
                      <code>&#39;_.xlsx&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The suffix for the output filename. The Default is '_.xlsx'.</p>
              </div>
            </li>
            <li>
              <b><code>symbol_proxy</code></b>
                  (<code>str</code>, default:
                      <code>&#39;Price_Code&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The name for the symbol column. The Default is 'Price_Code'.</p>
              </div>
            </li>
            <li>
              <b><code>entry_price_proxy</code></b>
                  (<code>str</code>, default:
                      <code>&#39;Entry_Price&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the entry price column. The Default is 'Entry_Price'.</p>
              </div>
            </li>
            <li>
              <b><code>entry_date_proxy</code></b>
                  (<code>str</code>, default:
                      <code>&#39;Entry_Date&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the entry date column. The Default is 'Entry_Date'.</p>
              </div>
            </li>
            <li>
              <b><code>exit_price_proxy</code></b>
                  (<code>str</code>, default:
                      <code>&#39;Exit_Price&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the exit price column. The Default is 'Exit_Price'.</p>
              </div>
            </li>
            <li>
              <b><code>return_proxy</code></b>
                  (<code>str</code>, default:
                      <code>&#39;Return_Trades&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the return column. The Default is 'Return_Trades'.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>datpc</code></b>(                  <code>DataFrame</code>
)              –
              <div class="doc-md-description">
                <p>The output PNL file.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/read.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1327" name="__codelineno-0-1327"></a><span class="k">def</span> <span class="nf">render_PNL_xlsx</span><span class="p">(</span><span class="n">listfiles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>                    <span class="n">number_contracts_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span> 
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a>                    <span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;_.xlsx&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>                    <span class="n">symbol_proxy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Price_Code&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>                    <span class="n">entry_price_proxy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Entry_Price&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>                    <span class="n">entry_date_proxy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Entry_Date&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>                    <span class="n">exit_price_proxy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Exit_Price&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>                    <span class="n">return_proxy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Return_Trades&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a><span class="sd">    A function that read in the back-test result to generate an xlsx PNL file </span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a><span class="sd">    listfiles : list</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a><span class="sd">        A list of filenames that to be included in the PNL report</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a><span class="sd">    number_contracts_list : list</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a><span class="sd">        A list of numbers of contracts to be calculated in the return and </span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a><span class="sd">        cumulative return</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a><span class="sd">    suffix : str</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a><span class="sd">        The suffix for the output filename. The Default is &#39;_.xlsx&#39;.</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a><span class="sd">    symbol_proxy: str</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a><span class="sd">        The name for the symbol column. The Default is &#39;Price_Code&#39;.</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a><span class="sd">    entry_price_proxy: str</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a><span class="sd">        The name of the entry price column. The Default is &#39;Entry_Price&#39;.</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a><span class="sd">    entry_date_proxy: str</span>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a><span class="sd">        The name of the entry date column. The Default is &#39;Entry_Date&#39;.</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a><span class="sd">    exit_price_proxy: str</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a><span class="sd">        The name of the exit price column. The Default is &#39;Exit_Price&#39;.</span>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a><span class="sd">    return_proxy: str</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a><span class="sd">        The name of the return column. The Default is &#39;Return_Trades&#39;.</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a><span class="sd">    datpc : DataFrame</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a><span class="sd">        The output PNL file.</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>    <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">listfiles</span><span class="p">:</span> 
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>        <span class="c1"># regular output</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>        <span class="n">price_codes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">SIZE_DICT</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>        <span class="n">dat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">dat</span><span class="p">)</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>        <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">fn</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="n">suffix</span><span class="p">)</span> <span class="k">as</span> <span class="n">excel_writer</span><span class="p">:</span> 
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>            <span class="n">dattotal</span> <span class="o">=</span> <span class="n">dat</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>            <span class="n">dattotal</span> <span class="o">=</span> <span class="n">dattotal</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="n">entry_date_proxy</span><span class="p">)</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>            <span class="n">dattotal</span><span class="p">[</span><span class="s1">&#39;number barrels/gallons&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dattotal</span><span class="p">[</span><span class="n">symbol_proxy</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>                                                        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">SIZE_DICT</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>            <span class="n">dattotal</span><span class="p">[</span><span class="s1">&#39;fees&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dattotal</span><span class="p">[</span><span class="n">symbol_proxy</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>                                                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">round_turn_fees</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>            <span class="n">dattotal</span><span class="p">[</span><span class="s1">&#39;fees&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dattotal</span><span class="p">[</span><span class="s1">&#39;Entry_Price&#39;</span><span class="p">]),</span> 
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>                                                    <span class="mf">0.0</span><span class="p">,</span> <span class="n">dattotal</span><span class="p">[</span><span class="s1">&#39;fees&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>            <span class="c1"># Make columns for scaled returns</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>            <span class="n">dattotal</span><span class="p">[</span><span class="s1">&#39;scaled returns from trades&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dattotal</span><span class="p">[</span><span class="n">return_proxy</span><span class="p">]</span><span class="o">*</span>\
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>                                                        <span class="n">dattotal</span><span class="p">[</span><span class="s1">&#39;number barrels/gallons&#39;</span><span class="p">]</span>\
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>                                                            <span class="o">-</span> <span class="n">dattotal</span><span class="p">[</span><span class="s1">&#39;fees&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>            <span class="k">for</span> <span class="n">num_contracts</span> <span class="ow">in</span> <span class="n">number_contracts_list</span><span class="p">:</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>                <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;scaled returns from trades (x </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_contracts</span><span class="p">)</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>                <span class="n">dattotal</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">dattotal</span><span class="p">[</span><span class="s1">&#39;scaled returns from trades&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_contracts</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>            <span class="c1"># Make columns for cumulative returns</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>            <span class="n">dattotal</span><span class="p">[</span><span class="s1">&#39;cumulative P&amp;L from trades&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">dattotal</span><span class="p">[</span><span class="s1">&#39;scaled returns from trades&#39;</span><span class="p">])</span> 
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>            <span class="n">cum_col_name_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cumulative P&amp;L from trades&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>            <span class="k">for</span> <span class="n">num_contracts</span> <span class="ow">in</span> <span class="n">number_contracts_list</span><span class="p">:</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>                <span class="n">cum_col_name</span> <span class="o">=</span> <span class="s1">&#39;cumulative P&amp;L from trades for contracts (x </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_contracts</span><span class="p">)</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>                <span class="n">PNL_col_name</span> <span class="o">=</span> <span class="s1">&#39;scaled returns from trades (x </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_contracts</span><span class="p">)</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>                <span class="n">dattotal</span><span class="p">[</span><span class="n">cum_col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">dattotal</span><span class="p">[</span><span class="n">PNL_col_name</span><span class="p">])</span> 
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>                <span class="n">cum_col_name_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cum_col_name</span><span class="p">)</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>            <span class="n">dattotal</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">excel_writer</span><span class="o">=</span><span class="n">excel_writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>            <span class="c1"># make sub-spread sheet for output sorted by individual asset </span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">pc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">price_codes</span><span class="p">):</span> 
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>                <span class="c1"># recalculate the cumulative returns for each assets</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>                <span class="c1"># First drop the columns previously calculated</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>                <span class="n">datpc</span> <span class="o">=</span> <span class="n">dattotal</span><span class="p">[</span><span class="n">dattotal</span><span class="p">[</span><span class="n">symbol_proxy</span><span class="p">]</span> <span class="o">==</span> <span class="n">pc</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">cum_col_name_list</span><span class="p">)</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>                <span class="c1">##################################</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>                <span class="n">datpc</span><span class="p">[</span><span class="s1">&#39;cumulative P&amp;L from trades&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">datpc</span><span class="p">[</span><span class="s1">&#39;scaled returns from trades&#39;</span><span class="p">])</span> 
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>                <span class="k">for</span> <span class="n">num_contracts</span> <span class="ow">in</span> <span class="n">number_contracts_list</span><span class="p">:</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>                    <span class="n">cum_col_name</span> <span class="o">=</span> <span class="s1">&#39;cumulative P&amp;L from trades for contracts (x </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_contracts</span><span class="p">)</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>                    <span class="n">PNL_col_name</span> <span class="o">=</span> <span class="s1">&#39;scaled returns from trades (x </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_contracts</span><span class="p">)</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>                    <span class="n">datpc</span><span class="p">[</span><span class="n">cum_col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">datpc</span><span class="p">[</span><span class="n">PNL_col_name</span><span class="p">])</span>     
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datpc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>                    <span class="n">datpc</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">excel_writer</span><span class="o">=</span><span class="n">excel_writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">pc</span><span class="p">)</span>         
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>    <span class="k">return</span> <span class="n">datpc</span> 
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../EC_tools/" class="btn btn-neutral float-left" title="Introduction"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../plot/" class="btn btn-neutral float-right" title="plot">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../EC_tools/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../plot/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
