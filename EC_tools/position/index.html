<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>position - EC_tools Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "position";
        var mkdocs_page_input_path = "EC_tools/position.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> EC_tools Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../about/">About</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../main/">Main</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">EC_tools</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../EC_tools/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../read/">read</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../plot/">plot</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../portfolio/">portfolio</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">position</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#EC_tools.position">position</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#EC_tools.position.ExecutePosition">ExecutePosition</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#EC_tools.position.ExecutePosition.cancel_pos">cancel_pos</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#EC_tools.position.ExecutePosition.fill_pos">fill_pos</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#EC_tools.position.Position">Position</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#EC_tools.position.Position.fix_quantity">fix_quantity</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#EC_tools.position.Position.price">price</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#EC_tools.position.Position.__post_init__">__post_init__</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#EC_tools.position.PositionStatus">PositionStatus</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#EC_tools.position.PositionType">PositionType</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../strategy/">strategy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../simple_trade/">simple_trade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../trade/">trade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../backtest/">backtest</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../utility/">utility</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Applications</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/app/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_apc_price_study/">Run APC Study</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_backtest/">Run Backtest</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_comparison_plot/">Run Comparison Plot</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_daily_instruction/">Run Daily Instruction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_data_management/">Run Data Management</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_gen_monthly_MR_dir/">Run Generate Monthly MR signals</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_gen_MR_dir/">Run Generate Daily MR signals</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../app/run_plot_heatamp.md">Run Plot Backtest Heatmap</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_PNL_plot/">Run PNL Plots</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_preprocess/">Run Preprocess</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../app/run_update_db/">Run Update DB</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">EC_tools Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">EC_tools</li>
      <li class="breadcrumb-item active">position</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="position">Position</h1>


<div class="doc doc-object doc-module">



<a id="EC_tools.position"></a>
    <div class="doc doc-contents first">

        <p>Created on Wed May 29 23:49:08 2024</p>
<p>@author: dexter</p>
<p>Position Module.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="EC_tools.position.ExecutePosition" class="doc doc-heading">
            <code>ExecutePosition</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


        <p>A class that execute the position.</p>

              <details class="quote">
                <summary>Source code in <code>EC_tools/position.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="k">class</span> <span class="nc">ExecutePosition</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">    A class that execute the position.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">Position</span><span class="p">:</span> <span class="n">Position</span><span class="p">):</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">Position</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="c1">#check if there is a Portfolio attached to the position.</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="p">,</span> <span class="n">Portfolio</span><span class="p">):</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The position does not belong to a valid </span><span class="se">\</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="s2">                            Portfolio.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="k">def</span> <span class="nf">fill_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>                 <span class="n">fill_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> 
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>                 <span class="n">pos_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;Long-Buy&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">        Fill position method.</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">        fill_time : datetime, optional</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">            The filling time. The default is datetime.datetime.now().</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">        ------</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">        Exception</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">            If the position status is not pending or there are not enough </span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">            give_obj in the portfolio.</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        -------</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        position object</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="c1"># check if the position is Pending</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">PositionStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">:</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="k">pass</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The position must be in Pending state to be filled.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="c1"># define a delay time so that each entry would not be simultaneous.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="c1"># simultaneous entry results in fault calculation in the Portfolio method </span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="n">delay_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span> 
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="k">if</span> <span class="n">pos_type</span> <span class="o">==</span> <span class="s1">&#39;Long-Buy&#39;</span><span class="p">:</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>            <span class="c1">#print(&#39;Execute Long-buy position.&#39;)</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="c1"># Pay pre-existing asset</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">give_obj</span><span class="p">,</span> 
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                                        <span class="n">datetime</span><span class="o">=</span> <span class="n">fill_time</span><span class="p">)</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="c1">#print(self.position.give_obj)</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>            <span class="c1"># Get the desired asset</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">get_obj</span><span class="p">,</span> 
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>                                        <span class="n">datetime</span> <span class="o">=</span> <span class="n">fill_time</span> <span class="o">+</span> <span class="n">delay_time</span><span class="p">)</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="c1">#print(self.position.get_obj)</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="k">elif</span> <span class="n">pos_type</span> <span class="o">==</span> <span class="s1">&#39;Long-Sell&#39;</span><span class="p">:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="c1">#print(&#39;Execute Long-sell position.&#39;)</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="c1"># Pay pre-existing asset</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">get_obj</span><span class="p">,</span> 
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                                        <span class="n">datetime</span><span class="o">=</span> <span class="n">fill_time</span><span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>            <span class="c1">#print(self.position.get_obj)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>            <span class="c1"># Get the desired asset</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">give_obj</span><span class="p">,</span> 
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                                        <span class="n">datetime</span> <span class="o">=</span> <span class="n">fill_time</span> <span class="o">+</span> <span class="n">delay_time</span><span class="p">)</span> 
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="c1">#print(self.position.give_obj)</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="k">elif</span> <span class="n">pos_type</span> <span class="o">==</span> <span class="s1">&#39;Short-Borrow&#39;</span><span class="p">:</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="c1">#print(&#39;Execute Short-Borrow position.&#39;)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>            <span class="c1"># The sub method does not allow overwithdraw. </span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="c1"># Thus assume the give_obj is a {debt} object</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="c1"># Here, assume give_obj = cash, get_obj = asset</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="c1"># Set up the debt object</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="n">debt_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">get_obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1">#replace(self.position.get_obj)</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="n">debt_obj</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">debt_obj</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span><span class="o">*-</span><span class="mi">1</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="n">debt_obj</span><span class="p">[</span><span class="s1">&#39;misc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;debt&#39;</span><span class="p">}</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="c1"># The &quot;Borrow&quot; action</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">get_obj</span><span class="p">,</span> 
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>                                        <span class="n">datetime</span><span class="o">=</span> <span class="n">fill_time</span><span class="p">)</span> <span class="c1">#actual asset</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>            <span class="c1"># sell the asset here</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">get_obj</span><span class="p">,</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                                        <span class="n">datetime</span> <span class="o">=</span> <span class="n">fill_time</span> <span class="o">+</span> <span class="n">delay_time</span><span class="p">)</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>            <span class="c1"># earn the cash here</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">give_obj</span><span class="p">,</span> 
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                                        <span class="n">datetime</span> <span class="o">=</span> <span class="n">fill_time</span> <span class="o">+</span> <span class="n">delay_time</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>            <span class="c1"># Issue a debt object for recording the borrowingaction</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">debt_obj</span><span class="p">,</span> <span class="n">datetime</span> <span class="o">=</span> 
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>                                        <span class="n">fill_time</span> <span class="o">+</span> <span class="n">delay_time</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># debt object</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="k">elif</span> <span class="n">pos_type</span> <span class="o">==</span> <span class="s1">&#39;Short-Buyback&#39;</span><span class="p">:</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>            <span class="c1">#print(&#39;Execute Short-Buyback position.&#39;)</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>            <span class="n">payback_debt_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">get_obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1">#replace(self.position.get_obj)</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="n">payback_debt_obj</span><span class="p">[</span><span class="s1">&#39;misc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;debt&#39;</span><span class="p">}</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="c1"># normal long</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>            <span class="c1"># subtract the cash here to buy back the asset</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">give_obj</span><span class="p">,</span> 
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                                        <span class="n">datetime</span> <span class="o">=</span> <span class="n">fill_time</span><span class="p">)</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="c1"># Get the desired asset the set balance out the debt object</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="c1"># Buyback the debt object to settle the debt automatically</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">payback_debt_obj</span><span class="p">,</span> 
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>                                        <span class="n">datetime</span> <span class="o">=</span> <span class="n">fill_time</span> <span class="o">+</span> <span class="n">delay_time</span><span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="c1"># charge a fee if it exits</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">fee</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="c1">#or self.position.fee &gt; 0:</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="n">payment_time</span> <span class="o">=</span> <span class="n">fill_time</span><span class="o">+</span> <span class="n">delay_time</span><span class="o">*</span><span class="mi">10</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>            <span class="c1"># Fees are calculated per contracts                                </span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">fee</span><span class="p">,</span> 
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>                                        <span class="n">datetime</span><span class="o">=</span> <span class="n">payment_time</span><span class="p">)</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="c1"># change the position status and fill time</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">PositionStatus</span><span class="o">.</span><span class="n">FILLED</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">fill_time</span> <span class="o">=</span> <span class="n">fill_time</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>    <span class="k">def</span> <span class="nf">cancel_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">void_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">        Cancel position method.</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">        void_time : datetime, optional</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">            The cancelling time. The default is datetime.datetime.now().</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">        ------</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">        Exception</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">            If the position is not yet added.</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">        -------</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">        position object</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="c1"># check if the position is Pending</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">PositionStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="k">pass</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The position can only be cancelled when it is in</span><span class="se">\</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="s2">                            the Pending state.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">PositionStatus</span><span class="o">.</span><span class="n">VOID</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">void_time</span> <span class="o">=</span> <span class="n">void_time</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="EC_tools.position.ExecutePosition.cancel_pos" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cancel_pos</span><span class="p">(</span><span class="n">void_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Cancel position method.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>void_time</code></b>
                  (<code>datetime</code>, default:
                      <code><span title="datetime.datetime.now">now</span>()</code>
)
              –
              <div class="doc-md-description">
                <p>The cancelling time. The default is datetime.datetime.now().</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>Exception</code>
              –
              <div class="doc-md-description">
                <p>If the position is not yet added.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>position object</code>
              –
              <div class="doc-md-description">
                
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/position.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="k">def</span> <span class="nf">cancel_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">void_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">    Cancel position method.</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">    void_time : datetime, optional</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">        The cancelling time. The default is datetime.datetime.now().</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">    ------</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">    Exception</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">        If the position is not yet added.</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">    -------</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">    position object</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="c1"># check if the position is Pending</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">PositionStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="k">pass</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The position can only be cancelled when it is in</span><span class="se">\</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="s2">                        the Pending state.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">PositionStatus</span><span class="o">.</span><span class="n">VOID</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">void_time</span> <span class="o">=</span> <span class="n">void_time</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="EC_tools.position.ExecutePosition.fill_pos" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fill_pos</span><span class="p">(</span><span class="n">fill_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">pos_type</span><span class="o">=</span><span class="s1">&#39;Long-Buy&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Fill position method.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>fill_time</code></b>
                  (<code>datetime</code>, default:
                      <code><span title="datetime.datetime.now">now</span>()</code>
)
              –
              <div class="doc-md-description">
                <p>The filling time. The default is datetime.datetime.now().</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>Exception</code>
              –
              <div class="doc-md-description">
                <p>If the position status is not pending or there are not enough 
give_obj in the portfolio.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>position object</code>
              –
              <div class="doc-md-description">
                
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>EC_tools/position.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="k">def</span> <span class="nf">fill_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>             <span class="n">fill_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> 
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>             <span class="n">pos_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;Long-Buy&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    Fill position method.</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">    fill_time : datetime, optional</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        The filling time. The default is datetime.datetime.now().</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">    ------</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    Exception</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        If the position status is not pending or there are not enough </span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">        give_obj in the portfolio.</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">    -------</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">    position object</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="c1"># check if the position is Pending</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">PositionStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">:</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="k">pass</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The position must be in Pending state to be filled.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="c1"># define a delay time so that each entry would not be simultaneous.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="c1"># simultaneous entry results in fault calculation in the Portfolio method </span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="n">delay_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span> 
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="k">if</span> <span class="n">pos_type</span> <span class="o">==</span> <span class="s1">&#39;Long-Buy&#39;</span><span class="p">:</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="c1">#print(&#39;Execute Long-buy position.&#39;)</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="c1"># Pay pre-existing asset</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">give_obj</span><span class="p">,</span> 
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                                    <span class="n">datetime</span><span class="o">=</span> <span class="n">fill_time</span><span class="p">)</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="c1">#print(self.position.give_obj)</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="c1"># Get the desired asset</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">get_obj</span><span class="p">,</span> 
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>                                    <span class="n">datetime</span> <span class="o">=</span> <span class="n">fill_time</span> <span class="o">+</span> <span class="n">delay_time</span><span class="p">)</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="c1">#print(self.position.get_obj)</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="k">elif</span> <span class="n">pos_type</span> <span class="o">==</span> <span class="s1">&#39;Long-Sell&#39;</span><span class="p">:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="c1">#print(&#39;Execute Long-sell position.&#39;)</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="c1"># Pay pre-existing asset</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">get_obj</span><span class="p">,</span> 
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                                    <span class="n">datetime</span><span class="o">=</span> <span class="n">fill_time</span><span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="c1">#print(self.position.get_obj)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="c1"># Get the desired asset</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">give_obj</span><span class="p">,</span> 
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                                    <span class="n">datetime</span> <span class="o">=</span> <span class="n">fill_time</span> <span class="o">+</span> <span class="n">delay_time</span><span class="p">)</span> 
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="c1">#print(self.position.give_obj)</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="k">elif</span> <span class="n">pos_type</span> <span class="o">==</span> <span class="s1">&#39;Short-Borrow&#39;</span><span class="p">:</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="c1">#print(&#39;Execute Short-Borrow position.&#39;)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="c1"># The sub method does not allow overwithdraw. </span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="c1"># Thus assume the give_obj is a {debt} object</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="c1"># Here, assume give_obj = cash, get_obj = asset</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="c1"># Set up the debt object</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="n">debt_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">get_obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1">#replace(self.position.get_obj)</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="n">debt_obj</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">debt_obj</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span><span class="o">*-</span><span class="mi">1</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="n">debt_obj</span><span class="p">[</span><span class="s1">&#39;misc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;debt&#39;</span><span class="p">}</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="c1"># The &quot;Borrow&quot; action</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">get_obj</span><span class="p">,</span> 
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>                                    <span class="n">datetime</span><span class="o">=</span> <span class="n">fill_time</span><span class="p">)</span> <span class="c1">#actual asset</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="c1"># sell the asset here</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">get_obj</span><span class="p">,</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                                    <span class="n">datetime</span> <span class="o">=</span> <span class="n">fill_time</span> <span class="o">+</span> <span class="n">delay_time</span><span class="p">)</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="c1"># earn the cash here</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">give_obj</span><span class="p">,</span> 
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                                    <span class="n">datetime</span> <span class="o">=</span> <span class="n">fill_time</span> <span class="o">+</span> <span class="n">delay_time</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="c1"># Issue a debt object for recording the borrowingaction</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">debt_obj</span><span class="p">,</span> <span class="n">datetime</span> <span class="o">=</span> 
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>                                    <span class="n">fill_time</span> <span class="o">+</span> <span class="n">delay_time</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># debt object</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>    <span class="k">elif</span> <span class="n">pos_type</span> <span class="o">==</span> <span class="s1">&#39;Short-Buyback&#39;</span><span class="p">:</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="c1">#print(&#39;Execute Short-Buyback position.&#39;)</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="n">payback_debt_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">get_obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1">#replace(self.position.get_obj)</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="n">payback_debt_obj</span><span class="p">[</span><span class="s1">&#39;misc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;debt&#39;</span><span class="p">}</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>        <span class="c1"># normal long</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="c1"># subtract the cash here to buy back the asset</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">give_obj</span><span class="p">,</span> 
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                                    <span class="n">datetime</span> <span class="o">=</span> <span class="n">fill_time</span><span class="p">)</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="c1"># Get the desired asset the set balance out the debt object</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="c1"># Buyback the debt object to settle the debt automatically</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">payback_debt_obj</span><span class="p">,</span> 
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>                                    <span class="n">datetime</span> <span class="o">=</span> <span class="n">fill_time</span> <span class="o">+</span> <span class="n">delay_time</span><span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>    <span class="c1"># charge a fee if it exits</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">fee</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="c1">#or self.position.fee &gt; 0:</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="n">payment_time</span> <span class="o">=</span> <span class="n">fill_time</span><span class="o">+</span> <span class="n">delay_time</span><span class="o">*</span><span class="mi">10</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="c1"># Fees are calculated per contracts                                </span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">portfolio</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">fee</span><span class="p">,</span> 
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>                                    <span class="n">datetime</span><span class="o">=</span> <span class="n">payment_time</span><span class="p">)</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>    <span class="c1"># change the position status and fill time</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">PositionStatus</span><span class="o">.</span><span class="n">FILLED</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">fill_time</span> <span class="o">=</span> <span class="n">fill_time</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="EC_tools.position.Position" class="doc doc-heading">
            <code>Position</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


        <p>Position class that create and manage position objects.</p>
<p>The position objects tracks the give and get objects and the</p>

              <details class="quote">
                <summary>Source code in <code>EC_tools/position.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="nd">@dataclass</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="k">class</span> <span class="nc">Position</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    Position class that create and manage position objects.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    The position objects tracks the give and get objects and the </span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="c1"># key attributes</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="n">give_obj</span><span class="p">:</span> <span class="nb">dict</span> <span class="c1"># Asset</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="n">get_obj</span><span class="p">:</span> <span class="nb">dict</span> <span class="c1"># Asset</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="n">_price</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="n">status</span><span class="p">:</span> <span class="n">PositionStatus</span> <span class="o">=</span> <span class="n">PositionStatus</span><span class="o">.</span><span class="n">PENDING</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">portfolio</span><span class="p">:</span> <span class="n">Portfolio</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="c1"># optional asset control</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="n">fee</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">pos_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Long-Buy&#39;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="c1"># position attribute adjustable</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">open_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> 
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">fill_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">void_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">auto_adjust</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">pos_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">random_string</span><span class="p">()</span>  
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="c1">#misc: dict = field(default_factory={&#39;None&#39;})</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>                      <span class="n">void_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> 
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>                      <span class="n">epi</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">):</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        The post init function that checks if the input price is correct.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        If it is not. the position is voided.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="c1"># check if the quantity of both assets are </span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="c1">#correct_ratio = self.give_obj.quantity / (self.get_obj.quantity*self.size)</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="c1"># reminder: give is cash, get is asset (usually)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="n">correct_ratio</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">give_obj</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_obj</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="c1">#print(&#39;correction_ratio&#39;, correct_ratio, self.price)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="c1"># If the price is within the interval of (-epi, +epi) upon the correct ratio</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="c1"># We consider it is equal to the correct ratio</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_price</span>  <span class="o">&lt;</span> <span class="n">correct_ratio</span> <span class="o">+</span> <span class="n">epi</span><span class="p">)</span> <span class="ow">and</span> \
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_price</span> <span class="o">&gt;</span> <span class="n">correct_ratio</span><span class="o">-</span> <span class="n">epi</span><span class="p">)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="c1">#print(&#39;Position created. Check:&#39;, self._check)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="c1">#If this value is false, the position is automatically voided.</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">PositionStatus</span><span class="o">.</span><span class="n">VOID</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">void_time</span> <span class="o">=</span> <span class="n">void_time</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Position voided due to invalid price entry.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="c1"># define fix quantity </span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_fix_quantity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_obj</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="k">def</span> <span class="nf">fix_quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        This is a speical attribute for each position object. It defines which </span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        quantity to be fixed for an exchange to be executed when the price is </span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">        not exactly as stated in the position object. It can either be </span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        self.give_obj.quantity or self.get_obj.quantity.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_quantity</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="nd">@fix_quantity</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="k">def</span> <span class="nf">fix_quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        Setter method to change the value of fix_quantity.</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        value : int or float</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">            The new fix value.</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        -------</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        int or float</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">            DESCRIPTION.</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_fix_quantity</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_quantity</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="k">def</span> <span class="nf">price</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        Getter method for calling position&#39;s price.</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        -------</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        float</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">            The price of this exchanges.</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_price</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="nd">@price</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="k">def</span> <span class="nf">price</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        Setter method for calling position&#39;s price.</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="c1"># check if the new price is the same </span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">give_obj</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_obj</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_adjust</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="k">pass</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_adjust</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The new price value does not align with the </span><span class="se">\</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="s2">                                asset quantities in the position.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="c1"># set a new price in the position.</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_price</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="c1"># Assuming the give_obj is the one in the portfolio, we anchor the </span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="c1"># exchange rate using what we have. So we only changes the quantity in</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="c1"># the get_obj atrribute</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_quantity</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">give_obj</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_obj</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">give_obj</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span>  <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_price</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_quantity</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_obj</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">give_obj</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_obj</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_price</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="EC_tools.position.Position.fix_quantity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fix_quantity</span><span class="p">:</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>This is a speical attribute for each position object. It defines which 
quantity to be fixed for an exchange to be executed when the price is 
not exactly as stated in the position object. It can either be 
self.give_obj.quantity or self.get_obj.quantity.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="EC_tools.position.Position.price" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">price</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Getter method for calling position's price.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>float</code>
              –
              <div class="doc-md-description">
                <p>The price of this exchanges.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="EC_tools.position.Position.__post_init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__post_init__</span><span class="p">(</span><span class="n">void_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">epi</span><span class="o">=</span><span class="mf">1e-08</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>The post init function that checks if the input price is correct.
If it is not. the position is voided.</p>

            <details class="quote">
              <summary>Source code in <code>EC_tools/position.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>                  <span class="n">void_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> 
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>                  <span class="n">epi</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">):</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    The post init function that checks if the input price is correct.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    If it is not. the position is voided.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="c1"># check if the quantity of both assets are </span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="c1">#correct_ratio = self.give_obj.quantity / (self.get_obj.quantity*self.size)</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="c1"># reminder: give is cash, get is asset (usually)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="n">correct_ratio</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">give_obj</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_obj</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="c1">#print(&#39;correction_ratio&#39;, correct_ratio, self.price)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="c1"># If the price is within the interval of (-epi, +epi) upon the correct ratio</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="c1"># We consider it is equal to the correct ratio</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_price</span>  <span class="o">&lt;</span> <span class="n">correct_ratio</span> <span class="o">+</span> <span class="n">epi</span><span class="p">)</span> <span class="ow">and</span> \
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_price</span> <span class="o">&gt;</span> <span class="n">correct_ratio</span><span class="o">-</span> <span class="n">epi</span><span class="p">)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="c1">#print(&#39;Position created. Check:&#39;, self._check)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="c1">#If this value is false, the position is automatically voided.</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">PositionStatus</span><span class="o">.</span><span class="n">VOID</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">void_time</span> <span class="o">=</span> <span class="n">void_time</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Position voided due to invalid price entry.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="c1"># define fix quantity </span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_fix_quantity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_obj</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="EC_tools.position.PositionStatus" class="doc doc-heading">
            <code>PositionStatus</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


        <p>A set of possible status for positions.</p>

              <details class="quote">
                <summary>Source code in <code>EC_tools/position.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="k">class</span> <span class="nc">PositionStatus</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    A set of possible status for positions.</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="n">PENDING</span> <span class="o">=</span> <span class="s2">&quot;Pending&quot;</span> <span class="c1"># When the position is added but not filled</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="n">FILLED</span> <span class="o">=</span> <span class="s2">&quot;Filled&quot;</span> <span class="c1"># When the position is executed</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">VOID</span> <span class="o">=</span> <span class="s2">&quot;Cancelled&quot;</span> <span class="c1"># When the position is cancelled</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="EC_tools.position.PositionType" class="doc doc-heading">
            <code>PositionType</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


        <p>A set of possible types of positions</p>

              <details class="quote">
                <summary>Source code in <code>EC_tools/position.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="k">class</span> <span class="nc">PositionType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    A set of possible types of positions</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">LONG_BUY</span> <span class="o">=</span> <span class="s1">&#39;Long-Buy&#39;</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="n">LONG_SELL</span> <span class="o">=</span> <span class="s1">&#39;Long-Sell&#39;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="n">SHORT_BORROW</span> <span class="o">=</span> <span class="s1">&#39;Short-Borrow&#39;</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="n">SHORT_BUYBACK</span> <span class="o">=</span> <span class="s1">&#39;Short-Buyback&#39;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="n">CALL_BUY</span> <span class="o">=</span> <span class="s1">&#39;Call-Buy&#39;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="n">CALL_SELL</span> <span class="o">=</span> <span class="s1">&#39;Call-Sell&#39;</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="n">PUT_BUY</span> <span class="o">=</span> <span class="s1">&#39;Put-Buy&#39;</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="n">PUT_SELL</span> <span class="o">=</span> <span class="s1">&#39;Put-Sell&#39;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div><hr />
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../portfolio/" class="btn btn-neutral float-left" title="portfolio"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../strategy/" class="btn btn-neutral float-right" title="strategy">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../portfolio/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../strategy/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
